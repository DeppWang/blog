<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Depp Wang&#39;s Blog</title>
    <link>https://depp.wang/</link>
    <atom:link href="/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>æ¯ä¸ªäººéƒ½éœ€è¦æœ‰è‡ªå·±çš„å“ˆå§†é›·ç‰¹</description>
    <pubDate>Wed, 03 Mar 2021 06:40:42 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Commit å‰æ£€æŸ¥ Python ä»£ç æ ¼å¼.md</title>
      <link>https://depp.wang/2021/03/03/check-python-code-before-commit/</link>
      <guid>https://depp.wang/2021/03/03/check-python-code-before-commit/</guid>
      <pubDate>Wed, 03 Mar 2021 17:25:24 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;&lt;a href=&quot;https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://l
        
      
      </description>
      
      <content:encoded><![CDATA[<p><a href="https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/" target="_blank" rel="noopener">https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/</a></p><ul><li>ä»£ç æ£€æŸ¥å·¥å…·ï¼šflake8</li><li>å€ŸåŠ©é’©å­ï¼ˆhooksï¼‰ï¼š åœ¨ç‰¹å®šçš„é‡è¦åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è‡ªå®šä¹‰è„šæœ¬</li><li>pre-commit é’©å­ï¼šåœ¨ pre-commit å‰æ“ä½œ</li></ul><p>æ­¥éª¤</p><ol><li>å®‰è£… pre-commit åŒ…ï¼Œç”¨äºä½¿ç”¨ pre-commit é’©å­<ul><li>pip install pre-commit</li></ul></li><li>å·¥ç¨‹ç›®å½•ä¸‹æ·»åŠ  .pre-commit-config.yaml è®¾ç½®éœ€è¦è®¾ç½®çš„é’©å­</li><li>~/.flake8 è®¾ç½® flake8 è§„åˆ™</li><li>pre-commit install å®‰è£…é’©å­åˆ° git</li></ol><ul><li>.pre-commit-config.yaml</li></ul><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="attribute">repos</span>:</span><br><span class="line">-   <span class="attribute">repo</span>: <span class="attribute">https</span>:<span class="comment">//github.com/pre-commit/pre-commit-hooks</span></span><br><span class="line">    <span class="attribute">rev</span>: v1.<span class="number">2.3</span></span><br><span class="line">    <span class="attribute">hooks</span>:</span><br><span class="line">    - <span class="attribute">id</span>: flake8</span><br></pre></td></tr></table></figure><ul><li>~/.flake8</li></ul><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[flake8]</span></span><br><span class="line"><span class="attr">ignore</span> = E501 E722 W291</span><br><span class="line"><span class="attr">max-line-length</span> = <span class="number">120</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ pyenv é‡åˆ°çš„é”™è¯¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(ENV37) [18:59:05] ~/Workspace/medweb git(feature/seo_auto_audio_push) ğŸ”¥ â±â±â± gcm 'tmp'</span><br><span class="line">pyenv: python3.7: command not found</span><br><span class="line"></span><br><span class="line">The `python3.7' command exists in these Python versions:</span><br><span class="line">  3.7.0</span><br><span class="line">  3.7.0/envs/ENV-DEMO-FFmpeg</span><br><span class="line">  3.7.0/envs/example_venv</span><br><span class="line">  3.7.0/envs/medweb</span><br><span class="line">  ENV-DEMO-FFmpeg</span><br><span class="line">  example_venv</span><br><span class="line">  medweb</span><br><span class="line"></span><br><span class="line">Note: See 'pyenv help global' for tips on allowing both</span><br><span class="line">      python2 and python3 to be found.</span><br><span class="line">[18:59:06] [cost 0.293s] gcm 'tmp'</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹å¼</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> /Users/deppwang/.pyenv/versions/ENV37/bin/</span><br><span class="line"><span class="keyword">ln</span> -s <span class="keyword">python3</span> <span class="keyword">python3</span>.<span class="number">7</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªåä¸º python3.7 çš„ python3 è½¯é“¾</li><li><a href="https://github.com/pre-commit/pre-commit/issues/810" target="_blank" rel="noopener">https://github.com/pre-commit/pre-commit/issues/810</a></li></ul><p>å› ä¸ºæ–°å»ºäº†ä¸€ä¸ª .pre-commit-config.yaml æ–‡ä»¶ï¼Œåˆä¸èƒ½æäº¤ï¼Œå¯ä»¥ å…³é—­ GIT è·Ÿè¸ªè¿™ä¸ªæ–‡ä»¶ä¿®æ”¹ã€‚æˆ–åŠ åˆ° .gitignore ä¸­ï¼Œå…³é—­å¯¹ .gitignore çš„è·Ÿè¸ª</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git update-index --skip-worktree /Users/deppwang/workspace/medweb/.pre-commit-config.yaml</span><br><span class="line">æˆ–</span><br><span class="line">git update-index --skip-worktree /Users/deppwang/workspace/medweb/.gitignore</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>https://depp.wang/2021/03/03/check-python-code-before-commit/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Django å…¥é—¨ç¬”è®°</title>
      <link>https://depp.wang/2020/11/17/django-getting-started-notes/</link>
      <guid>https://depp.wang/2020/11/17/django-getting-started-notes/</guid>
      <pubDate>Tue, 17 Nov 2020 17:25:24 GMT</pubDate>
      <description>
      
        &lt;!--å­¦ä¹  Django å‰çš„ç–‘é—®ï¼š--&gt;

&lt;!--1.Django å¦‚ä½•å·¥ä½œçš„--&gt;
&lt;!--2.Python çš„ Django å’Œ Java çš„ SpringBoot æœ‰ä»€ä¹ˆåŒºåˆ«--&gt;
&lt;!--3.Django å’Œ Flask æœ‰ä»€ä¹ˆåŒºåˆ«--&gt;

&lt;h2 id=&quot;WSGI&quot;&gt;&lt;a href=&quot;#WSGI&quot; class=&quot;headerlink&quot; title=&quot;WSGI&quot;&gt;&lt;/a&gt;WSGI&lt;/h2&gt;&lt;p&gt;WSGIï¼šï¼ˆWeb Server Gateway Interfaceï¼ŒWeb æœåŠ¡ç«¯ç½‘å…³æ¥å£ï¼‰ã€‚åœ¨ä¸å€ŸåŠ©æ¡†æ¶çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨ WSGI æ¥å¼€å‘ç®€æ˜“æœåŠ¡ç«¯ã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<!--å­¦ä¹  Django å‰çš„ç–‘é—®ï¼š--><!--1.Django å¦‚ä½•å·¥ä½œçš„--><!--2.Python çš„ Django å’Œ Java çš„ SpringBoot æœ‰ä»€ä¹ˆåŒºåˆ«--><!--3.Django å’Œ Flask æœ‰ä»€ä¹ˆåŒºåˆ«--><h2 id="WSGI"><a href="#WSGI" class="headerlink" title="WSGI"></a>WSGI</h2><p>WSGIï¼šï¼ˆWeb Server Gateway Interfaceï¼ŒWeb æœåŠ¡ç«¯ç½‘å…³æ¥å£ï¼‰ã€‚åœ¨ä¸å€ŸåŠ©æ¡†æ¶çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨ WSGI æ¥å¼€å‘ç®€æ˜“æœåŠ¡ç«¯ã€‚</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hello.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)])  <span class="comment"># è®¾ç½® Header</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b'&lt;h1&gt;Hello, web!&lt;/h1&gt;'</span>]  <span class="comment"># å“åº”å†…å®¹</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># server.py</span></span><br><span class="line"><span class="comment"># ä» wsgiref æ¨¡å—å¯¼å…¥:</span></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="comment"># å¯¼å…¥æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ application å‡½æ•°:</span></span><br><span class="line"><span class="keyword">from</span> hello <span class="keyword">import</span> application</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼ŒIP åœ°å€ä¸ºç©ºï¼Œç«¯å£æ˜¯ 8000ï¼Œå¤„ç†å‡½æ•°æ˜¯ application:</span></span><br><span class="line">httpd = make_server(<span class="string">''</span>, <span class="number">8000</span>, application)</span><br><span class="line">print(<span class="string">'Serving HTTP on port 8000...'</span>)</span><br><span class="line"><span class="comment"># å¼€å§‹ç›‘å¬ HTTP è¯·æ±‚:</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure><p>è¿è¡Œï¼š<code>python3 server.py</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[21:32:30] ~/workspace/demo â±â±â± python3 server.py</span><br><span class="line">Serving HTTP on port 8000...</span><br></pre></td></tr></table></figure><p><code>http://localhost:8000/</code></p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-11-16-133323.png" alt="image-20201116213322503"></p><ul><li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017806472608512" target="_blank" rel="noopener">WSGI æ¥å£</a></li><li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017806472608512" target="_blank" rel="noopener">ä½¿ç”¨ Web æ¡†æ¶</a></li></ul><h2 id="macOS-å®‰è£…-Django"><a href="#macOS-å®‰è£…-Django" class="headerlink" title="macOS å®‰è£… Django"></a>macOS å®‰è£… Django</h2><ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/overview/" target="_blank" rel="noopener">å®˜æ–¹ä¸­æ–‡æ•™ç¨‹ 3.1</a>ã€<a href="https://docs.djangoproject.com/en/1.11/" target="_blank" rel="noopener">è‹±æ–‡æ•™ç¨‹ 1.11</a></li></ul><p>Python ç‰ˆæœ¬ä¸ Django ç‰ˆæœ¬çš„<a href="https://docs.djangoproject.com/zh-hans/3.1/faq/install/#faq-python-version-support" target="_blank" rel="noopener">å…³ç³»</a></p><p>å®‰è£… Django 1.11ï¼Œå¯¹åº” Python2ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo python -m pip install Django</span></span><br></pre></td></tr></table></figure><p>å®‰è£…æœ€æ–°ç‰ˆ Django 3.1ï¼Œå¯¹åº” Python3ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -m pip install Django</span></span><br></pre></td></tr></table></figure><ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/install/" target="_blank" rel="noopener">å¿«é€Ÿå®‰è£…æŒ‡å—</a></li></ul><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python -m django --version</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 -m django --version</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-Django-é¡¹ç›®"><a href="#åˆ›å»º-Django-é¡¹ç›®" class="headerlink" title="åˆ›å»º Django é¡¹ç›®"></a>åˆ›å»º Django é¡¹ç›®</h2><ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial01/" target="_blank" rel="noopener">ç¬¬ 1 èŠ‚ï¼šè¯·æ±‚å’Œå“åº”</a></li></ul><p>åˆ›å»ºä¸€ä¸ªåä¸º mysite çš„ Django é¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> django-admin startproject mysite</span></span><br></pre></td></tr></table></figure><p>åœ¨æ²¡æœ‰å®‰è£… 1.11 ç‰ˆæœ¬çš„ Django æ—¶ï¼Œæç¤ºæœªæ‰¾åˆ°å‘½ä»¤ï¼š<code>zsh: command not found: django-admin</code></p><p>è§£å†³æ–¹å¼ï¼šä½¿ç”¨ <code>python3 -m django</code> æ›¿ä»£ <code>django-admin</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -m django startproject mysite</span></span><br></pre></td></tr></table></figure><p>åŸå› ï¼šè¿è¡Œå‘½ä»¤ <code>django-admin startproject mysite</code> æ—¶ï¼Œç³»ç»Ÿå°†å» <code>/usr/local/bin</code> ç›®å½•æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ django-adminï¼Œå®‰è£… Django 3.1 æ—¶ï¼Œæ²¡æœ‰è‡ªåŠ¨å°†å¯æ‰§è¡Œæ–‡ä»¶<code>django-admin</code> <a href="https://zh.wikipedia.org/wiki/%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5" target="_blank" rel="noopener">è½¯é“¾ï¼ˆç¬¦å·é“¾æ¥ï¼‰</a>åˆ° <code>/usr/local/bin</code>ï¼Œæ‰€ä»¥ç›´æ¥è¿è¡Œä¸å¥½ä½¿ï¼Œè€Œä½¿ç”¨ <code>python3 -m django</code>ï¼Œm å«ä¹‰moduleï¼Œå°†åœ¨ <code>/Library/Frameworks/Python.framework/Versions/3.7</code> ä¸‹çš„site-package ä¸­æŸ¥æ‰¾</p><p>çš„ ç›®å½•æ‰¾æ­¤å‘½ä»¤ï¼Œæ‰¾ä¸åˆ°ã€‚å®‰è£… Django 1.11 åï¼Œæ­¤å‘½ä»¤å¯ä»¥ä½¿ç”¨</p><ul><li>å‘½ä»¤å…³é”®å­—ï¼š<strong>startproject</strong></li></ul><p>mysite ç»“æ„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysite/</span><br><span class="line">    manage.py  # é¡¹ç›®ç®¡ç†</span><br><span class="line">    mysite/    # åŒ…å</span><br><span class="line">        __init__.py  # ä½œä¸º Python åŒ…çš„æ ‡è®°</span><br><span class="line">        settings.py  # é¡¹ç›®è®¾ç½®</span><br><span class="line">        urls.py      # ç›¸å½“äº Spring çš„ Controller</span><br><span class="line">        asgi.py</span><br><span class="line">        wsgi.py</span><br></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py runserver</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py runserver 8001</span></span><br></pre></td></tr></table></figure><ul><li>runserverï¼šDjango æ ¹æ® manage.py åçš„å‚æ•°æ¥å¯åŠ¨</li></ul><p>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š</p><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1:8000/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1:8001/</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæŠ•ç¥¨åº”ç”¨"><a href="#åˆ›å»ºæŠ•ç¥¨åº”ç”¨" class="headerlink" title="åˆ›å»ºæŠ•ç¥¨åº”ç”¨"></a>åˆ›å»ºæŠ•ç¥¨åº”ç”¨</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py startapp polls</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py startapp polls</span></span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤å…³é”®å­—ï¼š<strong>startapp</strong></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysite/</span><br><span class="line">    manage.py  # </span><br><span class="line">    mysite/    # åŒ…å</span><br><span class="line">        __init__.py  # ä½œä¸º Python åŒ…çš„æ ‡è®°</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py      # ç›¸å½“äº Spring çš„ Controller</span><br><span class="line">        asgi.py</span><br><span class="line">        wsgi.py</span><br><span class="line">    polls/     # åº”ç”¨ç›®å½•</span><br><span class="line">    migrations/  # å­˜æ”¾ã€Œè¿ç§»ã€æ–‡ä»¶</span><br><span class="line">        urls.py</span><br><span class="line">        apps.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># apps.py</span></span><br><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PollsConfig</span><span class="params">(AppConfig)</span>:</span></span><br><span class="line">    name = <span class="string">'polls'</span>  <span class="comment"># Python åŒ…å</span></span><br></pre></td></tr></table></figure><h2 id="è§†å›¾å±‚"><a href="#è§†å›¾å±‚" class="headerlink" title="è§†å›¾å±‚"></a>è§†å›¾å±‚</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br></pre></td></tr></table></figure><p>Django 3.1</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># polls/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),  <span class="comment"># '' å¯¹åº” /polls/</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysite/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>Django 3.1 path() ç¬¬ä¸€ä¸ªå‚æ•°ä¸º route</li></ul><p>Django 1.11 éœ€è¦æ–°å¢ urls.pyï¼Œpath æ ¼å¼ç•¥å¾®ä¸åŒ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># polls/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^$'</span>, views.index, name=<span class="string">'index'</span>), <span class="comment"># ^ è¡¨ç¤ºè¡Œçš„å¼€å¤´ï¼Œ$ è¡¨ç¤ºè¡Œçš„ç»“æŸ</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysite/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>Django 1.11 path() ç¬¬ä¸€ä¸ªå‚æ•°ä¸º regex</li></ul><p>å¯åŠ¨ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py runsever</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py runsever</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">8000</span><span class="regexp">/polls/</span>  <span class="comment"># polls/ å¯¹åº” polls.urls</span></span><br><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">8001</span><span class="regexp">/polls/</span>  <span class="comment"># polls/ å¯¹åº” polls.urls</span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡å‹å±‚"><a href="#æ¨¡å‹å±‚" class="headerlink" title="æ¨¡å‹å±‚"></a>æ¨¡å‹å±‚</h2><ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial02/" target="_blank" rel="noopener">ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ª Django åº”ç”¨ï¼Œç¬¬ 2 éƒ¨åˆ†</a></li><li><a href="https://docs.djangoproject.com/zh-hans/3.1/topics/db/models/#meta-options" target="_blank" rel="noopener">æ¨¡å‹</a></li></ul><p>åœ¨ Django é‡Œå†™ä¸€ä¸ªä½¿ç”¨æ•°æ®åº“çš„ Web åº”ç”¨çš„ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰æ¨¡å‹ï¼ŒDjango éµå¾ª <a href="https://docs.djangoproject.com/zh-hans/3.1/misc/design-philosophies/#dry" target="_blank" rel="noopener">DRY Principle</a>ï¼ˆä¸è¦é‡å¤åœ°é€ è½®å­ Donâ€™t repeat yourselfï¼‰ã€‚Django é»˜è®¤ä½¿ç”¨  SQLite æ•°æ®åº“ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysite/settings.py</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.sqlite3'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: BASE_DIR / <span class="string">'db.sqlite3'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># polls/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)  <span class="comment"># charï¼Œæœ€é•¿é•¿åº¦ä¸º 200</span></span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)  <span class="comment"># date_timeï¼Œé»˜è®¤å€¼ä¸º date published?</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)  <span class="comment"># å¤–é”®ï¼ŒChoice å…³è” Question</span></span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">300</span>)  <span class="comment"># charï¼Œæœ€é•¿é•¿åº¦ä¸º 200</span></span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª Modelï¼ˆæ¨¡å‹ï¼‰å¯¹åº”ä¸€ä¸ªè¡¨ï¼Œä¸€ä¸ª Field å¯¹åº”ä¸€ä¸ªè¡¨å­—æ®µ</p><blockquote><p>Question ä¸º <a href="https://docs.djangoproject.com/zh-hans/3.1/ref/models/instances/#django.db.models.Model" target="_blank" rel="noopener"><code>django.db.models.Model</code></a> ç±»çš„å­ç±»ï¼Œquestion_text ä¸º Field çš„å­ç±»</p></blockquote><p>åœ¨ settings.py ä¸­é…ç½®æˆ‘ä»¬æ·»åŠ çš„ polls App</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'polls.apps.PollsConfig'</span>,  <span class="comment"># PollsConfig ç±»å†™åœ¨æ–‡ä»¶ polls/apps.py ä¸­</span></span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="migrateã€Œè¿ç§»ã€"><a href="#migrateã€Œè¿ç§»ã€" class="headerlink" title="migrateã€Œè¿ç§»ã€"></a>migrateã€Œè¿ç§»ã€</h3><p>æ‰§è¡Œ makemigrations å‘½ä»¤ï¼Œå°†æ ¹æ® models.py ç”Ÿæˆä¸€ä¸ªå¯¹æ•°æ®åº“ä¿®æ”¹çš„è®°å½•ï¼Œç§°ä¸ºã€Œè¿ç§»ã€ï¼Œä¿®æ”¹ models.py åï¼Œå¤šæ¬¡æ‰§è¡Œï¼Œå°†ç”Ÿæˆå¤šä¸ªã€Œè¿ç§»ã€</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py makemigrations polls</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py makemigrations polls</span></span><br></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">mysite/</span><br><span class="line">    manage.py  # </span><br><span class="line">    mysite/    # åŒ…å</span><br><span class="line">...</span><br><span class="line">    polls/</span><br><span class="line">    migrations/</span><br><span class="line">        <span class="number">0001</span>_initial.py</span><br><span class="line">        <span class="number">0002</span>_auto_20201116_1316.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 0001_initial.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Migration</span><span class="params">(migrations.Migration)</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ sqlmigrate å‘½ä»¤æŸ¥çœ‹ã€Œè¿ç§»ã€å¯¹åº”çš„ SQL</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py sqlmigrate polls 0001</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py sqlmigrate polls 0001</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿ç§»æ–‡ä»¶ï¼Œç›¸å½“äºæ‰§è¡Œå¯¹åº” sqlï¼Œå°†æ›´æ–°æ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py migrate</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py migrate</span></span><br></pre></td></tr></table></figure><ul><li>æ•°æ®ä¿å­˜åœ¨ db.sqlite3 è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Ÿ</li><li>é¡¹ç›®å¯åŠ¨åï¼Œå°†ç›´æ¥æ‰§è¡Œå¯¹ model çš„ä¿®æ”¹ã€‚ç›¸å½“äºæ‰§è¡Œ migrateï¼Œä½†ä¸æ‰§è¡Œ makemigrationsï¼Ÿé‡å¯é¡¹ç›®ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œ migrate ç›¸å…³å‘½ä»¤ï¼ˆä¿®æ”¹äº† comment æ”¹ä¸ºäº† artical_commentï¼Œç›´æ¥ä¿®æ”¹ comment æŠ¥é”™ï¼‰</li><li>ä½¿ç”¨ migrate çš„å¥½å¤„æ˜¯ï¼Ÿ</li></ul><!--éœ€è¦é¦–å…ˆæ‰§è¡Œä¸€ä¸‹ï¼š`python3 manage.py migrate` å¦åˆ™å°†æŠ¥ä¸‹é¢è¿™ä¸ªé”™è¯¯?--><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">(ENV) [18:50:42] ~/workspace/demo-project git(master) â±â±â± python manage.py runserver</span><br><span class="line">WARNING:root:[cy_settings] IS_FOR_TESTCASE=True, configcenter setup for testcase</span><br><span class="line">WARNING:root:[cy_settings] IS_FOR_TESTCASE=True, configcenter setup for testcase</span><br><span class="line">Performing system checks...</span><br><span class="line"></span><br><span class="line">System <span class="keyword">check</span> <span class="keyword">identified</span> <span class="keyword">no</span> issues (<span class="number">0</span> silenced).</span><br><span class="line"></span><br><span class="line">You have <span class="number">13</span> unapplied <span class="keyword">migration</span>(s). Your <span class="keyword">project</span> may <span class="keyword">not</span> <span class="keyword">work</span> properly <span class="keyword">until</span> you <span class="keyword">apply</span> the migrations <span class="keyword">for</span> app(s): <span class="keyword">admin</span>, auth, contenttypes, sessions.</span><br><span class="line">Run <span class="string">'python manage.py migrate'</span> <span class="keyword">to</span> <span class="keyword">apply</span> them.</span><br></pre></td></tr></table></figure><h2 id="Admin"><a href="#Admin" class="headerlink" title="Admin"></a>Admin</h2><p>Admin ä¸º Django è‡ªå¸¦åº”ç”¨ï¼Œé»˜è®¤åœ¨å¯åŠ¨æ—¶ä¹Ÿå°†å¯åŠ¨</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'polls.apps.PollsConfig'</span>,  </span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,   </span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysite/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>æ‰€ä»¥ä½¿ç”¨ <a href="http://localhost:8000/admin/" target="_blank" rel="noopener">http://localhost:8000/admin/</a> å¯æ‰“å¼€ admin</li></ul><p>åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py createsuperuser</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py createsuperuser</span></span><br></pre></td></tr></table></figure><p>åœ¨ admin ä¸­æ˜¾ç¤ºæ¨¡å‹ï¼Œç”¨äºå›¾å½¢åŒ–ç®¡ç†æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure><ul><li>ä¸ç”¨é‡å¯</li></ul><p>åœ¨è§†å›¾å±‚ä½¿ç”¨æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    output = <span class="string">', '</span>.join([q.question_text <span class="keyword">for</span> q <span class="keyword">in</span> latest_question_list])</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(output)</span><br></pre></td></tr></table></figure><p><a href="http://localhost:8000/polls/ï¼Œæµè§ˆå™¨è¾“å‡º" target="_blank" rel="noopener">http://localhost:8000/polls/ï¼Œæµè§ˆå™¨è¾“å‡º</a></p><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">What<span class="symbol">'s</span> up</span><br></pre></td></tr></table></figure><h2 id="API-Shell"><a href="#API-Shell" class="headerlink" title="API / Shell"></a>API / Shell</h2><ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial02/#playing-with-the-api" target="_blank" rel="noopener">åˆè¯• API</a></li></ul><p>è¿›å…¥ shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 manage.py shell</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python manage.py shell</span></span><br></pre></td></tr></table></figure><p>shell å‘½ä»¤ï¼šæŸ¥ã€å¢ã€æ”¹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; from polls.models import Choice, Question</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Question.objects.all()  <span class="comment"># æ˜¾ç¤º Question æ‰€æœ‰æ•°æ®</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; from django.utils import timezone</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q = Question(question_text=<span class="string">"What's new?"</span>, pub_date=timezone.now())</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q.save() <span class="comment"># æ’å…¥ä¸€æ¡æ•°æ®</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q.id</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q.question_text</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q.pub_date</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q.question_text = <span class="string">"What's up?"</span> <span class="comment"># ä¿®æ”¹å­—æ®µ</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; q.save()</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Question.objects.all()</span></span><br></pre></td></tr></table></figure><p>ä¸ºæ¨¡å‹æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.question_text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.pub_date &gt;= timezone.now() - datetime.timedelta(days=<span class="number">1</span>) <span class="comment"># æ—¶é—´å°äºä¸€å¤©</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.choice_text</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ï¼Œshell å‘½ä»¤ï¼šæŸ¥ã€å¢ã€å¤–é”®</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; from polls.models import Choice, Question</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; Question.objects.all()</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; Question.objects.filter(id=<span class="number">1</span>)  <span class="comment"># æ ¹æ® id è¿‡æ»¤</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; Question.objects.filter(question_text__startswith=<span class="string">'What'</span>)  <span class="comment"># question_text åŒ¹é…å¼€å§‹å­—ç¬¦</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; from django.utils import timezone</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; current_year = timezone.now().year</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; Question.objects.get(pub_date__year=current_year) <span class="comment"># åŒ¹é…å¹´é™</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; Question.objects.get(id=<span class="number">2</span>) <span class="comment"># DoesNotExist</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; Question.objects.get(pk=<span class="number">1</span>) <span class="comment"># primary-key ä¸º 1</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; q = Question.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; q.was_published_recently() <span class="comment"># é—´éš”å¹´é™å°äº 1 å¹´ï¼ŒTrue</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; q.choice_set.all()         <span class="comment"># è·Ÿ q ç›¸å…³çš„ Choice é›†åˆ</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; q.choice_set.create(choice_text=<span class="string">'Not much'</span>, votes=<span class="number">0</span>)</span><br><span class="line">&lt;<span class="symbol">Choice:</span> Not much&gt;</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; q.choice_set.create(choice_text=<span class="string">'The sky'</span>, votes=<span class="number">0</span>)</span><br><span class="line">&lt;<span class="symbol">Choice:</span> The sky&gt;</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; c = q.choice_set.create(choice_text=<span class="string">'Just hacking again'</span>, votes=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; c.question </span><br><span class="line">&lt;<span class="symbol">Question:</span> What<span class="string">'s up?&gt;         # 3 ä¸ª choice éƒ½å…³è” question</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; Choice.objects.all()</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; q.choice_set.all()</span></span><br><span class="line"><span class="string">&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;  # å…³è” q çš„æœ‰ 3 ä¸ª choice</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; q.choice_set.count()</span></span><br><span class="line"><span class="string">3</span></span><br></pre></td></tr></table></figure><!--è§£å†³ç–‘é—®--><!--1ã€First Stepsï¼›2ã€The Model Layerï¼›3ã€The View Layerï¼›4ã€The Admin-->]]></content:encoded>
      
      <comments>https://depp.wang/2020/11/17/django-getting-started-notes/#disqus_thread</comments>
    </item>
    
    <item>
      <title>JVM å¯åŠ¨å‚æ•°è®¾ç½®</title>
      <link>https://depp.wang/2020/11/10/jvm-startup-options-setting/</link>
      <guid>https://depp.wang/2020/11/10/jvm-startup-options-setting/</guid>
      <pubDate>Tue, 10 Nov 2020 21:48:08 GMT</pubDate>
      <description>
      
        &lt;p&gt;å…¬å¸é¡¹ç›® jdk ç‰ˆæœ¬ä¸º 1.8ï¼Œ JVM å‚æ•°æ˜¯è‡ªå®šä¹‰è®¾ç½®çš„ï¼Œgradle ä¸­ JVM é…ç½®å¦‚ä¸‹ï¼ˆé»˜è®¤å†…å­˜ä¸º 8 Gï¼‰ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;applicationDefaultJvmArgs = [&lt;span class=&quot;string&quot;&gt;&quot;-Xms1G&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-Xmx2G&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-Xss256k&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-Djava.awt.headless=true&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-Dfile.encoding=UTF-8&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                             &lt;span class=&quot;string&quot;&gt;&quot;-XX:MetaspaceSize=256M&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:+UseG1GC&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:MaxGCPauseMillis=200&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:G1HeapRegionSize=2M&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                             &lt;span class=&quot;string&quot;&gt;&quot;-XX:+UseStringDeduplication&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:+PrintStringDeduplicationStatistics&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                             &lt;span class=&quot;string&quot;&gt;&quot;-XX:ParallelGCThreads=4&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:ConcGCThreads=2&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:MaxDirectMemorySize=1024M&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                             &lt;span class=&quot;string&quot;&gt;&quot;-XX:+PrintGCDetails&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:+PrintGCDateStamps&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-Xloggc:/tmp/gc.log&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:+PrintTenuringDistribution&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                             &lt;span class=&quot;string&quot;&gt;&quot;-XX:+DoEscapeAnalysis&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-XX:+EliminateAllocations&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;-Dlogging.config=File:/config/logback.xml&quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>å…¬å¸é¡¹ç›® jdk ç‰ˆæœ¬ä¸º 1.8ï¼Œ JVM å‚æ•°æ˜¯è‡ªå®šä¹‰è®¾ç½®çš„ï¼Œgradle ä¸­ JVM é…ç½®å¦‚ä¸‹ï¼ˆé»˜è®¤å†…å­˜ä¸º 8 Gï¼‰ï¼š</p><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">applicationDefaultJvmArgs = [<span class="string">"-Xms1G"</span>, <span class="string">"-Xmx2G"</span>, <span class="string">"-Xss256k"</span>, <span class="string">"-Djava.awt.headless=true"</span>, <span class="string">"-Dfile.encoding=UTF-8"</span>,</span><br><span class="line">                             <span class="string">"-XX:MetaspaceSize=256M"</span>, <span class="string">"-XX:+UseG1GC"</span>, <span class="string">"-XX:MaxGCPauseMillis=200"</span>, <span class="string">"-XX:G1HeapRegionSize=2M"</span>,</span><br><span class="line">                             <span class="string">"-XX:+UseStringDeduplication"</span>, <span class="string">"-XX:+PrintStringDeduplicationStatistics"</span>,</span><br><span class="line">                             <span class="string">"-XX:ParallelGCThreads=4"</span>, <span class="string">"-XX:ConcGCThreads=2"</span>, <span class="string">"-XX:MaxDirectMemorySize=1024M"</span>,</span><br><span class="line">                             <span class="string">"-XX:+PrintGCDetails"</span>, <span class="string">"-XX:+PrintGCDateStamps"</span>, <span class="string">"-Xloggc:/tmp/gc.log"</span>, <span class="string">"-XX:+PrintTenuringDistribution"</span>,</span><br><span class="line">                             <span class="string">"-XX:+DoEscapeAnalysis"</span>, <span class="string">"-XX:+EliminateAllocations"</span>, <span class="string">"-Dlogging.config=File:/config/logback.xml"</span>]</span><br></pre></td></tr></table></figure><a id="more"></a><p>å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼š</p><ul><li>-Xms1Gï¼šå †çš„åˆå§‹å†…å­˜å®¹é‡ä¸º 1G</li><li>-Xmx2Gï¼šå †çš„æœ€å¤§å†…å­˜å®¹é‡ä¸º 2G</li><li>-Xss256kï¼šJava æ ˆçš„å®¹é‡ä¸º 256Kï¼ˆä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼‰ï¼Œ<a href="https://depp.wang/2020/11/06/customize-global-exception-handler-java/#%E6%B5%8B%E8%AF%95-Error">ç»æµ‹è¯•</a>ï¼Œæ­¤æ—¶æ ˆçš„é«˜åº¦å¯ä»¥è¾¾åˆ° 1500+</li><li>-Djava.awt.headless=trueï¼šjava.awt ä¸‹çš„ç±»ä½¿ç”¨æ— å¤´æ¨¡å¼ï¼Œ<a href="https://stackoverflow.com/questions/41067235/what-is-the-benefit-of-setting-java-awt-headless-true" target="_blank" rel="noopener">è·Ÿ GUI ç›¸å…³</a></li><li>-Dfile.encoding=UTF-8ï¼šæ–‡ä»¶ç¼–ç ä¸º UTF-8ï¼Œ<a href="https://stackoverflow.com/questions/1006276/what-is-the-default-encoding-of-the-jvm" target="_blank" rel="noopener">ä¸æŒ‡å®šæ—¶é»˜è®¤ä½¿ç”¨ç³»ç»Ÿçš„æ–‡ä»¶ç¼–ç </a></li><li>MetaspaceSize=256Mï¼šå…ƒæ•°æ®åŒºå®¹é‡ä¸º 256Mï¼Œé»˜è®¤æ˜¯-1ï¼Œå³ä¸é™åˆ¶ï¼Œæˆ–è€…è¯´åªå—é™äºæœ¬åœ°å†…å­˜å¤§å°</li><li>-XX:+UseG1GCï¼šå †å›æ”¶ä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨</li><li>-XX:MaxGCPauseMillis=200ï¼šG1 å‚æ•°ï¼ŒGC å‘ç”Ÿä¹‹å‰æœ€å¤§åœé¡¿æ—¶é—´ä¸º 200 msï¼Œè¿™æ˜¯ä¸€ä¸ªè½¯ç›®æ ‡ï¼ŒJVM å°†å°½æœ€å¤§åŠªåŠ›å®ç°</li><li>-XX:+UseStringDeduplicationï¼šæ¶ˆé™¤å…·æœ‰ç›¸åŒå­—ç¬¦çš„é‡å¤ String å¯¹è±¡</li><li>-XX:+PrintStringDeduplicationStatisticsï¼šString é‡å¤æ•°æ®åˆ é™¤ç»Ÿè®¡åˆ†æï¼Œç›¸å…³ç»Ÿè®¡åˆ†æå°†è¾“å‡ºåˆ°é”™è¯¯æ§åˆ¶å°</li><li>-XX:ParallelGCThreads=4ï¼šG1 å‚æ•°ï¼Œåƒåœ¾æ”¶é›†å™¨å¹¶è¡Œé˜¶æ®µä½¿ç”¨çº¿ç¨‹ä¸º 4 ä¸ªï¼Œé»˜è®¤å€¼æ ¹æ® JVM è¿è¡Œçš„å¹³å°è€Œå®š</li><li>-XX:ConcGCThreads=2ï¼šG1 å‚æ•°ï¼Œå¹¶å‘åƒåœ¾æ”¶é›†å™¨å°†ä½¿ç”¨çš„çº¿ç¨‹æ•°ä¸º 2 ä¸ªï¼Œé»˜è®¤å€¼æ ¹æ® JVM è¿è¡Œçš„å¹³å°è€Œå®š</li><li>-XX:MaxDirectMemorySize=1024Mï¼šæœ€å¤§ç›´æ¥å†…å­˜ä¸º 1024Mï¼Œé»˜è®¤ä¸ Java å †æœ€å¤§å€¼ï¼ˆç”±-Xmx æŒ‡å®šï¼‰ä¸€è‡´</li><li>-XX:+PrintGCDetailsï¼šæ¯æ¬¡åƒåœ¾å›æ”¶å®Œæˆåï¼Œæ‰“å°ä¸€æ¡å¸¦æœ‰æ›´å¤šè¯¦ç»†ä¿¡æ¯çš„é•¿æ¶ˆæ¯</li><li>-XX:+PrintGCDateStampsï¼šå‘ç”Ÿåƒåœ¾å›æ”¶æ—¶ï¼Œæ‰“å°ç›¸å¯¹äº JVM å¯åŠ¨æ—¶é—´çš„æ—¶é—´æˆ³ï¼Œé»˜è®¤å…³é—­</li><li>-Xloggc:/tmp/gc.logï¼šå°† GC è¯¦ç»†è¾“å‡ºè®°å½•åˆ°æŒ‡å®šæ–‡ä»¶ /tmp/gc.logï¼Œ</li><li>-XX:+PrintTenuringDistributionï¼šå¼€å¯å¯æ‰“å°ä»»èŒï¼ˆå­˜æ´»ï¼‰å¹´é¾„ä¿¡æ¯ï¼Œé»˜è®¤å…³é—­</li><li>-XX:+DoEscapeAnalysisï¼šå…³é—­<a href="https://stackoverflow.com/questions/771430/escape-analysis-in-java" target="_blank" rel="noopener">è½¬ä¹‰åˆ†æçš„ä½¿ç”¨</a>ï¼Œé»˜è®¤å¼€å¯</li><li>-XX:+EliminateAllocationsï¼šå…³é—­<a href="https://stackoverflow.com/questions/38613390/what-does-the-java-option-xx-eliminateallocations-do" target="_blank" rel="noopener">å˜é‡æ›¿æ¢ä¼˜åŒ–</a>ï¼Œé»˜è®¤å¼€å¯</li><li>-Dlogging.config=File:/config/logback.xmlï¼šlog æ—¥å¿—ä½¿ç”¨ config ä¸‹çš„ logback.xml é…ç½®æ–‡ä»¶</li></ul><p>å‚æ•°å«ä¹‰æ¥æºï¼š</p><ul><li><a href="https://www.oracle.com/java/technologies/javase/vmoptions-jsp.html" target="_blank" rel="noopener">Java HotSpot VM Options</a></li><li><a href="https://weread.qq.com/web/reader/cf1320d071a1a78ecf19254k4e73277021a4e732ced3b55" target="_blank" rel="noopener">3.7.4 åƒåœ¾æ”¶é›†å™¨å‚æ•°æ€»ç»“</a></li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">Java Platform, Standard Edition Tools Reference</a></li></ul><p>æŸ¥çœ‹ <code>-X</code> å¼€å¤´å‚æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -X</span></span><br><span class="line"></span><br><span class="line">    -Xms&lt;size&gt;        set initial Java heap size</span><br><span class="line">    -Xmx&lt;size&gt;        set maximum Java heap size</span><br><span class="line">    -Xss&lt;size&gt;        set java thread stack size</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰ <code>-XX:</code> å¼€å¤´å‚æ•°çš„é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -XX:+PrintFlagsFinal -version</span></span><br></pre></td></tr></table></figure><h2 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h2><p>64 ä½çš„è™šæ‹Ÿæœºé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯<code>æœåŠ¡ç«¯æ¨¡å¼</code>ï¼Œé€šè¿‡ <code>java -version</code> å¯ä»¥çœ‹å‡ºï¼ˆServerï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -version</span></span><br><span class="line">java version "1.8.0_191"</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_191-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)</span><br></pre></td></tr></table></figure><p>JDK 1.8 é»˜è®¤ JVM å‚æ•°ï¼šåˆå§‹å®¹é‡ Xms 128Mï¼Œæœ€å¤§å®¹é‡ Xmx 2Gï¼Œä½¿ç”¨ <code>-XX:+UseParallelGC</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -XX:+PrintCommandLineFlags -version</span></span><br><span class="line">-XX:InitialHeapSize=134217728 -XX:MaxHeapSize=2147483648 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC</span><br><span class="line">java version "1.8.0_191"</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_191-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)</span><br></pre></td></tr></table></figure><p>æ ¹æ® <a href="https://www.zhihu.com/question/56344485" target="_blank" rel="noopener">RednaxelaFX</a> çš„å›ç­”ï¼Œè™½ç„¶ jconsole æ˜¾ç¤ºä½¿ç”¨ <code>-XX:+UseParallelGC</code> æ—¶ï¼Œä½† jdk 1.8 é»˜è®¤ä¼šå¼€å¯ <code>XX:+UseParallelOldGC</code>ã€‚  æ­¤æ—¶æ”¶é›†å™¨ä½¿ç”¨ <code>Parallel Scavenge + Parallel Old</code> ç»„åˆã€‚</p><p>æ­¤ç§ç»„åˆé€‚ç”¨äºæ³¨é‡ååé‡æˆ–è€…å¤„ç†å™¨èµ„æºè¾ƒä¸ºç¨€ç¼ºçš„åœºåˆã€‚</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-11-10-072145.jpg" alt="img"></p><p>jdk1.8 å¯ä»¥ä½¿ç”¨æ›´ä¸ºå…ˆè¿›çš„æ”¶é›†å™¨ G1ï¼ˆGarbage Firstï¼‰ï¼Œå®ƒæ˜¯ JDK 9 æœåŠ¡ç«¯æ¨¡å¼é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ã€‚G1 ä¹Ÿæ˜¯éµå¾ªåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡ï¼Œå®ƒå°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸ª Region éƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ‰®æ¼”æ–°ç”Ÿä»£çš„ Eden ç©ºé—´ã€Survivor ç©ºé—´ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ã€‚å›æ”¶æ—¶ï¼Œä¸åƒå…¶ä»–æ”¶é›†å™¨ï¼Œåªé’ˆå¯¹æŸä¸ªåŒºåŸŸï¼ŒMajor GCï¼ˆæ–°ç”Ÿä»£ï¼‰æˆ– Full GCï¼ˆè€å¹´ä»£ï¼‰æˆ– Full GCï¼ˆæ•´ä¸ªå †ï¼‰ï¼Œè€Œæ˜¯å°†å¤šä¸ª Region ç»„æˆå›æ”¶é›†ï¼ˆCollection Setï¼‰è¿›è¡Œå›æ”¶ï¼ˆMixedGCï¼‰ã€‚</p><p>G1 æ”¶é›†å™¨è·Ÿè¸ªæ¯ä¸ª Region é‡Œé¢çš„åƒåœ¾å †ç§¯çš„ã€Œä»·å€¼ã€å¤§å°ï¼Œä»·å€¼å³å›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼Œç„¶ååœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œå†æ ¹æ®ç”¨æˆ·è®¾å®šå…è®¸çš„æ”¶é›†åœé¡¿æ—¶é—´ï¼ˆMaxGCPauseMillisï¼‰ï¼Œä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æ”¶ç›Šæœ€å¤§çš„é‚£äº› Regionï¼Œè¿™ä¹Ÿå°±æ˜¯ ã€ŒGarbage Firstã€åå­—çš„ç”±æ¥ã€‚å›æ”¶æ—¶ï¼Œä¸è¿½æ±‚ä¸€æ¬¡æŠŠ Java å †å…¨éƒ¨æ¸…ç†å¹²å‡€ï¼Œè€Œæ˜¯è¿½æ±‚èƒ½å¤Ÿåº”ä»˜åº”ç”¨çš„å†…å­˜åˆ†é…é€Ÿç‡ï¼ˆAllocation Rateï¼‰ï¼Œåªè¦æ”¶é›†çš„é€Ÿåº¦èƒ½è·Ÿå¾—ä¸Šå¯¹è±¡åˆ†é…çš„é€Ÿåº¦å°±è¡Œã€‚</p><p>G1 ç›¸æ¯” <code>Parallel Scavenge + Parallel Old</code> ç»„åˆçš„æœ€å¤§ä¼˜ç‚¹ï¼šå¯ä»¥æŒ‡å®šæœ€å¤§æ”¶é›†åœé¡¿æ—¶é—´æ¥è°ƒèŠ‚ã€‚</p><h2 id="Maven-é¡¹ç›®å¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°"><a href="#Maven-é¡¹ç›®å¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°" class="headerlink" title="Maven é¡¹ç›®å¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°"></a>Maven é¡¹ç›®å¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°</h2><p>åˆ©ç”¨ Maven Wrapperï¼Œåœ¨ <code>.mvn/jvm.config</code> ä¸­é…ç½®ï¼š</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">-Xms1G -Xmx2G -Xss256k -Djava.awt.<span class="attribute">headless</span>=<span class="literal">true</span> -Dfile.<span class="attribute">encoding</span>=UTF-8 -XX:<span class="attribute">MetaspaceSize</span>=256M -XX:+UseG1GC -XX:<span class="attribute">MaxGCPauseMillis</span>=200 <span class="built_in">..</span>.</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…æ—¶ä½¿ç”¨ <code>mvnw</code> å‘½ä»¤ï¼Œå¦‚ï¼š<code>mvnw clean package</code></p><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="http://alvinalexander.com/blog/post/java/java-xmx-xms-memory-heap-size-control/" target="_blank" rel="noopener">How to control Java heap size (memory) allocation (xmx, xms)</a></li><li><a href="https://www.cnblogs.com/grey-wolf/p/9217497.html" target="_blank" rel="noopener">æŸ¥çœ‹ JVM ä½¿ç”¨çš„é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨</a></li><li><a href="https://dzone.com/articles/usestringdeduplication" target="_blank" rel="noopener">UseStringDeduplication: Pros and Cons</a></li><li><a href="http://www.herongyang.com/JVM/Memory-PrintGCDetails-Garbage-Collection-Logging.html" target="_blank" rel="noopener">â€œ-XX:+PrintGCDetailsâ€ - Garbage Collection Logging</a></li><li><a href="https://www.logicbig.com/how-to/java-command/jvm-option-list.html" target="_blank" rel="noopener">Java - Print list of all -XX JVM options</a></li><li><a href="https://docs.oracle.com/cd/E26576_01/doc.312/e24938/list-jvm-options.htm#GSRFM00180" target="_blank" rel="noopener">list-jvm-options</a></li><li><a href="https://geekflare.com/important-jvm-options/" target="_blank" rel="noopener">10 Important JVM Options for Production JAVA Application System</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/11/10/jvm-startup-options-setting/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Java ä¸­çš„ TreeSet</title>
      <link>https://depp.wang/2020/11/07/treeset-in-java/</link>
      <guid>https://depp.wang/2020/11/07/treeset-in-java/</guid>
      <pubDate>Sat, 07 Nov 2020 22:16:09 GMT</pubDate>
      <description>
      
        &lt;p&gt;TreeSet æ˜¯ä¸€ç§å¯æœ‰åºå­˜æ”¾å…ƒç´ çš„é›†åˆï¼ŒHashSet æ˜¯ value ä¸ºå›ºå®šå€¼çš„ HashMapï¼ŒTreeSet æ˜¯ value ä¸ºå›ºå®šå€¼å¾— TreeMapã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>TreeSet æ˜¯ä¸€ç§å¯æœ‰åºå­˜æ”¾å…ƒç´ çš„é›†åˆï¼ŒHashSet æ˜¯ value ä¸ºå›ºå®šå€¼çš„ HashMapï¼ŒTreeSet æ˜¯ value ä¸ºå›ºå®šå€¼å¾— TreeMapã€‚</p><a id="more"></a><h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">       â”Œâ”€â”€â”€â”</span><br><span class="line">       â”‚Mapâ”‚</span><br><span class="line">       â””â”€â”€â”€â”˜</span><br><span class="line">         â–²</span><br><span class="line">    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”</span><br><span class="line">    â”‚          â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚HashMapâ”‚ â”‚SortedMapâ”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">               â–²</span><br><span class="line">               â”‚</span><br><span class="line">          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">          â”‚ TreeMap â”‚</span><br><span class="line">          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>HashMap åˆ©ç”¨äº† hashCodeï¼ŒTreeMap åˆ™åˆ©ç”¨äº†æ ‘ï¼Œä¸€ä¸ªäºŒå‰æ ‘ã€‚</p><p><img src="https://contribute.geeksforgeeks.org/wp-content/uploads/Treemap3-5.png" alt="Treemap Internal Working"></p><h2 id="æ¯”è¾ƒ-Key"><a href="#æ¯”è¾ƒ-Key" class="headerlink" title="æ¯”è¾ƒ Key"></a>æ¯”è¾ƒ Key</h2><p>TreeMap çš„æœ‰åºé€šè¿‡æ¯”è¾ƒ key æ¥å®ç°ï¼Œæ— æ³•åˆ©ç”¨ hashCode æ¥æ¯”è¾ƒï¼Œå®ƒéœ€è¦æœ‰ä¸€ä¸ªæ¯”è¾ƒ key çš„è§„åˆ™ã€‚å¯é€šè¿‡ Key ç»§æ‰¿ Comparable æ¥å£æˆ–è®¾ç½® Comparator æ¥æä¾›ã€‚</p><h3 id="Integer"><a href="#Integer" class="headerlink" title="Integer"></a>Integer</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Integer anotherInteger)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> compare(<span class="keyword">this</span>.value, anotherInteger.value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹æ®å…ƒç´ å¤§å°æ¯”è¾ƒï¼Œ-1 å°äº anotherIntegerï¼Œ0 ç­‰äºï¼Œ1 å¤§äº</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (x &lt; y) ? -<span class="number">1</span> : ((x == y) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(String anotherString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> v1[] = value;</span><br><span class="line">        <span class="keyword">byte</span> v2[] = anotherString.value;</span><br><span class="line">        <span class="keyword">if</span> (coder() == anotherString.coder()) &#123;</span><br><span class="line">            <span class="keyword">return</span> isLatin1() ? StringLatin1.compareTo(v1, v2)</span><br><span class="line">                              : StringUTF16.compareTo(v1, v2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isLatin1() ? StringLatin1.compareToUTF16(v1, v2)</span><br><span class="line">                          : StringUTF16.compareToLatin1(v1, v2);</span><br><span class="line">     &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringLatin1</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(<span class="keyword">byte</span>[] value, <span class="keyword">byte</span>[] other, <span class="keyword">int</span> len1, <span class="keyword">int</span> len2)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åªæ¯”è¾ƒçŸ­çš„éƒ¨åˆ†</span></span><br><span class="line">        <span class="keyword">int</span> lim = Math.min(len1, len2);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; lim; k++) &#123;</span><br><span class="line">            <span class="comment">// è¿”å›ä¸åŒçš„å­—ç¬¦çš„ assic å·®å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (value[k] != other[k]) &#123;</span><br><span class="line">                <span class="keyword">return</span> getChar(value, k) - getChar(other, k);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“çŸ­éƒ¨åˆ†éƒ½ç›¸åŒæ—¶ï¼Œæ¯”è¾ƒé•¿åº¦</span></span><br><span class="line">        <span class="keyword">return</span> len1 - len2;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">getChar</span><span class="params">(<span class="keyword">byte</span>[] val, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">char</span>)(val[index] &amp; <span class="number">0xff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç±»"><a href="#è‡ªå®šä¹‰ç±»" class="headerlink" title="è‡ªå®šä¹‰ç±»"></a>è‡ªå®šä¹‰ç±»</h3><p><strong>ä½¿ç”¨ Comparator</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A class to represent a student. </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123; </span><br><span class="line">    <span class="keyword">int</span> rollno; </span><br><span class="line">    String name, address; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Constructor </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> rollno, String name, </span></span></span><br><span class="line"><span class="function"><span class="params">                   String address)</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.rollno = rollno; </span><br><span class="line">        <span class="keyword">this</span>.name = name; </span><br><span class="line">        <span class="keyword">this</span>.address = address; </span><br><span class="line">    &#125; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Used to print student details </span></span><br><span class="line">    <span class="comment">// in main() </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.rollno + <span class="string">" "</span></span><br><span class="line">            + <span class="keyword">this</span>.name + <span class="string">" "</span></span><br><span class="line">            + <span class="keyword">this</span>.address; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Comparator implementattion </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sortbyroll</span> </span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Student</span>&gt; </span>&#123; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Used for sorting in ascending order of </span></span><br><span class="line">    <span class="comment">// roll number </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Student a, Student b)</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> a.rollno - b.rollno; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeMapImplementation</span> </span>&#123; </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Example2ndConstructor</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="comment">// Creating an empty TreeMap </span></span><br><span class="line">        TreeMap&lt;Student, Integer&gt; tree_map </span><br><span class="line">            = <span class="keyword">new</span> TreeMap&lt;Student, Integer&gt;(<span class="keyword">new</span> Sortbyroll()); </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Mapping string values to int keys </span></span><br><span class="line">        tree_map.put(<span class="keyword">new</span> Student(<span class="number">111</span>, <span class="string">"bbbb"</span>, </span><br><span class="line">                                 <span class="string">"london"</span>), </span><br><span class="line">                     <span class="number">2</span>); </span><br><span class="line">        tree_map.put(<span class="keyword">new</span> Student(<span class="number">131</span>, <span class="string">"aaaa"</span>, </span><br><span class="line">                                 <span class="string">"nyc"</span>), </span><br><span class="line">                     <span class="number">3</span>); </span><br><span class="line">        tree_map.put(<span class="keyword">new</span> Student(<span class="number">121</span>, <span class="string">"cccc"</span>, </span><br><span class="line">                                 <span class="string">"jaipur"</span>), </span><br><span class="line">                     <span class="number">1</span>); </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Displaying the TreeMap </span></span><br><span class="line">        System.out.println(<span class="string">"TreeMap: "</span></span><br><span class="line">                           + tree_map); </span><br><span class="line">    &#125; </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">"TreeMap using "</span></span><br><span class="line">                           + <span class="string">"TreeMap(Comparator)"</span></span><br><span class="line">                           + <span class="string">" constructor:\n"</span>); </span><br><span class="line">        Example2ndConstructor(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TreeMap using TreeMap(Comparator) constructor:</span><br><span class="line"></span><br><span class="line">TreeMap: &#123;121 cccc jaipur=1, 131 aaaa nyc=3, 141 bbbb london=2&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ Comparable</strong> </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Student</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rollno;</span><br><span class="line">    String name, address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> rollno, String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                   String address)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rollno = rollno;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Student anotherStudent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.rollno - anotherStudent.rollno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to print student details</span></span><br><span class="line">    <span class="comment">// in main()</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.rollno + <span class="string">" "</span></span><br><span class="line">                + <span class="keyword">this</span>.name + <span class="string">" "</span></span><br><span class="line">                + <span class="keyword">this</span>.address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•æ’åº"><a href="#å¦‚ä½•æ’åº" class="headerlink" title="å¦‚ä½•æ’åº"></a>å¦‚ä½•æ’åº</h2><p>æ·»åŠ æ—¶ï¼Œè·Ÿ root èŠ‚ç‚¹æ¯”è¾ƒï¼Œå°äºæ”¾åˆ°å·¦è¾¹ï¼Œå¤§äºæ”¾åˆ°å³è¾¹ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; t = root;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">        compare(key, key); <span class="comment">// type (and possibly null) check</span></span><br><span class="line"></span><br><span class="line">        root = <span class="keyword">new</span> Entry&lt;&gt;(key, value, <span class="keyword">null</span>);</span><br><span class="line">        size = <span class="number">1</span>;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> cmp;</span><br><span class="line">    Entry&lt;K,V&gt; parent;</span><br><span class="line">    <span class="comment">// split comparator and comparable paths</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ„é€ å‡½æ•°è®¾ç½®äº† comparatorï¼Œcpr å°†ä¸ä¸º null</span></span><br><span class="line">    Comparator&lt;? <span class="keyword">super</span> K&gt; cpr = comparator;</span><br><span class="line">    <span class="keyword">if</span> (cpr != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            parent = t;</span><br><span class="line">            cmp = cpr.compare(key, t.key);</span><br><span class="line">            <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                t = t.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                t = t.right;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">        &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) <span class="comment">// è·å– key çš„ Comparable</span></span><br><span class="line">            Comparable&lt;? <span class="keyword">super</span> K&gt; k = (Comparable&lt;? <span class="keyword">super</span> K&gt;) key;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            parent = t;</span><br><span class="line">            cmp = k.compareTo(t.key);</span><br><span class="line">            <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                t = t.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                t = t.right;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">        &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Entry&lt;K,V&gt; e = <span class="keyword">new</span> Entry&lt;&gt;(key, value, parent);</span><br><span class="line">    <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">        parent.left = e;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        parent.right = e;</span><br><span class="line">    fixAfterInsertion(e);</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h2><p>é’ˆå¯¹äºŒå‰æ ‘ï¼Œ4 å±‚çš„æ€»èŠ‚ç‚¹ï¼š2^0^ + 2^1^ +  2^2^ + 2^3^  -&gt; 2^4^ï¼Œå¦‚æœæ ‘èŠ‚ç‚¹æ•°ä¸º nï¼Œæ ‘çš„é«˜åº¦ä¸º log(n)ã€‚</p><p>æ‰€ä»¥ TreeMap çš„æŸ¥æ‰¾å’Œæ–°å¢æ—¶é—´å¤æ‚åº¦ä¸º O(log(n))ã€‚</p><h2 id="vs-LinkedHashMap"><a href="#vs-LinkedHashMap" class="headerlink" title="vs LinkedHashMap"></a>vs LinkedHashMap</h2><p>LinkedHashMap ä½¿ç”¨ä¸€ä¸ªé¢å¤–åŒå‘é“¾è¡¨ï¼Œè®°å½•æ’å…¥é¡ºåºï¼Œæ‰€ä»¥å®ƒæ˜¯æ ¹æ®æ’å…¥é¡ºåºæ’åºã€‚</p><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1265117109276544" target="_blank" rel="noopener">ä½¿ç”¨ TreeMap</a></li><li><a href="https://www.geeksforgeeks.org/treemap-in-java/" target="_blank" rel="noopener">TreeMap in Java</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/11/07/treeset-in-java/#disqus_thread</comments>
    </item>
    
    <item>
      <title>è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆJavaï¼‰</title>
      <link>https://depp.wang/2020/11/06/customize-global-exception-handler-java/</link>
      <guid>https://depp.wang/2020/11/06/customize-global-exception-handler-java/</guid>
      <pubDate>Fri, 06 Nov 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;p&gt;æ­£å¸¸ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå½“å‰åç«¯åˆ†ç¦»æ—¶ï¼Œç³»ç»Ÿå³ä½¿æœ‰æœªçŸ¥å¼‚å¸¸ï¼Œä¹Ÿè¦ä¿è¯æ¥å£èƒ½è¿”å›é”™è¯¯æç¤ºï¼Œä¹Ÿéœ€è¦æ ¹æ®ä¸šåŠ¡è§„åˆ™åˆ¶å®šç›¸åº”çš„å¼‚å¸¸çŠ¶æ€ç å’Œå¼‚å¸¸æç¤ºã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€‚ç›¸å…³ä»£ç ï¼š&lt;a href=&quot;https://github.com/DeppWang/springboot-demos/tree/master/springboot-exception&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>æ­£å¸¸ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå½“å‰åç«¯åˆ†ç¦»æ—¶ï¼Œç³»ç»Ÿå³ä½¿æœ‰æœªçŸ¥å¼‚å¸¸ï¼Œä¹Ÿè¦ä¿è¯æ¥å£èƒ½è¿”å›é”™è¯¯æç¤ºï¼Œä¹Ÿéœ€è¦æ ¹æ®ä¸šåŠ¡è§„åˆ™åˆ¶å®šç›¸åº”çš„å¼‚å¸¸çŠ¶æ€ç å’Œå¼‚å¸¸æç¤ºã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€‚ç›¸å…³ä»£ç ï¼š<a href="https://github.com/DeppWang/springboot-demos/tree/master/springboot-exception" target="_blank" rel="noopener">GitHub</a></p><a id="more"></a><h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><p>ä¸‹é¢æ˜¯ Java å¼‚å¸¸ç»§æ‰¿å›¾ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                     â”‚  Object   â”‚</span><br><span class="line">                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                           â–²</span><br><span class="line">                           â”‚</span><br><span class="line">                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                     â”‚ Throwable â”‚</span><br><span class="line">                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                           â–²</span><br><span class="line">                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                 â”‚                   â”‚</span><br><span class="line">           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">           â”‚   Error   â”‚       â”‚ Exception â”‚</span><br><span class="line">           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                 â–²                   â–²</span><br><span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">         â”‚                      â”‚               â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚OutOfMemoryError â”‚... â”‚RuntimeException â”‚â”‚IOExceptionâ”‚...</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                â–²</span><br><span class="line">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                    â”‚                         â”‚</span><br><span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">         â”‚NullPointerException â”‚ â”‚IllegalArgumentException â”‚...</span><br><span class="line">         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç¼–è¯‘æ—¶æ˜¯å¦éœ€è¦æ•è·ï¼Œå¼‚å¸¸å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š1ã€å†™ä»£ç æ—¶ï¼Œç¼–è¯‘å™¨è§„å®šå¿…é¡»æ•è·çš„å¼‚å¸¸ï¼Œä¸æ•è·å°†æŠ¥é”™ï¼›2ã€ï¼ˆæŠ›å‡ºåï¼‰ä¸å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼Œç¼–è¯‘å™¨å¯¹æ­¤ç±»å¼‚å¸¸ä¸åšå¤„ç†ã€‚</p><ul><li><p>å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼šException ä»¥åŠ Exception é™¤å» RuntimeException çš„å­ç±»ã€‚</p></li><li><p>ä¸å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼šError ä»¥åŠ Error çš„å­ç±»ï¼›RuntimeException ä»¥åŠ RuntimeException çš„å­ç±»ã€‚</p></li></ul><p>å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/testThrowIOException"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title">testThrowIOException</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    testThrowIOException(); <span class="comment">// å°†æŠ¥é”™</span></span><br><span class="line">    <span class="keyword">return</span> ApiResponse.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">throwIOException</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"testThrowIOException"</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/testThrowRuntimeException"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title">testThrowRuntimeException</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    throwRuntimeException(); <span class="comment">// ä¸æŠ¥é”™</span></span><br><span class="line">    <span class="keyword">return</span> ApiResponse.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">throwRuntimeException</span><span class="params">()</span> </span>&#123; <span class="comment">// æ— éœ€ throws</span></span><br><span class="line">    System.out.println(<span class="string">"testThrowRuntimeException"</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡åœ¨è¿è¡Œæ—¶ï¼Œä»»ä½•å¼‚å¸¸éƒ½å¯ä»¥è¿›è¡Œæ•è·å¤„ç†ï¼Œé¿å…æ¥å£æ²¡æœ‰è¿”å›å€¼çš„æƒ…å†µã€‚</p><h3 id="æŠ›å¼‚å¸¸"><a href="#æŠ›å¼‚å¸¸" class="headerlink" title="æŠ›å¼‚å¸¸"></a>æŠ›å¼‚å¸¸</h3><p>å¸¸è§å¼‚å¸¸å¤„ç†æ–¹å¼æœ‰ä¸¤ç§ï¼Œ1ã€æ•è·åå¤„ç†ï¼Œ2ã€æŠ›å‡ºã€‚æŠ›å‡ºä¹Ÿåˆ†ä¸ºæ•è·åæŠ›å‡ºå’Œç›´æ¥æŠ›å‡ºã€‚</p><p>å½“æœ¬èº«æ²¡æœ‰å¼‚å¸¸ï¼Œå´ä½¿ç”¨ throws æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæ­¤æ—¶ç›¸å½“äºæ²¡æœ‰æŠ›å¼‚å¸¸ï¼ˆå°†æ‹¦æˆªä¸åˆ°å¼‚å¸¸ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/testThrowIOException2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title">testThrowIOException2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    throwIOException2();</span><br><span class="line">    <span class="keyword">return</span> ApiResponse.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">throwIOException2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"testThrowIOException"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰“å°å¼‚å¸¸"><a href="#æ‰“å°å¼‚å¸¸" class="headerlink" title="æ‰“å°å¼‚å¸¸"></a>æ‰“å°å¼‚å¸¸</h3><p>æ‰“å°å¼‚å¸¸å¯ä»¥ä½¿ç”¨ <a href="https://depp.wang/2020/10/30/logback-use-summary/">Logback</a> æ‰“å°ï¼Œå…¶ç›¸å…³æ–¹æ³•çš„ä½¿ç”¨ï¼š <code>log.error(e.getMessage(), e);</code> ç›¸å½“äºä¸‹é¢è¿™ä¸¤æ¡è¯­å¥ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(e.getMessage()); <span class="comment">// æ‰“å°å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">e.printStackTrace(); <span class="comment">// æ‰“å°å¼‚å¸¸è°ƒç”¨æ ˆ</span></span><br></pre></td></tr></table></figure><p>å‡å°‘ NullPointException çš„æ–¹å¼æ˜¯è®¾ç½®é»˜è®¤å€¼ã€‚</p><h3 id="æµ‹è¯•-Error"><a href="#æµ‹è¯•-Error" class="headerlink" title="æµ‹è¯• Error"></a>æµ‹è¯• Error</h3><p><strong>æµ‹è¯• StackOverflowError</strong>ï¼Œè®¾ç½®æ ˆçš„å¤§å°ä¸º 256Kï¼ŒIDEAï¼ˆVM optionsï¼‰ï¼š -Xss256kï¼›å‘½ä»¤è¡Œï¼š<code>java -Xss256k JavaVMStackSOF</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JavaVMStackSOF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> stackLength = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stackLeak</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stackLength++;</span><br><span class="line">        stackLeak();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        JavaVMStackSOF oom = <span class="keyword">new</span> JavaVMStackSOF();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            oom.stackLeak();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"stack length:"</span> + oom.stackLength);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">stack length:1693</span><br><span class="line">Exception in thread "main" java.lang.StackOverflowError</span><br><span class="line">at wang.depp.exception.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:10)</span><br><span class="line">at wang.depp.exception.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:11)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯• OutOfMemoryError</strong>ï¼Œè®¾ç½® Java å †çš„å¤§å°ä¸º 128Mï¼ŒIDEAï¼ˆVM optionsï¼‰ï¼š-Xms10M -Xmx10Mï¼›å‘½ä»¤è¡Œï¼š<code>java -Xms10M -Xmx10M wang.depp.exception.HeapOOM</code>ï¼ˆå¦‚æœç±»ä¸­åŒ…å« package è·¯å¾„ï¼Œéœ€ cd åˆ° <code>java</code> ç›®å½•åè¿è¡Œæ­¤å‘½ä»¤ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> wang.depp.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;OOMObject&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> OOMObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at java.base/java.util.Arrays.copyOf(Arrays.java:3720)</span><br><span class="line">at java.base/java.util.Arrays.copyOf(Arrays.java:3689)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="å…¨å±€å¼‚å¸¸å¤„ç†å™¨"><a href="#å…¨å±€å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="å…¨å±€å¼‚å¸¸å¤„ç†å™¨"></a>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</h2><h3 id="è‡ªå®šä¹‰å¼‚å¸¸"><a href="#è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸"></a>è‡ªå®šä¹‰å¼‚å¸¸</h3><p>è‡ªå®šä¹‰å¼‚å¸¸ä» RuntimeException æ´¾ç”Ÿï¼Œæ„é€ æ–¹æ³•ä½¿ç”¨ <code>super(message);</code> å’Œ <code>super(message, cause);</code>ã€‚æ·»åŠ çŠ¶æ€ç å’Œå‚æ•°å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code; <span class="comment">// çŠ¶æ€ç </span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> Object[] args; <span class="comment">// å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> IResponseEnum responseEnum;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseException</span><span class="params">(IResponseEnum iResponseEnum, Object[] args, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = iResponseEnum.getCode();</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">        <span class="keyword">this</span>.responseEnum = iResponseEnum;</span><br><span class="line">        <span class="keyword">this</span>.args = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseException</span><span class="params">(IResponseEnum iResponseEnum, Object[] args, String message, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">        <span class="keyword">this</span>.code = iResponseEnum.getCode();</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">        <span class="keyword">this</span>.responseEnum = iResponseEnum;</span><br><span class="line">        <span class="keyword">this</span>.args = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object[] getArgs() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IResponseEnum <span class="title">getResponseEnum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.responseEnum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰æœåŠ¡çš„ä¸šåŠ¡å¼‚å¸¸ä¸ç”¨æ¯ä¸ªå•ç‹¬ä½œä¸ºä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œå¯é€šè¿‡ message å’Œ code æ¥åšä¸€ä¸ªåŒºåˆ†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoanException</span> <span class="keyword">extends</span> <span class="title">BusinessException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoanException INTERNAL_ERROR = <span class="keyword">new</span> LoanException(ResponseEnum.SERVER_ERROR);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoanException REJECT = <span class="keyword">new</span> LoanException(ResponseEnum.REJECT);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoanException BAND_FAIL = <span class="keyword">new</span> LoanException(ResponseEnum.BAND_FAIL);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoanException FORBIDDEN = <span class="keyword">new</span> LoanException(ResponseEnum.FORBIDDEN);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoanException DB_OPTIMISTIC_LOCK = <span class="keyword">new</span> LoanException(ResponseEnum.DB_OPTIMISTIC_LOCK);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoanException</span><span class="params">(IResponseEnum responseEnum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(responseEnum, <span class="keyword">null</span>, responseEnum.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoanException</span><span class="params">(IResponseEnum responseEnum, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(responseEnum, <span class="keyword">null</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/testLoanException"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiResponse&lt;Void&gt; <span class="title">testLoanException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> LoanException.REJECT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä¸åŒçš„ä¸šåŠ¡é”™è¯¯åœºæ™¯è®¾ç½®ç›¸å…³æšä¸¾ç±»å‹ï¼ˆçŠ¶æ€ç ã€é”™è¯¯æç¤ºï¼‰ã€‚ä¸ºæšä¸¾æ·»åŠ å¯æ–­è¨€åˆ¤æ–­æŠ›å‡ºå¼‚å¸¸åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Assert</span> </span>&#123;</span><br><span class="line">    <span class="function">BaseException <span class="title">newException</span><span class="params">(Object... var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">BaseException <span class="title">newException</span><span class="params">(Throwable var1, Object... var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">assertNotNull</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">this</span>.newException((Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">assertNotNull</span><span class="params">(Object obj, Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">this</span>.newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">assertTrue</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">this</span>.newException((Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">assertTrue</span><span class="params">(<span class="keyword">boolean</span> flag, Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">this</span>.newException((Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BusinessExceptionAssert</span> <span class="keyword">extends</span> <span class="title">IResponseEnum</span>, <span class="title">Assert</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> BaseException <span class="title">newException</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">        String msg = MessageFormat.format(<span class="keyword">this</span>.getMessage(), args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BusinessException(<span class="keyword">this</span>, args, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> BaseException <span class="title">newException</span><span class="params">(Throwable t, Object... args)</span> </span>&#123;</span><br><span class="line">        String msg = MessageFormat.format(<span class="keyword">this</span>.getMessage(), args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BusinessException(<span class="keyword">this</span>, args, msg, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResponseEnum implements BusinessExceptionAssert &#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="number">111000</span>,<span class="string">"success"</span>),</span><br><span class="line">    PARAM_VALID_ERROR(<span class="number">111001</span>,<span class="string">"param check error."</span>),</span><br><span class="line">    SERVER_ERROR(<span class="number">111002</span>,<span class="string">"server error."</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="number">111003</span>,<span class="string">"login error"</span>),</span><br><span class="line">    UNAUTHORIZED(<span class="number">111004</span>, <span class="string">"unauthorized"</span>),</span><br><span class="line">    SERVICE_ERROR(<span class="number">111005</span>,<span class="string">"service error."</span>),</span><br><span class="line">    FORBIDDEN(<span class="number">114003</span>, <span class="string">"forbidden"</span>),</span><br><span class="line">    TIMEOUT(<span class="number">114000</span>, <span class="string">"timeout"</span>),</span><br><span class="line">    REJECT(<span class="number">114001</span>, <span class="string">"reject"</span>),</span><br><span class="line">    EMAIL_CONFLICT(<span class="number">114002</span>, <span class="string">"email conflict"</span>),</span><br><span class="line">    EMAIL_VERIFY_FAIL(<span class="number">114004</span>, <span class="string">"email verify fail"</span>),</span><br><span class="line">    DB_OPTIMISTIC_LOCK(<span class="number">114008</span>, <span class="string">"update fail"</span>),<span class="comment">// æ•°æ®åº“ä¹è§‚é”</span></span><br><span class="line">    EMAIL_SEND_FAIL(<span class="number">114011</span>, <span class="string">"email send fail"</span>),</span><br><span class="line">    DATA_NOT_FOUND(<span class="number">114012</span>, <span class="string">"data not found"</span>),</span><br><span class="line">    LOGIN_TOKEN_VERIFY_FAIL(<span class="number">114014</span>, <span class="string">"login token verify fail"</span>),</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title">test</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">    ResponseEnum.SERVICE_ERROR.assertNotNull(value);</span><br><span class="line">    <span class="keyword">return</span> ApiResponse.success(<span class="string">"true"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¨å±€å¼‚å¸¸ç®¡ç†å™¨"><a href="#å…¨å±€å¼‚å¸¸ç®¡ç†å™¨" class="headerlink" title="å…¨å±€å¼‚å¸¸ç®¡ç†å™¨"></a>å…¨å±€å¼‚å¸¸ç®¡ç†å™¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿäº§ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String ENV_PROD = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;env&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String profile;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¼‚å¸¸ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = BusinessException.class)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title">handleBusinessException</span><span class="params">(BaseException e)</span> </span>&#123;</span><br><span class="line">        log.error(e.getMessage(), e);</span><br><span class="line">        log.error(<span class="string">"BusinessException"</span>);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.fail(e.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éé”™è¯¯ç¼–ç ç±»ç³»ç»Ÿå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¼‚å¸¸ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = SystemException.class)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title">handleBaseException</span><span class="params">(SystemException e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServerErrorApiResponse(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Controller ä¸Šä¸€å±‚ç›¸å…³å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¼‚å¸¸ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(&#123;NoHandlerFoundException.class,</span><br><span class="line">            HttpRequestMethodNotSupportedException.class,</span><br><span class="line">            HttpMediaTypeNotSupportedException.class,</span><br><span class="line">            MissingPathVariableException.class,</span><br><span class="line">            MissingServletRequestParameterException.class,</span><br><span class="line">            TypeMismatchException.class,</span><br><span class="line">            HttpMessageNotReadableException.class,</span><br><span class="line">            HttpMessageNotWritableException.class,</span><br><span class="line">            <span class="comment">// BindException.class,</span></span><br><span class="line">            <span class="comment">// MethodArgumentNotValidException.class</span></span><br><span class="line">            HttpMediaTypeNotAcceptableException.class,</span><br><span class="line">            ServletRequestBindingException.class,</span><br><span class="line">            ConversionNotSupportedException.class,</span><br><span class="line">            MissingServletRequestPartException.class,</span><br><span class="line">            AsyncRequestTimeoutException.class</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title">handleServletException</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServerErrorApiResponse(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœªå®šä¹‰å¼‚å¸¸ã€‚ç›¸å½“äºå…¨å±€å¼‚å¸¸æ•è·å¤„ç†å™¨ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¼‚å¸¸ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception.class)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title">handleException</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServerErrorApiResponse(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiResponse&lt;String&gt; <span class="title">getServerErrorApiResponse</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> code = ResponseEnum.SERVER_ERROR.getCode();</span><br><span class="line">        String productShowMessage = ResponseEnum.SERVER_ERROR.getMessage();</span><br><span class="line">        <span class="keyword">if</span> (ENV_PROD.equals(profile)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ApiResponse.fail(code, productShowMessage);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.fail(code, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> å®ç°å¯¹æŒ‡å®šå¼‚å¸¸çš„æ•è·ã€‚æ­¤æ—¶è¿è¡Œæ—¶å¼‚å¸¸å’Œ Error ä¹Ÿèƒ½è¢«æ•è·ã€‚</p><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264734349295520" target="_blank" rel="noopener">Java çš„å¼‚å¸¸</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/11/06/customize-global-exception-handler-java/#disqus_thread</comments>
    </item>
    
    <item>
      <title>GitHub Open Feign  ä½¿ç”¨æ€»ç»“</title>
      <link>https://depp.wang/2020/11/02/github-open-feign-use-summary/</link>
      <guid>https://depp.wang/2020/11/02/github-open-feign-use-summary/</guid>
      <pubDate>Mon, 02 Nov 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://depp.wang/2020/11/02/github-open-feign-use-summary/&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¬å¸é¡¹ç›®ç›®å‰ä½¿ç”¨ SOA æ¶æ„ï¼ˆ&lt;a href=&quot;https://en.wikipedia.org/wiki/Service-oriented_architecture&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Service-oriented architecture&lt;/a&gt;ï¼šæœåŠ¡å¯¼å‘æ¶æ„ï¼‰ï¼Œæ¯ä¸ªæœåŠ¡ä½œä¸ºä¸€ä¸ªå•ä½“å¯¹å¤–æä¾›æ¥å£ï¼ŒæœåŠ¡ä¹‹é—´ä½¿ç”¨ &lt;a href=&quot;https://github.com/OpenFeign/feign&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub OpenFeign&lt;/a&gt;  è°ƒç”¨æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡æä¾›è€…æ­£å¸¸æä¾›æ¥å£ï¼ŒæŠŠéœ€è¦æš´éœ²çš„æ¥å£å°è£…ä¸ºä¸€ä¸ª client jar åŒ…ï¼ŒæœåŠ¡è°ƒç”¨è€…æ­£å¸¸å¼•å…¥ jar åŒ…ï¼Œç›´æ¥è°ƒç”¨ jar æ–¹æ³•å³å¯è°ƒç”¨æœåŠ¡æä¾›è€…æ¥å£ã€‚æ­¤æ–‡ç›¸å…³&lt;a href=&quot;https://github.com/DeppWang/springboot-demos/tree/master/springboot-openfeign&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä»£ç ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://depp.wang/2020/11/02/github-open-feign-use-summary/">åŸæ–‡åœ°å€</a></p></blockquote><p>å…¬å¸é¡¹ç›®ç›®å‰ä½¿ç”¨ SOA æ¶æ„ï¼ˆ<a href="https://en.wikipedia.org/wiki/Service-oriented_architecture" target="_blank" rel="noopener">Service-oriented architecture</a>ï¼šæœåŠ¡å¯¼å‘æ¶æ„ï¼‰ï¼Œæ¯ä¸ªæœåŠ¡ä½œä¸ºä¸€ä¸ªå•ä½“å¯¹å¤–æä¾›æ¥å£ï¼ŒæœåŠ¡ä¹‹é—´ä½¿ç”¨ <a href="https://github.com/OpenFeign/feign" target="_blank" rel="noopener">GitHub OpenFeign</a>  è°ƒç”¨æ¥å£ã€‚</p><p>æœåŠ¡æä¾›è€…æ­£å¸¸æä¾›æ¥å£ï¼ŒæŠŠéœ€è¦æš´éœ²çš„æ¥å£å°è£…ä¸ºä¸€ä¸ª client jar åŒ…ï¼ŒæœåŠ¡è°ƒç”¨è€…æ­£å¸¸å¼•å…¥ jar åŒ…ï¼Œç›´æ¥è°ƒç”¨ jar æ–¹æ³•å³å¯è°ƒç”¨æœåŠ¡æä¾›è€…æ¥å£ã€‚æ­¤æ–‡ç›¸å…³<a href="https://github.com/DeppWang/springboot-demos/tree/master/springboot-openfeign" target="_blank" rel="noopener">ä»£ç ç¤ºä¾‹</a></p><a id="more"></a><h2 id="Provider-Api"><a href="#Provider-Api" class="headerlink" title="Provider Api"></a>Provider Api</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/signin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title">doSignin</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username, @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (username.equals(<span class="string">""</span>) &amp;&amp; password.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ApiResponse.fail(<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Provider-Client"><a href="#Provider-Client" class="headerlink" title="Provider Client"></a>Provider Client</h2><p>ProviderClientBuilder</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderClientBuilder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;provider.domain&#125;"</span>)</span><br><span class="line">    <span class="keyword">public</span> String providerDomain;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;provider.socketTimeout:60000&#125;"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> socketTimeout;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;provider.connectTimeout:10000&#125;"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> connectTimeout;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserApi <span class="title">buildProviderApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Preconditions.checkArgument(StringUtils.isNotBlank(providerDomain));</span><br><span class="line">        <span class="keyword">return</span> Feign.builder()</span><br><span class="line">                .decoder(<span class="keyword">new</span> GsonDecoder())</span><br><span class="line">                .encoder(<span class="keyword">new</span> FormEncoder())</span><br><span class="line">                .logger(<span class="keyword">new</span> Slf4jLogger(UserApi.class))</span><br><span class="line">                .retryer(Retryer.NEVER_RETRY)</span><br><span class="line">                .logLevel(Logger.Level.FULL)</span><br><span class="line">                .client(<span class="keyword">new</span> AccessTraceHttpClient(httpClient(), requestConfig()))</span><br><span class="line">                .target(UserApi.class, providerDomain);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserApi</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Headers</span>(<span class="string">"Content-Type: application/x-www-form-urlencoded"</span>) <span class="comment">// è¯·æ±‚çš„ç¼–ç æ ¼å¼ä¸º application/x-www-form-urlencoded</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestLine</span>(<span class="string">"POST /signin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title">signin</span><span class="params">(@Param(<span class="string">"username"</span>)</span> String username, @<span class="title">Param</span><span class="params">(<span class="string">"password"</span>)</span> String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestLine</span>(<span class="string">"GET /status/version"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title">statusVersion</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Consumer-Api"><a href="#Consumer-Api" class="headerlink" title="Consumer Api"></a>Consumer Api</h2><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wang.depp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>provider-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserApi userApi;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/signin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title">signin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userApi.signin(<span class="string">"admin"</span>,<span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"wang.depp"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerApiApplication</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(ConsumerApiApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ProviderClientBuilder ä¸ºé…ç½®ç±»ï¼Œå½“ Provider å’Œ Consumer çš„ package è·¯å¾„ä¸åŒæ—¶ï¼Œéœ€è¦æŒ‡å®šåŒ…æ‰«æè·¯å¾„ï¼Œä½¿å¼•å…¥åŒ…é…ç½®ç±»åœ¨å®¹å™¨å¯åŠ¨æ—¶å°±èƒ½åŠ è½½åˆ°å®¹å™¨ã€‚</p><p>application.properties é…ç½®æä¾›æ–¹ domainã€‚å¯é€šè¿‡é…ç½®æ–‡ä»¶ä¸ºä¸åŒç¯å¢ƒé…ç½®ä¸åŒçš„æœåŠ¡æä¾›è€… domain</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8888</span></span><br><span class="line"><span class="meta">provider.demain</span>=<span class="string">http://localhost:8080/ # å®Œæ•´ä¹¦å†™ï¼Œä¸èƒ½æ˜¯ localhost:8080</span></span><br><span class="line"><span class="meta">provider.socketTimeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="meta">provider.connectTimeout</span>=<span class="string">10000</span></span><br></pre></td></tr></table></figure><h2 id="è¸©è¿‡çš„å‘"><a href="#è¸©è¿‡çš„å‘" class="headerlink" title="è¸©è¿‡çš„å‘"></a>è¸©è¿‡çš„å‘</h2><p>1ã€java.lang.IllegalArgumentException: target values must be absolute.</p><ul><li>è¯»å–é…ç½®æ–‡ä»¶çš„é…ç½®å‡ºäº†é—®é¢˜ï¼Œå¦‚ï¼šprovider-api çš„ domain æ²¡å†™å…¨ï¼›æˆ–å‘½åé”™è¯¯ï¼Œæ²¡æœ‰è¯»å–åˆ°<!--Service å‚æ•°é—®é¢˜ï¼Œæ²¡æœ‰è·å–åˆ°å…·ä½“æ•°æ®ï¼Œè¿˜ä¸º `${*}`--></li></ul><p>2ã€Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was STRING at line 1 column 1 path $</p><ul><li>**Api å’Œ Controller æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å¯¹ä¸ä¸Šï¼Œæ¯”å¦‚ï¼šProvider Api çš„æ‹¦æˆªå™¨ç»™ ApiResponse åˆåŒ…è£…äº†ä¸€å±‚ ApiResponse</li></ul><p>3ã€æ¥æ”¶å‚æ•°ä¸èƒ½ç›´æ¥ä¸º Date</p><ul><li>å› ä¸ºä½¿ç”¨ <code>application/x-www-form-urlencoded</code> ä¼ è¾“æ—¶å°†å‚æ•°ä½¿ç”¨ &amp;&amp; é“¾æ¥åˆ°ä¸€èµ·ï¼Œæ­¤æ—¶å¯ä»¥è®¤ä¸ºæ˜¯ String ç±»å‹ï¼ŒDate ç±»å‹ä¸èƒ½æ¥å— String ç±»å‹å‚æ•°</li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/11/02/github-open-feign-use-summary/#disqus_thread</comments>
    </item>
    
    <item>
      <title>æ­å»º Maven ä»“åº“</title>
      <link>https://depp.wang/2020/11/02/build-a-maven-repository/</link>
      <guid>https://depp.wang/2020/11/02/build-a-maven-repository/</guid>
      <pubDate>Mon, 02 Nov 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;p&gt;å¦‚æœ jar åŒ…åœ¨æœ¬åœ°ï¼Œåªèƒ½æ¯æ¬¡æ‰‹åŠ¨å¯¼å…¥ï¼Œä¸å¤ªæ–¹ä¾¿ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ­å»ºä¸€ä¸ª Maven ä»“åº“&lt;/p&gt;
&lt;h2 id=&quot;1ã€ä½¿ç”¨-GitHub-Pages-æ­å»ºå…¬æœ‰ä»“åº“&quot;&gt;&lt;a href=&quot;#1ã€ä½¿ç”¨-GitHub-Pages-æ­å»ºå…¬æœ‰ä»“åº“&quot; class=&quot;headerlink&quot; title=&quot;1ã€ä½¿ç”¨ GitHub Pages æ­å»ºå…¬æœ‰ä»“åº“&quot;&gt;&lt;/a&gt;1ã€ä½¿ç”¨ GitHub Pages æ­å»ºå…¬æœ‰ä»“åº“&lt;/h2&gt;&lt;p&gt;jar åŒ…æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ GitHub æ¥å­˜æ”¾ï¼Œå†åˆ©ç”¨ GitHub Pages æä¾›ä¸€ä¸ªåœ°å€è®©å…¶å¯ç›´æ¥è®¿é—®ä¸‹è½½ã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>å¦‚æœ jar åŒ…åœ¨æœ¬åœ°ï¼Œåªèƒ½æ¯æ¬¡æ‰‹åŠ¨å¯¼å…¥ï¼Œä¸å¤ªæ–¹ä¾¿ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ­å»ºä¸€ä¸ª Maven ä»“åº“</p><h2 id="1ã€ä½¿ç”¨-GitHub-Pages-æ­å»ºå…¬æœ‰ä»“åº“"><a href="#1ã€ä½¿ç”¨-GitHub-Pages-æ­å»ºå…¬æœ‰ä»“åº“" class="headerlink" title="1ã€ä½¿ç”¨ GitHub Pages æ­å»ºå…¬æœ‰ä»“åº“"></a>1ã€ä½¿ç”¨ GitHub Pages æ­å»ºå…¬æœ‰ä»“åº“</h2><p>jar åŒ…æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ GitHub æ¥å­˜æ”¾ï¼Œå†åˆ©ç”¨ GitHub Pages æä¾›ä¸€ä¸ªåœ°å€è®©å…¶å¯ç›´æ¥è®¿é—®ä¸‹è½½ã€‚</p><a id="more"></a><h3 id="jar-å‘å¸ƒæ–¹"><a href="#jar-å‘å¸ƒæ–¹" class="headerlink" title="jar å‘å¸ƒæ–¹"></a>jar å‘å¸ƒæ–¹</h3><p>pom.xml é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wang.depp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>substruction-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>substruction-common<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Substruction common jar<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>local-repo-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>GitHub Release<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;project.basedir&#125;/maven-repo<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar-no-fork<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-javadocs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;distributionManagement&gt;</code> æ˜¯é…ç½®æœ¬åœ°æ‰“åŒ…åçš„æ–‡ä»¶çš„è·¯å¾„ï¼Œå½“è¿è¡Œ  <code>mvn clean package deploy</code> åï¼Œå°†å‘å¸ƒåˆ°æ ¹è·¯å¾„çš„ <code>maven-repo</code> æ–‡ä»¶å¤¹ã€‚id å’Œ name å¯ä»¥éšä¾¿å¡«å†™ã€‚</p><p>é»˜è®¤æ‰“åŒ…åå°†åŒ…å« jar åŒ…ï¼Œå’Œ pom æ–‡ä»¶ã€‚å¯ä»¥æ·»åŠ  2 ä¸ªæ’ä»¶ï¼Œä½¿å…¶å¯ä»¥ç”Ÿæˆ source æºæ–‡ä»¶ jar å’Œ javadoc æ–‡æ¡£ jar åŒ…ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">maven-repo</span></span><br><span class="line">â””â”€â”€ <span class="selector-tag">depp</span></span><br><span class="line">    â””â”€â”€ <span class="selector-tag">wang</span></span><br><span class="line">        â””â”€â”€ <span class="selector-tag">substruction-common</span></span><br><span class="line">            â”œâ”€â”€ 1<span class="selector-class">.0</span><span class="selector-class">.0</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0-javadoc</span><span class="selector-class">.jar</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0-javadoc</span><span class="selector-class">.jar</span><span class="selector-class">.md5</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0-javadoc</span><span class="selector-class">.jar</span><span class="selector-class">.sha1</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0-sources</span><span class="selector-class">.jar</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0-sources</span><span class="selector-class">.jar</span><span class="selector-class">.md5</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0-sources</span><span class="selector-class">.jar</span><span class="selector-class">.sha1</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.jar</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.jar</span><span class="selector-class">.md5</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.jar</span><span class="selector-class">.sha1</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.pom</span></span><br><span class="line">            â”‚   â”œâ”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.pom</span><span class="selector-class">.md5</span></span><br><span class="line">            â”‚   â””â”€â”€ <span class="selector-tag">substruction-common-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.pom</span><span class="selector-class">.sha1</span></span><br><span class="line">            â”œâ”€â”€ <span class="selector-tag">maven-metadata</span><span class="selector-class">.xml</span></span><br><span class="line">            â”œâ”€â”€ <span class="selector-tag">maven-metadata</span><span class="selector-class">.xml</span><span class="selector-class">.md5</span></span><br><span class="line">            â””â”€â”€ <span class="selector-tag">maven-metadata</span><span class="selector-class">.xml</span><span class="selector-class">.sha1</span></span><br></pre></td></tr></table></figure><blockquote><p>md5 ä¸ºæ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼Œç”¨äºæ£€éªŒ jar åŒ…æ˜¯å¦è¢«ä¿®æ”¹ï¼Ÿå°†æ¶ˆæ¯æ‘˜è¦æ•£åˆ—ç”Ÿæˆä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä¸‹è½½æ—¶ï¼Œå†æ¬¡æ•£åˆ—ä¸€æ¬¡ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦ä¸€è‡´ï¼Ÿ</p></blockquote><p>å› ä»£ç é‡ŒåŒ…å« Lambda è¡¨è¾¾å¼ï¼Œä¸èƒ½ä½¿ç”¨é»˜è®¤ Maven 1.5 çš„ç¼–è¯‘å™¨ï¼Œéœ€è¦ä½¿ç”¨ 8 æˆ–ä»¥ä¸Šçš„ç¼–è¯‘å™¨ã€‚<code>maven-compiler-plugin</code></p><p><a href="https://github.com/DeppWang/substruction-common" target="_blank" rel="noopener">å½“ push åˆ° GitHub å</a>ï¼Œç»™é¡¹ç›®å¼€å¯ GitHub Pagesï¼Œç›´æ¥è®¿é—® <a href="https://depp.wang/substruction-common/">https://depp.wang/substruction-common/</a> å°†æ‰“å¼€æ ¹ç›®å½• index.html  æ–‡ä»¶</p><h3 id="å¼•ç”¨æ–¹"><a href="#å¼•ç”¨æ–¹" class="headerlink" title="å¼•ç”¨æ–¹"></a>å¼•ç”¨æ–¹</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wang.depp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>substruction-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é™¤äº†æ­£å¸¸å¼•ç”¨ä¾èµ–å¤–ï¼Œè¿˜éœ€è¦æŒ‡æ˜ä¾èµ– jar è·å–åœ°å€</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>substruction-common<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>The Maven Repository on Github<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://depp.wang/substruction-common/maven-repo/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2ã€ä½¿ç”¨-GitHub-Packages-æ­å»ºç§æœ‰ä»“åº“"><a href="#2ã€ä½¿ç”¨-GitHub-Packages-æ­å»ºç§æœ‰ä»“åº“" class="headerlink" title="2ã€ä½¿ç”¨ GitHub Packages æ­å»ºç§æœ‰ä»“åº“"></a>2ã€ä½¿ç”¨ GitHub Packages æ­å»ºç§æœ‰ä»“åº“</h2><p>ç›¸å…³æ•™ç¨‹ï¼š<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1347981037010977" target="_blank" rel="noopener">å‘å¸ƒ Artifact</a></p><p>GitHub <code>Setting -&gt; Developer settings -&gt; Personal access tokens</code>  æ–°å»º Tokenï¼Œè‡³å°‘é€‰æ‹© repoã€write:packagesã€read:packages</p><h3 id="å‘å¸ƒæ–¹"><a href="#å‘å¸ƒæ–¹" class="headerlink" title="å‘å¸ƒæ–¹"></a>å‘å¸ƒæ–¹</h3><p><a href="https://maven.apache.org/settings.html" target="_blank" rel="noopener">settings.xml</a> é…ç½® GitHub è´¦å·å¯†ç ï¼ˆtokenï¼‰</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span><span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>github-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>your-github-name<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>e1a589c**01027697e<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>pom.xml é…ç½®ä»“åº“åœ°å€</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>github-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>GitHub Release<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.pkg.github.com/DeppWang/provider-client<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>id éœ€è¦å’Œ settings.xml çš„ id ç›¸åŒã€‚é€šè¿‡æ­¤ id æŸ¥æ‰¾ settings.xml çš„è´¦å·å¯†ç ã€‚url æ‰€åŒ…å«çš„ <code>provider-client</code> æ— éœ€åœ¨ package ä¸­æ–°å»ºï¼Œ<strong>ä½†å¿…é¡»å­˜åœ¨ä¸€ä¸ª<a href="https://github.com/DeppWang/provider-client/" target="_blank" rel="noopener">åŒåä»“åº“</a>ï¼Œå› ä¸º Package æœ¬è´¨ä¸Šæ˜¯ä¾èµ–äºä»“åº“å®ç°çš„</strong>ã€‚</p><p>å¦åˆ™å¯èƒ½é‡åˆ°çš„é”™è¯¯ï¼š</p><figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">Failed <span class="keyword">to</span> deploy artifacts: Could <span class="built_in">not</span> <span class="built_in">find</span> artifact ** <span class="built_in">in</span> github-release (https:<span class="comment">//maven.pkg.github.com/DeppWang/provider-client)</span></span><br></pre></td></tr></table></figure><p>å½“å‘å¸ƒåï¼Œæ›´æ–°ç‰ˆæœ¬å†æ¬¡å‘å¸ƒæ—¶ï¼Œå¯èƒ½é‡åˆ° 409 çš„é”™è¯¯ï¼š</p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">provider-<span class="string">client:</span> Failed to deploy <span class="string">artifacts:</span> Could not transfer artifact wang.<span class="string">depp:</span>provider-<span class="string">client:</span><span class="string">jar:</span><span class="string">sources:</span><span class="number">1.0</span><span class="number">.2</span> from<span class="regexp">/to github-release (https:/</span><span class="regexp">/maven.pkg.github.com/</span>DeppWang<span class="regexp">/provider-client): Failed to transfer file https:/</span><span class="regexp">/maven.pkg.github.com/</span>DeppWang<span class="regexp">/provider-client/</span>wang<span class="regexp">/depp/</span>provider-client<span class="regexp">/1.0.2/</span>provider-client<span class="number">-1.0</span><span class="number">.2</span>-sources.jar with status code <span class="number">409</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯èƒ½å·²ç»å‘å¸ƒæˆåŠŸäº†ï¼Œå¯æŸ¥çœ‹ package</p><h3 id="å¼•ç”¨æ–¹-1"><a href="#å¼•ç”¨æ–¹-1" class="headerlink" title="å¼•ç”¨æ–¹"></a>å¼•ç”¨æ–¹</h3><p>pom.xml é…ç½® repository</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>github-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>GitHub Release<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.pkg.github.com/deppwang/provider-client<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wang.depp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>provider-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœå¼•ç”¨æ–¹å’Œå‘å¸ƒæ–¹ä¸æ˜¯ä¸€å°ç”µè„‘éœ€è¦é¢å¤–ç”³è¯·ä¸€ä¸ªå…·æœ‰ repoã€read:packages çš„ Tokenï¼Ÿå¯å¦ä½¿ç”¨åŒä¸€ä¸ª tokenï¼Ÿ</p></blockquote><h2 id="3ã€ä½¿ç”¨-Nexus-å…è´¹ç‰ˆæ­å»ºç§æœ‰ä»“åº“"><a href="#3ã€ä½¿ç”¨-Nexus-å…è´¹ç‰ˆæ­å»ºç§æœ‰ä»“åº“" class="headerlink" title="3ã€ä½¿ç”¨ Nexus å…è´¹ç‰ˆæ­å»ºç§æœ‰ä»“åº“"></a>3ã€ä½¿ç”¨ Nexus å…è´¹ç‰ˆæ­å»ºç§æœ‰ä»“åº“</h2><p>ä¸Šé¢è¿™ç§æ–¹å¼ä¾èµ–äºé¡¹ç›®ï¼Œæ— æ³•é›†ä¸­ç®¡ç†æ‰€æœ‰çš„ jar åŒ…ï¼Œè¿˜éœ€è¦è®¾ç½® settings.xmlã€‚ä½¿ç”¨ Nexus å…è´¹ç‰ˆæ­å»ºç§æœ‰ä»“åº“æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ–¹å¼ã€‚ç›¸å…³æ•™ç¨‹ï¼š<a href="https://help.sonatype.com/repomanager3/installation" target="_blank" rel="noopener">Installation</a>ã€‚</p><p>å½“éœ€è¦å°†è‡ªå·±å¼€å‘çš„ jar åŒ…åŒæ­¥åˆ°ä¸­å¤®ä»“åº“ï¼Œä»¥ä¾›æ‰€æœ‰äººä¸‹è½½ä½¿ç”¨æ—¶ï¼Œå¯ä½¿ç”¨ Sonatype æ¥å®ç°ï¼Œç›¸å…³æ•™ç¨‹ï¼š<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1347981037010977" target="_blank" rel="noopener">å‘å¸ƒ Artifact</a></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1347981037010977" target="_blank" rel="noopener">å‘å¸ƒ Artifact</a></li><li><a href="https://github.community/t/github-package-registry-maven-deploy/14562/3" target="_blank" rel="noopener"><a href="https://github.community/t/github-package-registry-maven-deploy/14562" target="_blank" rel="noopener">GitHub Package Registry Maven Deploy</a></a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/11/02/build-a-maven-repository/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Logback ä½¿ç”¨æ€»ç»“</title>
      <link>https://depp.wang/2020/10/30/logback-use-summary/</link>
      <guid>https://depp.wang/2020/10/30/logback-use-summary/</guid>
      <pubDate>Fri, 30 Oct 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;p&gt;æœ€è¿‘æ‰“åœ¨æ‰“å°æ—¥å¿—è¿™å—æ ½äº†ä¸ªè·Ÿå¤´ï¼Œå‘ç°æ—¥å¿—è¿™å—æŒæ¡å¾—è¿˜ä¸å¤ªå¥½ï¼Œæ‰€ä»¥å¤§æ¦‚æ¢³ç†ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…¶å® SLF4J ç±»ä¼¼äº Commons Loggingï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ—¥å¿—æ¥å£ï¼Œè€Œ Logback ç±»ä¼¼äº Log4jï¼Œæ˜¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>æœ€è¿‘æ‰“åœ¨æ‰“å°æ—¥å¿—è¿™å—æ ½äº†ä¸ªè·Ÿå¤´ï¼Œå‘ç°æ—¥å¿—è¿™å—æŒæ¡å¾—è¿˜ä¸å¤ªå¥½ï¼Œæ‰€ä»¥å¤§æ¦‚æ¢³ç†ä¸€ä¸‹ã€‚</p><blockquote><p>å…¶å® SLF4J ç±»ä¼¼äº Commons Loggingï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ—¥å¿—æ¥å£ï¼Œè€Œ Logback ç±»ä¼¼äº Log4jï¼Œæ˜¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°ã€‚</p></blockquote><a id="more"></a><h2 id="4-ä¸ªæ—¥å¿—çº§åˆ«"><a href="#4-ä¸ªæ—¥å¿—çº§åˆ«" class="headerlink" title="4 ä¸ªæ—¥å¿—çº§åˆ«"></a>4 ä¸ªæ—¥å¿—çº§åˆ«</h2><p>å¸¸ç”¨çš„ 4 ä¸ªæ—¥å¿—çº§åˆ«ï¼Œä»ä½åˆ°é«˜ï¼šDEBUGã€INFOã€WARNã€ERRORã€‚ä½çº§åˆ«èƒ½è¾“å‡ºé«˜çº§åˆ«çš„æ—¥å¿—ï¼Œçº§åˆ«è¶Šä½è¾“å‡ºå†…å®¹è¶Šå¤šã€‚</p><ul><li>DEBUGï¼šè°ƒè¯•æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒå…³é—­ Debug</li><li>INFOï¼šç³»ç»Ÿè¿è¡Œä¿¡æ¯ã€å¤–éƒ¨æ¥å£éƒ¨åˆ†ï¼Œå¯é€šè¿‡æ—¥å¿—çœ‹åˆ°åŠŸèƒ½æµç¨‹</li><li>WARNï¼šä¸å½±å“ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œä½†ä¸åº”è¯¥å‡ºç°çš„æƒ…å†µ</li><li>ERRORï¼šå½±å“ç¨‹åºæ­£å¸¸è¿è¡Œçš„æƒ…å†µï¼Œæ­¤æ—¶éœ€ä½¿ç”¨é‚®ä»¶ç­‰æ–¹å¼å‘Šè­¦ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œä¸æ‰“å°</li></ul><p>ä½¿ç”¨ Logger æˆ–ä½¿ç”¨æ³¨è§£ @Slf4j</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"debug: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        logger.info(<span class="string">"info: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        logger.warn(<span class="string">"warn: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        logger.error(<span class="string">"error: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.debug(<span class="string">"debug: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        log.info(<span class="string">"info: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        log.warn(<span class="string">"warn: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        log.error(<span class="string">"error: [&#123;&#125;]"</span>, <span class="string">"haha"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°æ—¥å¿—æ—¶ï¼Œä½¿ç”¨å ä½ç¬¦å’Œ []ï¼Œå½“æ²¡æœ‰ logback.xml æ—¶ï¼Œé»˜è®¤éš”ç¦»çº§åˆ«ï¼šINFOã€‚</p><h2 id="Logback-é…ç½®"><a href="#Logback-é…ç½®" class="headerlink" title="Logback é…ç½®"></a>Logback é…ç½®</h2><p>logback.xml åŸºç¡€é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ§åˆ¶å°è¾“å‡ºè®¾ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- encoders are assigned the type</span></span><br><span class="line"><span class="comment">             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºæ ¼å¼ï¼š</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">15<span class="selector-pseudo">:58</span><span class="selector-pseudo">:50.559</span> <span class="selector-attr">[http-nio-8080-exec-1]</span> <span class="selector-tag">INFO</span>  <span class="selector-tag">w</span><span class="selector-class">.depp</span><span class="selector-class">.exceptionlog</span><span class="selector-class">.TestController</span> <span class="selector-tag">-</span> <span class="selector-tag">info</span>: <span class="selector-tag">haha</span></span><br></pre></td></tr></table></figure><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-30-083249.png" alt="basic Syntax"></p><p>ä½¿ç”¨ logger æŒ‡å®šæŸä¸ª package ä½¿ç”¨æŸä¸ªçº§åˆ«ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- encoders are assigned the type</span></span><br><span class="line"><span class="comment">         ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"chapters.configuration"</span> <span class="attr">level</span>=<span class="string">"INFO"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Strictly speaking, the level attribute is not necessary since --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- the level of the root level is set to DEBUG by default.       --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>&gt;</span>          </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">root</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ logger æŒ‡å®šæŸä¸ªæ–‡ä»¶ä½¿ç”¨æŸä¸ªçº§åˆ«ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">        %d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n</span><br><span class="line">     <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"chapters.configuration"</span> <span class="attr">level</span>=<span class="string">"INFO"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"chapters.configuration.Foo"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä¸ºä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«"><a href="#ä¸ºä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«" class="headerlink" title="ä¸ºä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«"></a>ä¸ºä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ç³»ç»Ÿæ•´ä½“ä½¿ç”¨æŸä¸ªçº§åˆ«å¤–ï¼ˆå¦‚ INFOï¼‰ï¼Œè¿˜å¯ä»¥ä¸šåŠ¡ç±»é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨ <code>springProfile</code> æ ‡ç­¾</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/base.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- encoders are assigned the type</span></span><br><span class="line"><span class="comment">             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"test,dev"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"wang.depp"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"pre,pro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"wang.depp"</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ° application.yml é…ç½®ç¯å¢ƒå‚æ•°</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><p>æ‰“åŒ…éƒ¨ç½²æ—¶æŒ‡å®šç¯å¢ƒ</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">$ java -jar \target\my-app<span class="selector-class">.jar</span> -Dspring<span class="selector-class">.profiles</span><span class="selector-class">.active</span>=dev</span><br></pre></td></tr></table></figure><p>é»˜è®¤ appender å°†é‡å¤æ‰“å°æ—¥å¿—ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡åœ¨ logger æ·»åŠ  <code>additivity=&quot;false&quot;</code> æ¥å…³é—­</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"pre,pro"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"wang.depp"</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶"><a href="#è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶" class="headerlink" title="è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶"></a>è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/base.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- encoders are assigned the type</span></span><br><span class="line"><span class="comment">             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"baselog"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span>&gt;</span>log/app.log<span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ ¹æ®æ—¥æœŸå­˜æ”¾æ—¥å¿—ï¼Œæ¯ä¸ªæ–‡ä»¶é™åˆ¶ 64MB --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>log/app.log.%d.%i<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--or whenever the file size reaches 64 MB--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>64 MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶çš„æ—¥å¿—æ ¼å¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %d %p (%file:%line\)- %m%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"test,dev"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"wang.depp"</span> <span class="attr">level</span>=<span class="string">"debug"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"baselog"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"pre,pro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"wang.depp"</span> <span class="attr">level</span>=<span class="string">"error"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"baselog"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ­å»º-ELK-å¹³å°å›¾å½¢åŒ–æŸ¥çœ‹æ—¥å¿—"><a href="#æ­å»º-ELK-å¹³å°å›¾å½¢åŒ–æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æ­å»º ELK å¹³å°å›¾å½¢åŒ–æŸ¥çœ‹æ—¥å¿—"></a>æ­å»º ELK å¹³å°å›¾å½¢åŒ–æŸ¥çœ‹æ—¥å¿—</h2><p>ELKï¼šElasticsearchã€Logstashã€Kibana</p><p>å¤§è‡´åŸç†ï¼š</p><p><img src="https://developer.ibm.com/developer/default/articles/build-elk-and-use-it-for-springboot-and-nginx/images/image001.png" alt="å›¾ 1. ELK çš„å¤§è‡´å·¥ä½œæµç¨‹"></p><p>è¯¦ç»†æ­å»ºè¿‡ç¨‹ï¼š<a href="https://developer.ibm.com/zh/articles/build-elk-and-use-it-for-springboot-and-nginx/" target="_blank" rel="noopener">æ­å»º ELK å®æ—¶æ—¥å¿—å¹³å°å¹¶åœ¨ Spring Boot å’Œ Nginx é¡¹ç›®ä¸­ä½¿ç”¨</a></p><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264739155914176" target="_blank" rel="noopener">å»–é›ªå³° - ä½¿ç”¨ SLF4J å’Œ Logback</a></li><li><a href="http://logback.qos.ch/manual/configuration.html" target="_blank" rel="noopener">Chapter 3: Logback configuration</a></li><li><a href="https://howtodoinjava.com/spring-boot2/logging/profile-specific-logging/" target="_blank" rel="noopener">Spring boot profile specific logging example</a></li><li><a href="https://mp.weixin.qq.com/s/hJvkRlt9xQbWhYy1G7ZDsw" target="_blank" rel="noopener">æ‰“å°æ—¥å¿—çš„æ­£ç¡®å§¿åŠ¿</a></li></ul><!--[æˆ‘å®šçš„æ—¥å¿—è§„èŒƒè¢« CTO åœ¨å…¨å…¬å¸æ¨å¹¿äº†](https://www.cnblogs.com/yinjihuan/p/12091701.html)-->]]></content:encoded>
      
      <comments>https://depp.wang/2020/10/30/logback-use-summary/#disqus_thread</comments>
    </item>
    
    <item>
      <title>æ¥å£é™æµçš„å‡ ç§ç®—æ³•</title>
      <link>https://depp.wang/2020/10/27/several-algorithms-for-api-rate-limiting/</link>
      <guid>https://depp.wang/2020/10/27/several-algorithms-for-api-rate-limiting/</guid>
      <pubDate>Tue, 27 Oct 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;p&gt;ä»Šå¤©é¢è¯•é‡åˆ°ä¸€ä¸ªå…³äºæ¥å£é™æµçš„é—®é¢˜ï¼š&lt;strong&gt;è®¾è®¡ä¸€ä¸ªæ–¹æ¡ˆï¼Œä¿è¯æ¯ç§’åªæœ‰ 10 ä¸ªè¯·æ±‚å¯ä»¥è®¿é—®æ¥å£&lt;/strong&gt;ã€‚ä¸å¾—ä¸è¯´ï¼Œæ­¤é—®é¢˜å¯ä»¥å¾ˆå¥½çš„è€ƒå¯Ÿé¢è¯•é«˜çº§å·¥ç¨‹å¸ˆå²—ä½çš„å€™é€‰äººçš„è¿‡å¾€ç»éªŒã€‚ä¸è¿‡å¾ˆé—æ†¾ï¼Œæˆ‘åŸæ¥å¹¶æ²¡æœ‰åšè¿‡è¿™æ–¹é¢çš„å·¥ä½œã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>ä»Šå¤©é¢è¯•é‡åˆ°ä¸€ä¸ªå…³äºæ¥å£é™æµçš„é—®é¢˜ï¼š<strong>è®¾è®¡ä¸€ä¸ªæ–¹æ¡ˆï¼Œä¿è¯æ¯ç§’åªæœ‰ 10 ä¸ªè¯·æ±‚å¯ä»¥è®¿é—®æ¥å£</strong>ã€‚ä¸å¾—ä¸è¯´ï¼Œæ­¤é—®é¢˜å¯ä»¥å¾ˆå¥½çš„è€ƒå¯Ÿé¢è¯•é«˜çº§å·¥ç¨‹å¸ˆå²—ä½çš„å€™é€‰äººçš„è¿‡å¾€ç»éªŒã€‚ä¸è¿‡å¾ˆé—æ†¾ï¼Œæˆ‘åŸæ¥å¹¶æ²¡æœ‰åšè¿‡è¿™æ–¹é¢çš„å·¥ä½œã€‚</p><a id="more"></a><p>åœ¨è‡ªå·±çš„çŸ¥è¯†å‚¨å¤‡ä¸­ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ï¼šå‡å¦‚ä¿è¯æ¯ç§’åªæœ‰ 1 ä¸ªè¯·æ±‚è®¿é—®æ¥å£ï¼Œå¦‚ä½•å®ç°ã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ç›´æ¥åŠ é”ï¼ŒåŠ é”åï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªè¯·æ±‚å¯ä»¥è®¿é—®æ¥å£ï¼Œä½†æ˜¯æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ä¸ç¡®å®šï¼Œå¯èƒ½å°äº 1sï¼ˆä¹Ÿå¯èƒ½å¤§äº 1 sï¼‰ï¼Œæ­¤ç§æ–¹æ³•ä¸ç¬¦åˆé—®é¢˜è¦æ±‚ï¼Œpassã€‚</p><p>æ¥ç€æƒ³åˆ°ä½¿ç”¨ Redis è®¾ç½® 1 ä¸ªè¿‡æœŸæ—¶é—´ä¸º 1s çš„äº’æ–¥ keyï¼Œkey çš„å‘½åå¯æ ¹æ®ä¸šåŠ¡åœºæ™¯è®¾å®šï¼Œæ¯ä¸ªè¯·æ±‚å‡å°è¯•è®¾ç½®è¿™ä¸ª keyï¼Œè®¾ç½®æˆåŠŸå°±å¯ä»¥è®¿é—®æ¥å£ï¼Œå¦åˆ™æ‹’ç»ã€‚è€Œé’ˆå¯¹æ¯ç§’é™åˆ¶ 10 ä¸ªè¯·æ±‚ï¼Œå°±ç´¢æ€§è®¾ç½® 10 ä¸ªè¿‡æœŸæ—¶é—´ä¸º 1s çš„äº’æ–¥ keyï¼Œæ¯ä¸ªè¯·æ±‚ä½¿ç”¨ for å¾ªç¯ä¾æ¬¡å°è¯•è®¾ç½®è¿™ 10 ä¸ª keyï¼Œå‰ 10 ä¸ªè¯·æ±‚å°±å°† 10 key è®¾ç½®ï¼Œå½“ç¬¬ 1 ä¸ª key æ²¡æœ‰è¿‡æœŸæ—¶ï¼Œç¬¬ 11 ä¸ªè¯·æ±‚å°†è®¾ç½®å¤±è´¥ï¼Œè®¿é—®æ‹’ç»ã€‚æ­¤ç§è™½ç„¶å¯ä»¥å˜ç›¸å®ç°éœ€æ±‚ï¼Œä½†æœ‰ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œå‡è®¾ QPS ä¸º 1 ä¸‡ï¼Œæ¯ç§’é™åˆ¶ 100 ä¸ªè¯·æ±‚ï¼ŒRedis å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡çš„ç½‘ç»œ IOï¼Œå°†å˜æˆ 100 ä¸‡æ¬¡ï¼Œä¸æ•¢æƒ³ã€‚</p><p>é¢è¯•å®Œæˆä¹‹åï¼ˆå½“ç„¶æŒ‚äº†ï¼‰ï¼Œå‘ç°æ€è€ƒæ–¹å‘è¿˜æ˜¯å¤ªçª„äº†ï¼Œæœ‰å¾ˆå¤šç®€å•æ–¹å¼å°±èƒ½å®ç°é™æµã€‚</p><h2 id="1ã€è®¡æ•°å™¨ï¼ˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•ï¼‰"><a href="#1ã€è®¡æ•°å™¨ï¼ˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•ï¼‰" class="headerlink" title="1ã€è®¡æ•°å™¨ï¼ˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•ï¼‰"></a>1ã€è®¡æ•°å™¨ï¼ˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•ï¼‰</h2><p>ä½¿ç”¨ä¸€ä¸ªè®¡æ•°å™¨ä»£è¡¨è¯·æ±‚æ•°ï¼Œè®¾ç½®æ¯ç§’è¯·æ±‚é™åˆ¶æ•°ä¸º 10ï¼ˆå›¾ç‰‡ä¸º 100ï¼‰ ï¼Œå½“è¯·æ±‚é—´éš”å¤§äº 1sï¼ˆå›¾ç‰‡ä¸º 1 minutesï¼‰ æ—¶ï¼Œè¯·æ±‚é€šè¿‡ï¼Œé‡ç½®è®¡æ•°å™¨ï¼Œå½“å‰æ—¶é—´è®¾ä¸ºé—´éš”å¼€å§‹æ—¶é—´ï¼›å½“é—´éš”æ—¶é—´å°äº 1 s æ—¶ï¼Œè®¡æ•°å™¨åŠ  1ï¼Œå¦‚æœè®¡æ•°å™¨å¤§äºé™åˆ¶æ•°æ—¶ï¼Œæ­¤æ—¶è¯·æ±‚æ‹’ç»ï¼Œå°äºæ—¶ï¼Œè¯·æ±‚é€šè¿‡ã€‚å› ä¸ºé—´éš”æ—¶é—´å›ºå®šï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿå«å›ºå®šæ—¶é—´çª—å£ç®—æ³•ã€‚</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-27-124254.jpg" alt="2016-09-01_20:31:28.jpg"></p><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp = getNowTime();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> reqCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit = <span class="number">10</span>; <span class="comment">// æ—¶é—´çª—å£å†…æœ€å¤§è¯·æ±‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> interval = <span class="number">1000</span>; <span class="comment">// æ—¶é—´çª—å£ 1000 ms, 1s</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = getNowTime();</span><br><span class="line">        <span class="keyword">if</span> (now &lt; timeStamp + interval) &#123;</span><br><span class="line">            <span class="comment">// åœ¨æ—¶é—´çª—å£å†…</span></span><br><span class="line">            reqCount++;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­å½“å‰æ—¶é—´çª—å£å†…æ˜¯å¦è¶…è¿‡æœ€å¤§è¯·æ±‚æ§åˆ¶æ•°</span></span><br><span class="line">            <span class="keyword">return</span> reqCount &lt;= limit;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            timeStamp = now;</span><br><span class="line">            <span class="comment">// è¶…æ—¶åé‡ç½®</span></span><br><span class="line">            reqCount = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹å®‰å…¨ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">private</span> AtomicInteger reqCount = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit = <span class="number">10</span>; <span class="comment">// æ—¶é—´çª—å£å†…æœ€å¤§è¯·æ±‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> interval = <span class="number">1000</span>; <span class="comment">// æ—¶é—´çª—å£ 1000 ms, 1s</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (now &lt; timeStamp + interval) &#123;</span><br><span class="line">            <span class="comment">// åœ¨æ—¶é—´çª—å£å†…</span></span><br><span class="line">            reqCount.incrementAndGet();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­å½“å‰æ—¶é—´çª—å£å†…æ˜¯å¦è¶…è¿‡æœ€å¤§è¯·æ±‚æ§åˆ¶æ•°</span></span><br><span class="line">            <span class="keyword">return</span> reqCount.get() &lt;= limit;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeStamp = now;</span><br><span class="line">            <span class="comment">// è¶…æ—¶åé‡ç½®</span></span><br><span class="line">            reqCount.set(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/signin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSignin</span><span class="params">(@RequestParam(<span class="string">"email"</span>)</span> String email, @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password,</span></span><br><span class="line"><span class="function">HttpSession session) </span>&#123;</span><br><span class="line">        CounterDemo counter = <span class="keyword">new</span> CounterDemo();</span><br><span class="line">        <span class="keyword">if</span> (!counter.grant()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"signin.html"</span>, Map.of(<span class="string">"email"</span>, email, <span class="string">"error"</span>, <span class="string">"Signin failed"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">User user = userService.signin(email, password);</span><br><span class="line">session.setAttribute(KEY_USER, user);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"signin.html"</span>, Map.of(<span class="string">"email"</span>, email, <span class="string">"error"</span>, <span class="string">"Signin failed"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/profile"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ä¸€ä¸ªæ¥å£ä¸€ä¸ª counterï¼Œå¦‚æœè¦é™åˆ¶æ‰€æœ‰æ¥å£çš„æ¯ç§’è¯·æ±‚æ•°ï¼Œå¯ä»¥åœ¨ Filter ä¸­è®¾ç½®ã€‚</p><h2 id="2ã€æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼ˆSliding-Windowï¼‰"><a href="#2ã€æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼ˆSliding-Windowï¼‰" class="headerlink" title="2ã€æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼ˆSliding Windowï¼‰"></a>2ã€æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼ˆSliding Windowï¼‰</h2><p>å¦‚æœæ¯ç§’é™åˆ¶è¯·æ±‚è®¿é—®æ•°é‡ä¸ºç³»ç»Ÿä¸´ç•Œå€¼æ—¶ï¼Œå‡è®¾æ¯ç§’ 100 æ¬¡ï¼Œå¦‚æœ 1s å†…å‰ 800ms å†…æ²¡æœ‰è®¿é—®ï¼Œå 200ms å†…è®¿é—®äº† 100 æ¬¡ï¼Œå 1s çš„å‰ 200ms åˆè®¿é—®äº† 100 æ¬¡ï¼Œæ­¤æ—¶è¿™ 1s å°±è®¿é—® 200 æ¬¡ï¼Œæ­¤æ—¶å¯èƒ½ä¼šé€ æˆç³»ç»Ÿå´©æºƒã€‚ä½†å¦‚æœé™åˆ¶æ¯ç§’è®¿é—®æ¬¡æ•°æ˜¯ 10 æ¬¡ï¼Œé‚£ä¹ˆä¸Šé¢è®¡æ•°å™¨è¿™ç§æ–¹å¼å°±è¶³å¤Ÿäº†ï¼Œæ¯•ç«Ÿæ¯ç§’æœ€å¤š 20 æ¬¡è®¿é—®ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-27-073522.png" alt="img"></p><p>æ­¤æ—¶éœ€è¦ä½¿ç”¨æ»‘åŠ¨çª—å£æ¥ä¿è¯é—´éš”å¤„ä¸ä¼šå‡ºç°è¶…é™åˆ¶è¯·æ±‚çš„æƒ…å†µã€‚å…·ä½“éœ€è¦è®°å½•æ—¶é—´çª—å£æ¯ä¸ªè¯·æ±‚çš„æ—¶é—´ï¼Œå³åœ¨æ—¶é—´çª—å£å†…æ¯ä¸ªæ¥å£è¯·æ±‚åˆ°è¾¾çš„æ—¶é—´ç‚¹ã€‚</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-27-123937.png" alt="img"></p><p>æ»‘åŠ¨çª—å£è®°å½•çš„æ—¶é—´ç‚¹ list = (t_1, t_2, â€¦t_k)ï¼Œèµ·ç‚¹æ˜¯ list ä¸­æœ€å°çš„æ—¶é—´ç‚¹ t_1ã€‚æ¨¡æ‹Ÿï¼šå½“ t_m æ—¶åˆ»æ–°çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¦‚æœ t_m åœ¨ t_1 + 1 å†…ï¼Œåˆ¤æ–­ list.size() æ˜¯å¦å°äº 100ï¼Œæ˜¯ï¼Œt_m åŠ å…¥ listï¼Œé€šè¿‡ã€‚å¦‚æœä¸åœ¨ï¼Œä¸¢å¼ƒç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹ t_1ï¼Œé€šè¿‡ã€‚</p><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlidingWindowDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit = <span class="number">100</span>; <span class="comment">// æ—¶é—´çª—å£å†…æœ€å¤§è¯·æ±‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> interval = <span class="number">1000</span>; <span class="comment">// æ—¶é—´çª—å£ 1000 ms, 1s</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; reqTimes = <span class="keyword">new</span> ArrayList&lt;&gt;()&#123;&#123;</span><br><span class="line">        add(getNowTime());</span><br><span class="line">    &#125;&#125;; <span class="comment">// è®°å½•è¯·æ±‚çš„æ—¶é—´</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> t_m = getNowTime();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ t_m æ˜¯å¦åœ¨æ—¶é—´çª—å£å†…</span></span><br><span class="line">        <span class="keyword">if</span> (t_m &lt; reqTimes.get(<span class="number">0</span>) + interval) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­å½“å‰æ—¶é—´çª—å£å†…æ˜¯å¦è¶…è¿‡æœ€å¤§è¯·æ±‚æ§åˆ¶æ•°</span></span><br><span class="line">            <span class="keyword">if</span> (reqTimes.size() &lt; limit) &#123;</span><br><span class="line">            reqTimes.add(t_m);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸åœ¨æ—¶é—´çª—å£å†…ï¼Œä¸¢å¼ƒç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹</span></span><br><span class="line">            requestTimes.remove(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œåœ¨æ—¶é—´çª—å£é—´éš”å¤„ï¼Œå¦‚æœæ—¶é—´çª—å£çš„å 200 æ¯«ç§’æœ‰äº† 100 æ¬¡è®¿é—®ï¼Œä¸‹ä¸€ä¸ªæ—¶é—´çª—å£å‰ 800 æ¯«ç§’çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚</p><p>æ¯ä¸ªæ—¶é—´çª—å£ï¼ˆ1sï¼‰list æœ€å¤š 100 ä¸ªã€‚</p><h2 id="3ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky-Bucket"><a href="#3ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky-Bucket" class="headerlink" title="3ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucket)"></a>3ã€æ¼æ¡¶ç®—æ³•ï¼ˆ<a href="https://en.wikipedia.org/wiki/Leaky_bucket" target="_blank" rel="noopener">Leaky Bucket</a>)</h2><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-29-145111.jpg" alt="img"></p><p>æ»‘åŠ¨æ—¶é—´çª—å£æ— æ³•åº”å¯¹ç»†æ—¶é—´ç²’åº¦ï¼ˆæŸä¸ªæ—¶é—´ï¼‰çš„çªå‘æ€§è¯·æ±‚ï¼Œç¤ºä¾‹ï¼šå½“ t_1 = 1msï¼Œæ¥äº† 50 ä¸ªè¯·æ±‚ï¼Œçª—å£æœ‰ 50 ä¸ªæ—¶é—´ç‚¹äº†ï¼Œä¸­é—´æ²¡æœ‰è¯·æ±‚ï¼Œt_3 = 900 msï¼Œåˆæ¥äº† 100 ä¸ªè¯·æ±‚ï¼Œåªèƒ½åŠ å…¥ 50 ä¸ªã€‚</p><p>æ¼æ¡¶ç®—æ³•åœ¨æ­¤æ–¹é¢æœ‰æ›´å¥½çš„è¡¨ç°ï¼Œå®ƒä»¥æŒ‡å®šé€Ÿåº¦æ¼å‡ºè¯·æ±‚ï¼ˆæ°´ï¼‰ï¼Œå¦‚æœå¯ä»¥å¾€æ¡¶é‡ŒåŠ è¯·æ±‚ï¼Œä»£è¡¨è¯·æ±‚å¯ä»¥è®¿é—®ã€‚æ¼å‡ºé‡æ— éœ€ä½¿ç”¨é¢å¤–çº¿ç¨‹æ§åˆ¶ï¼Œæ ¹æ®æ—¶é—´é—´éš”å’Œé€Ÿç‡å‡å°‘ã€‚</p><p>å‡è®¾é™åˆ¶æ¯ç§’è¯·æ±‚æ•°é™åˆ¶ä¸º 100ï¼Œé‚£ä¹ˆè®¾ç½®æ¡¶çš„å®¹é‡ä¸º 100ï¼Œ1 ç§’æ¼å®Œï¼Œæµé€Ÿä¸º 100 request/sï¼ˆ0.1 request/msï¼‰ï¼Œé»˜è®¤å®¹é‡ä¸º 0ã€‚</p><p>ä¼ªä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeakyBucketDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp = getNowTime();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity = <span class="number">100</span>; <span class="comment">// æ¡¶çš„å®¹é‡ 100</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> rate = <span class="number">0.1f</span>; <span class="comment">// æ°´æ¼å‡ºçš„é€Ÿåº¦ 0.1ï¼ˆæµ®ç‚¹å‹ * æ•´æ•°ç»“æœå»é™¤ç²¾åº¦ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> water = <span class="number">0</span>; <span class="comment">// å½“å‰æ°´é‡(å½“å‰ç´¯ç§¯è¯·æ±‚æ•°) 0</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = getNowTime();</span><br><span class="line">        water = max(<span class="number">0</span>, water - (now - timeStamp) * rate); <span class="comment">// å…ˆæ‰§è¡Œæ¼æ°´ï¼Œè®¡ç®—å‰©ä½™æ°´é‡</span></span><br><span class="line">        timeStamp = now;</span><br><span class="line">        <span class="keyword">if</span> ((water + <span class="number">1</span>) &lt; capacity) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•åŠ æ°´,å¹¶ä¸”æ°´è¿˜æœªæ»¡</span></span><br><span class="line">            water += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ°´æ»¡ï¼Œæ‹’ç»åŠ æ°´</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æä¸´ç•Œæƒ…å†µï¼šæ¼æ¡¶ç®—æ³•æ²¡æœ‰æ—¶é—´çª—å£çš„æ¦‚å¿µï¼Œå¦‚æœ water è¿˜æ˜¯ 0ï¼Œå½“ 10ms æœ‰ 100 ä¸ªè¯·æ±‚è¿‡æ¥åï¼Œæ­¤æ—¶ water å®¹é‡ä¸º 100ï¼Œ10ms èƒ½æ¼æ‰çš„è¯·æ±‚ 10*0.1 = 1ï¼Œwater = 99ã€‚æ‰€ä»¥è¯·æ±‚ 101 æ¬¡æ—¶ï¼Œè¯·æ±‚å°†è¢«æ‹’ç»ã€‚</p><p>åˆ†æç»†æ—¶é—´ç²’åº¦çš„çªå‘æ€§è¯·æ±‚æƒ…å†µï¼š50 ä¸ªè¯·æ±‚åœ¨ 899ms çš„æ—¶é—´å†…å·²ç»æ¼å®Œäº†ï¼Œæ‰€ä»¥ç¬¬ 900ms çš„ 100 ä¸ªè¯·æ±‚å¯ä»¥å®¹çº³ã€‚</p><h2 id="4ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken-bucketï¼‰"><a href="#4ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken-bucketï¼‰" class="headerlink" title="4ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken bucketï¼‰"></a>4ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆ<a href="https://en.wikipedia.org/wiki/Token_bucket" target="_blank" rel="noopener">Token bucket</a>ï¼‰</h2><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-27-105409.jpg" alt="image"></p><p>ä¸Šé¢æ¼æ¡¶ç®—æ³•æ˜¯å¾€é‡Œé¢å¡ï¼Œè¿™ä¸ªä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ä»é‡Œé¢å–ã€‚ä»¥ä¸€ä¸ªå›ºå®šçš„é€Ÿç‡å¾€æ¡¶ä¸­åŠ  tokenï¼ˆä»¤ç‰Œï¼‰ï¼Œæ¯æ¬¡è¯·æ±‚å‡ä»æ¡¶ä¸­å–ä¸€ä¸ªä»¤ç‰Œï¼Œæ²¡æœ‰ä»¤ç‰Œå°†ä¸èƒ½è®¿é—®ã€‚æ·»åŠ ä»¤ç‰Œä¹Ÿæ— éœ€ä½¿ç”¨é¢å¤–çº¿ç¨‹æ§åˆ¶ï¼Œæ ¹æ®æ—¶é—´é—´éš”å’Œé€Ÿç‡æ¥æ·»åŠ ã€‚</p><p>å‡è®¾é™åˆ¶æ¯ç§’è¯·æ±‚æ•°é™åˆ¶ä¸º 100ï¼Œé‚£ä¹ˆæ¯ 1 ç§’æœ€å¤šå–èµ° 100 ä¸ª tokenï¼Œæ¡¶çš„å®¹é‡ 100ï¼Œä»¤ç‰Œæ”¾å…¥çš„é€Ÿåº¦ 100 token/sï¼Œ0.1 token/msã€‚</p><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenBucketDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp = getNowTime();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity = <span class="number">100</span>; <span class="comment">// æ¡¶çš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> rate = <span class="number">0.1f</span>; <span class="comment">// ä»¤ç‰Œæ”¾å…¥é€Ÿåº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tokens = <span class="number">100</span>; <span class="comment">// å½“å‰ä»¤ç‰Œæ•°é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = getNowTime();</span><br><span class="line">        <span class="comment">// å…ˆæ·»åŠ ä»¤ç‰Œ</span></span><br><span class="line">        tokens = min(capacity, tokens + (now - timeStamp) * rate); </span><br><span class="line">        timeStamp = now;</span><br><span class="line">        <span class="keyword">if</span> (tokens &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// è‹¥ä¸åˆ° 1 ä¸ªä»¤ç‰Œ,åˆ™æ‹’ç»</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è¿˜æœ‰ä»¤ç‰Œï¼Œé¢†å–ä»¤ç‰Œ</span></span><br><span class="line">            tokens -= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœé™åˆ¶è¯·æ±‚å¾ˆä½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è®¡æ•°å™¨ï¼ˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•ï¼‰ã€‚</p><p>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•éœ€è¦æ›´å¤šçš„å†…å­˜ã€‚</p><p>ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•å½“å‡ºç°å³°å€¼åï¼Œæ·»åŠ  token å’Œæ¼æ°´æœ‰é€Ÿåº¦æ§åˆ¶ï¼Œä¸‹ä¸€æ¬¡ä¸èƒ½é©¬ä¸Šè¾¾åˆ°å³°å€¼ï¼Œæ‰€ä»¥ç›¸æ¯”å›ºå®šæ—¶é—´çª—å£ç®—æ³•æ›´åŠ å¹³æ»‘ã€‚</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-10-27-155606.jpg" alt=""></p><p>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå½“æ¡¶æ»¡äº†ï¼Œå¯ä»¥ä¸€ä¸‹æ‹¿èµ° 100 ä¸ªä»¤ç‰Œã€‚æ¼æ¡¶ç®—æ³•ï¼Œæ¼å®Œäº†ï¼Œä¸€æ¬¡å¯ä»¥åŠ  100 ä¸ªè¯·æ±‚ã€‚æ‰€ä»¥ç›¸æ¯”æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•å¯åº”å¯¹çªå‘æ€§è¯·æ±‚ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¹Ÿä¸ä¼šç›´æ¥ç”¨ä»£ç å»å®ç°ç›¸åº”çš„ç®—æ³•ï¼Œè€Œæ˜¯åœ¨ ngix ä¸­<a href="http://nginx.org/en/docs/http/ngx_http_limit_req_module.html" target="_blank" rel="noopener">é…ç½®</a>ï¼Œngix é™æµé»˜è®¤ä½¿ç”¨çš„æ¼æ¡¶ç®—æ³•ã€‚</p><!--æ‰€ä»¥ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•æ¯”è¾ƒé€‚åˆé˜»å¡å¼é™æµã€‚--><!--åœ¨ä½¿ç”¨ç³»ç»Ÿæœ€å¤§æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œå°½é‡æ˜¯è¯·æ±‚å‡åŒ€åˆ†å¸ƒ--><!--ngix é…ç½®ã€hystrix--><!--æ¼æ¡¶ç®—æ³•å–çš„é€Ÿåº¦å¯æ§åˆ¶ï¼Ÿ--><!--QPSï¼ŒæœåŠ¡çº¿ç¨‹æœ‰å¤šå°‘ï¼Ÿ--><!--cpu æ•°ï¼Œçº¿ç¨‹æ•°ï¼Œè¯·æ±‚æ•°ï¼Œè¯·æ±‚æ—¶é—´--><!--8 æ ¸çº¿ç¨‹ï¼Œ100 ä¸ªçº¿ç¨‹--><!--å¸¦å®½ï¼Œæ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•° (TPS)ï¼Œæ¯ç§’è¯·æ±‚æ•° (hits per second)ã€å¹¶å‘è¯·æ±‚æ•°ã€‚--><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://juejin.im/entry/6844903443484639240" target="_blank" rel="noopener">æ¥å£é™æµç®—æ³•æ€»ç»“</a></li><li><a href="https://www.infoq.cn/article/microservice-interface-rate-limit" target="_blank" rel="noopener">å¾®æœåŠ¡æ¥å£é™æµçš„è®¾è®¡ä¸æ€è€ƒï¼ˆé™„ GitHub æ¡†æ¶æºç ï¼‰</a></li></ul><!--[æ¥å£é™æµçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼ï¼ï¼](https://www.cnblogs.com/Chenjiabing/p/12534346.html)--><!--[Everything You Need To Know About API Rate Limiting](https://nordicapis.com/everything-you-need-to-know-about-api-rate-limiting/)-->]]></content:encoded>
      
      <comments>https://depp.wang/2020/10/27/several-algorithms-for-api-rate-limiting/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Java å®ç°ä¸€ä¸ªè‡ªå®šä¹‰åˆ†å¸ƒå¼ Session</title>
      <link>https://depp.wang/2020/10/26/java-implements-a-custom-distributed-session/</link>
      <guid>https://depp.wang/2020/10/26/java-implements-a-custom-distributed-session/</guid>
      <pubDate>Mon, 26 Oct 2020 11:55:55 GMT</pubDate>
      <description>
      
        &lt;p&gt;HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯å¦‚æœéœ€è¦è®°ä½ç™»å½•ç”¨æˆ·ï¼Œå°±éœ€è¦ç»´æŠ¤ä¸€ä¸ª SessionId(Cookie) - Session çš„é”®å€¼å¯¹ã€‚Session å­˜æ”¾ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ã€‚ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ä½œä¸º Session çš„ä¸€ä¸ª Attributeã€‚å½“æµè§ˆå™¨è¯·æ±‚ä¸­åŒ…å« Cookie æ—¶ï¼ŒæœåŠ¡å™¨å°±èƒ½è¯†åˆ«å‡ºå…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯å¦‚æœéœ€è¦è®°ä½ç™»å½•ç”¨æˆ·ï¼Œå°±éœ€è¦ç»´æŠ¤ä¸€ä¸ª SessionId(Cookie) - Session çš„é”®å€¼å¯¹ã€‚Session å­˜æ”¾ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ã€‚ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ä½œä¸º Session çš„ä¸€ä¸ª Attributeã€‚å½“æµè§ˆå™¨è¯·æ±‚ä¸­åŒ…å« Cookie æ—¶ï¼ŒæœåŠ¡å™¨å°±èƒ½è¯†åˆ«å‡ºå…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚</p><a id="more"></a><p>é»˜è®¤ SessionId ä¸ Session çš„é”®å€¼å¯¹ç”±æœåŠ¡å™¨æ¥ç»´æŠ¤ï¼ŒSession çš„è¿‡æœŸæ—¶é—´é»˜è®¤ä¸º 30 åˆ†é’Ÿï¼ˆå¯é€šè¿‡ Debug æŸ¥çœ‹ maxInactiveInterval çš„å€¼ï¼‰ã€‚</p><h2 id="ä½¿ç”¨-HttpSession"><a href="#ä½¿ç”¨-HttpSession" class="headerlink" title="ä½¿ç”¨ HttpSession"></a>ä½¿ç”¨ HttpSession</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ Session æ¥ä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€çš„ä¾‹å­ï¼Œç›¸å…³ä»£ç æˆ‘æ”¾åˆ°äº† <a href="https://github.com/DeppWang/springboot-session" target="_blank" rel="noopener">GitHub</a> ä¸Š</p><p><strong>è®¾ç½® Attribute</strong>ï¼ˆç™»å½•æ—¶ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/signin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSignin</span><span class="params">(@RequestParam(<span class="string">"email"</span>)</span> String email, @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password, HttpSession session) </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">User user = userService.signin(email, password);</span><br><span class="line">session.setAttribute(KEY_USER, user);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"signin.html"</span>, Map.of(<span class="string">"email"</span>, email, <span class="string">"error"</span>, <span class="string">"Signin failed"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/profile"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·å– Attribute</strong>ï¼ˆåˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½•ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/profile"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">profile</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">User user = (User) session.getAttribute(KEY_USER);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/signin"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"profile.html"</span>, Map.of(<span class="string">"user"</span>, user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤ Attribute</strong>ï¼ˆé€€å‡ºæ—¶ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/signout"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">signout</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">session.removeAttribute(KEY_USER);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect:/signin"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>HttpSession session</code> å¯ä»¥ç”¨ <code>HTTPServletRequest request</code> ä»£æ›¿ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>request.getSession().getAttribute()</code>ã€‚<code>HttpSession session</code> å’Œ <code>HTTPServletRequest request</code> å¯ä»¥è®¤ä¸ºæ˜¯æ–¹æ³•é»˜è®¤å°±åŒ…å«çš„å‚æ•°ã€‚</p><p>Session çš„ç”Ÿå‘½å‘¨æœŸæ˜¯åŠå°æ—¶ï¼Œå¦‚æœåŠå°æ—¶åè®¿é—®æ—¶ï¼ŒæœåŠ¡å™¨å°†é‡æ–°å»ºç«‹è¿æ¥ï¼Œå°†å‘é€æ–°çš„ SessionId åˆ°æµè§ˆå™¨ï¼Œå†æ¬¡è®¿é—®æ—¶ï¼Œ æ–° Session ä¸­å°†æ²¡æœ‰ Userï¼Œæ­¤æ—¶ç™»å½•å°†å¤±æ•ˆã€‚</p><p>æµè§ˆå™¨ Cookie æ ·å¼ï¼š</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Cookie: <span class="attribute">JSESSIONID</span>=C8698B74AFAD403C6E28D77B75373500</span><br></pre></td></tr></table></figure><p>æ­¤éƒ¨åˆ†ä»£ç å¯¹åº” <a href="https://github.com/DeppWang/springboot-demos/tree/master/springboot-session/src/main/java/wang/depp/session/web/v1" target="_blank" rel="noopener">v1</a></p><h2 id="ä½¿ç”¨-Redis"><a href="#ä½¿ç”¨-Redis" class="headerlink" title="ä½¿ç”¨ Redis"></a>ä½¿ç”¨ Redis</h2><p>å½“å­˜åœ¨è·¨åŸŸé—®é¢˜æ—¶ï¼Œå³å¤šä¸ªæœåŠ¡éƒ½éœ€è¦ç”¨åˆ° Session åˆ¤æ–­ç™»å½•çŠ¶æ€æ—¶ï¼Œå°±éœ€è¦å°† Session åœ¨æ¯ä¸ªæœåŠ¡ä¸­å¤åˆ¶ä¸€ä»½ï¼Œæˆ–åšæˆåˆ†å¸ƒå¼ Sessionã€‚ä¸€èˆ¬ä½¿ç”¨ Redis å®ç°ã€‚</p><p>ä¸‹é¢ä½¿ç”¨ Redis æ¥ç»´æŠ¤è¿™ä¸ª SessionId - Session çš„é”®å€¼å¯¹ï¼Œæˆ–è€…è¯´ç»´æŠ¤ä¸€ä¸ª SessionId - Attributes çš„é”®å€¼å¯¹ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE_TIME = <span class="number">1800</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpServletRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletRequestAttributes attrs = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="keyword">return</span> attrs.getRequest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(String name, Object value)</span> </span>&#123;</span><br><span class="line">        String sessionId = getRequest().getSession().getId();</span><br><span class="line">        Map&lt;String, Object&gt; attributes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        attributes.put(name, value);</span><br><span class="line">        RedisUtils.setKey(sessionId, JsonUtils.getJson(attributes), EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">getAttribute</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        String sessionId = getRequest().getSession().getId();</span><br><span class="line">        String attributesJson = RedisUtils.getKey(sessionId);</span><br><span class="line">        Map&lt;String, Object&gt; attributes = JsonUtils.fromJson(attributesJson, Map.class);</span><br><span class="line">        <span class="keyword">return</span> attributes.get(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> User <span class="title">getKeyUser</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Object user = getAttribute(name);</span><br><span class="line">        <span class="keyword">return</span> JsonUtils.fromJson(user.toString(), User.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">removeAttribute</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        String sessionId = getRequest().getSession().getId();</span><br><span class="line">        String attributesJson = RedisUtils.getKey(sessionId);</span><br><span class="line">        Map&lt;String, Object&gt; attributes = JsonUtils.fromJson(attributesJson, HashMap.class);</span><br><span class="line">        attributes.remove(name);</span><br><span class="line">        RedisUtils.setKey(sessionId, JsonUtils.getJson(attributes), EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ RedisUtilsï¼Œä½¿ç”¨é™æ€æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate autowiredStringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate = <span class="keyword">this</span>.autowiredStringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(String key, String value, <span class="keyword">long</span> timeout, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(addKeyPrefix(key), value, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringRedisTemplate.opsForValue().get(addKeyPrefix(key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">deleteKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringRedisTemplate.opsForValue().getOperations().delete(addKeyPrefix(key));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">incrementKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringRedisTemplate.opsForValue().increment(addKeyPrefix(key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">addKeyPrefix</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"session:%s"</span>, key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserController </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/signin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSignin</span><span class="params">(@RequestParam(<span class="string">"email"</span>)</span> String email, @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">User user = userService.signin(email, password);</span><br><span class="line">setAttribute(KEY_USER, user);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"signin.html"</span>, Map.of(<span class="string">"email"</span>, email, <span class="string">"error"</span>, <span class="string">"Signin failed"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/profile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/profile"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">profile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">User user = getKeyUser(KEY_USER);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/signin"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"profile.html"</span>, Map.of(<span class="string">"user"</span>, user));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/signout"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">signout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">removeAttribute(KEY_USER);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect:/signin"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤éƒ¨åˆ†ä»£ç å¯¹åº” <a href="https://github.com/DeppWang/springboot-demos/tree/master/springboot-session/src/main/java/wang/depp/session/web/v2" target="_blank" rel="noopener">v2</a></p><h2 id="è‡ªå®šä¹‰-Session"><a href="#è‡ªå®šä¹‰-Session" class="headerlink" title="è‡ªå®šä¹‰ Session"></a>è‡ªå®šä¹‰ Session</h2><!--ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ Sessionï¼Ÿ è½¬å‘åçš„è¯·æ±‚å°±åŒ…å«äº† Sessionï¼Œä¸ç”¨ä¼ è¾“å‚æ•°ï¼Ÿ--><p>ä¸Šé¢è¿™ç§æ–¹å¼å®ç°äº†ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒå¼ Sessionï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ Session æ¥å¯¹å…¶è¿›è¡Œä¸€å®šä¼˜åŒ–ï¼Œä½¿å…¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å°è£… Attribute çš„è®¾ç½®ä¸è·å–çš„å®ç°ç»†èŠ‚</li><li>å¯ä»¥è‡ªå®šä¹‰ Cookie</li><li>Attributes åšä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼Œè‡ªå®šä¹‰ Session ä¸­å­˜æ”¾ä¸€ä»½ï¼ŒRedis å†å­˜æ”¾ä¸€ä»½ã€‚</li></ul><p>éœ€è¦åˆ©ç”¨ä¸‹é¢è¿™å‡ ä¸ªåŸç”Ÿç±»ï¼š</p><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">HttpSession</span></span><br><span class="line"><span class="attribute">HttpServletRequestWrapper</span></span><br><span class="line"><span class="attribute">HttpServletResponseWrapper</span></span><br></pre></td></tr></table></figure><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>1ã€è®¾ç½®è‡ªå®šä¹‰ Sessionã€Request å’Œ Response</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperSession</span> <span class="keyword">implements</span> <span class="title">HttpSession</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;StoreType, SessionStore&gt; sessionStores;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperSessionServletRequest</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> WrapperSession wrapperSession;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperSessionServletResponse</span> <span class="keyword">extends</span> <span class="title">HttpServletResponseWrapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> WrapperSession session;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨ session-config.xml é…ç½® cookie å’Œ cacheï¼Œä¸€ä¸ª entry å¯¹åº”ä¸€ä¸ª SessionConfigEntryã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sessionConfig</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">name</span>=<span class="string">"sessionId"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>js<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">httponly</span>&gt;</span>true<span class="tag">&lt;/<span class="name">httponly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>true<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">encrypt</span>&gt;</span>false<span class="tag">&lt;/<span class="name">encrypt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">storeType</span>&gt;</span>cookie<span class="tag">&lt;/<span class="name">storeType</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">       <span class="tag">&lt;<span class="name">entry</span> <span class="attr">name</span>=<span class="string">"__user__"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">storeType</span>&gt;</span>cache<span class="tag">&lt;/<span class="name">storeType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>wang.depp.session.entity.User<span class="tag">&lt;/<span class="name">type</span>&gt;</span> <span class="comment">&lt;!--ç±»å‹ç”¨äº String è½¬æ¢ å¯¹è±¡--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">entries</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">sessionConfig</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionConfigEntry</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> StoreType storeType;</span><br><span class="line">    <span class="keyword">private</span> String domain;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨ CookieStore å­˜æ”¾ Cookieã€‚ä½¿ç”¨ CacheStore å­˜æ”¾ attributesï¼Œè·å– attribute æ—¶é»˜è®¤ç›´æ¥ä» CacheStore ä¸­å–ï¼ˆCacheStore ä» Redis ç¼“å­˜ä¸­è¯»å–ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheStore</span> <span class="keyword">implements</span> <span class="title">SessionStore</span>, <span class="title">SessionCacheContainerAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WrapperSessionServletRequest wrapperRequest;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; attributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieStore</span> <span class="keyword">implements</span> <span class="title">SessionStore</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; undecodedCookies = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Attribute&gt; attributes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è·¯è°ƒç”¨"><a href="#é“¾è·¯è°ƒç”¨" class="headerlink" title="é“¾è·¯è°ƒç”¨"></a>é“¾è·¯è°ƒç”¨</h3><p>1ã€é¡¹ç›®å¯åŠ¨æ—¶æ ¹æ® session-config.xml ä¸­åˆå§‹åŒ– SessionConfigEntry</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperSessionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">         WrapperSessionServletRequest krqRequest = <span class="keyword">new</span> WrapperSessionServletRequest((HttpServletRequest) request);</span><br><span class="line">         WrapperSessionServletResponse krqResponse = <span class="keyword">new</span> WrapperSessionServletResponse((HttpServletResponse) response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        initSessionStore();</span><br><span class="line">        <span class="keyword">this</span>.sessionId = getSessionId(); <span class="comment">// ä» CookieStore çš„ attributes ä¸­è·å– sessionId</span></span><br><span class="line">        generateTrackId();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initSessionStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (SessionStore sessionStore : sessionStores.values()) &#123;</span><br><span class="line">            sessionStore.init(); <span class="comment">// åˆ†åˆ«è°ƒç”¨å­ç±»çš„ init() æ–¹æ³•</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>2ã€è¯·æ±‚æ—¶ï¼Œæ‹¦æˆªï¼ŒæŸ¥æ‰¾ SessionId åœ¨ Redis æ˜¯å¦æœ‰å¯¹åº”çš„ Attributesï¼Œè®¾ç½®æ—¶å…ˆè®¾ç½®åˆ° SessionStore</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheStore</span> <span class="keyword">implements</span> <span class="title">SessionStore</span>, <span class="title">SessionCacheContainerAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WrapperSessionServletRequest wrapperRequest;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; attributes;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(SessionConfigEntry sessionConfigEntry, Object value)</span> </span>&#123;</span><br><span class="line">        value = RedisUtils.getKey(wrapperRequest.getSession().getId());; <span class="comment">// è®¾ç½®å‰ï¼Œå…ˆä» Redis å†™å…¥ attributes</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == value) &#123; <span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼Œåˆ é™¤</span></span><br><span class="line">            attributes.remove(sessionConfigEntry.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            attributes.put(sessionConfigEntry.getName(), value);  <span class="comment">// å¦‚æœå­˜åœ¨ï¼Œå°†æ›´æ–°</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€è¿”å›å‰ç«¯å‰ï¼Œå°† Attributes æ›´æ–°åˆ° Redis</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperSessionServletResponse</span> <span class="keyword">extends</span> <span class="title">HttpServletResponseWrapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PrintWriter <span class="title">getWriter</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        getSession().commit(); <span class="comment">// å»¶é•¿ session çš„æ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getWriter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        writeToCache();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeToCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (attributes.entrySet().size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">            String value = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                value = mapper.writeValueAsString(attributes);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            RedisUtils.setKey(wrapperRequest.getSession().getId(), value, wrapperRequest.getSession().getMaxInactiveInterval());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>4ã€è·å–æ—¶ï¼Œç›´æ¥ä» SessionStore ä¸­è·å–ï¼Œé»˜è®¤å°†ä» Redis ä¸­è¯»å–ä¸€æ¬¡ï¼Œè¯»å–åå°†ä¸å†è¯»å–ï¼Œå› ä¸ºä»¥åéƒ½å°±å°†å†™å…¥ Attributes</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getAttribute</span><span class="params">(SessionConfigEntry sessionConfigEntry)</span> </span>&#123;</span><br><span class="line">    loadCache(); <span class="comment">// å…ˆä» Redis å†™å…¥ attributesï¼Œå½“ readFromCache() æ–¹æ³•è°ƒç”¨åï¼Œæ­¤æ—¶å°†ä¸å†ä» Redis ä¸­è·å–ã€‚å¦‚æœå½“å‰å¯¹è±¡ä¸€ç›´å­˜æ´»ï¼Œç›´æ¥å†™å…¥åˆ° attributeï¼Œå°†ä¸ç”¨ä» Redis ä¸­è¯»å–</span></span><br><span class="line">    <span class="keyword">return</span> attributes.get(sessionConfigEntry.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>UserController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/signin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSignin</span><span class="params">(@RequestParam(<span class="string">"email"</span>)</span> String email, @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">User user = userService.signin(email, password);</span><br><span class="line">setAttribute(KEY_USER, user);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"signin.html"</span>, Map.of(<span class="string">"email"</span>, email, <span class="string">"error"</span>, <span class="string">"Signin failed"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/profile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/profile"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">profile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">User user = (User) getAttribute(KEY_USER);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"redirect:/signin"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"profile.html"</span>, Map.of(<span class="string">"user"</span>, user));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/signout"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">signout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">removeAttribute(KEY_USER);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect:/signin"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BaseController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰ HttpServletRequest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpServletRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletRequestAttributes attrs = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="keyword">return</span> attrs.getRequest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(String name, Object value)</span> </span>&#123;</span><br><span class="line">        getRequest().getSession().setAttribute(name, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getAttribute</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getRequest().getSession().getAttribute(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeAttribute</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        getRequest().getSession().removeAttribute(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤éƒ¨åˆ†ä»£ç å¯¹åº” <a href="https://github.com/DeppWang/springboot-demos/tree/master/springboot-session/src/main/java/wang/depp/session/web/v3" target="_blank" rel="noopener">v3</a>ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è‡ªå®šä¹‰åˆ†å¸ƒå¼ Session ä¸€èˆ¬å®ç°åœ¨ç½‘å…³ä¸­ï¼Œç½‘å…³æ¥å£å¯¹å¤–æš´éœ²ï¼Œè¯·æ±‚å…ˆè°ƒç”¨ç½‘å…³ï¼Œç½‘å…³è¯·æ±‚åªèƒ½å†…ç½‘è®¿é—®çš„ä¸šåŠ¡ç³»ç»Ÿæ¥å£ã€‚ç½‘å…³å’Œä¸šåŠ¡ç³»ç»Ÿè§„å®šç›¸åº”çš„è°ƒç”¨è§„åˆ™ï¼ˆå¦‚ï¼šæ·»åŠ æŒ‡å®š Headerï¼‰ï¼Œç½‘å…³æ¥è´Ÿè´£éªŒè¯ç™»å½•çŠ¶æ€ã€‚</p><p>Redis å¯ä»¥å®ç°é›†ç¾¤ä¿è¯å¯ç”¨æ€§ã€‚å½“ä¸ä½¿ç”¨åˆ†å¸ƒå¼ Session æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" target="_blank" rel="noopener">JSON Web Token</a></p>]]></content:encoded>
      
      <comments>https://depp.wang/2020/10/26/java-implements-a-custom-distributed-session/#disqus_thread</comments>
    </item>
    
    <item>
      <title>HashMap å¸¸é—®çš„ 9 ä¸ªé—®é¢˜</title>
      <link>https://depp.wang/2020/08/20/hashmap-9-question/</link>
      <guid>https://depp.wang/2020/08/20/hashmap-9-question/</guid>
      <pubDate>Thu, 20 Aug 2020 17:58:35 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;img src=&quot;https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-22-111236.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;!--[img](https://javabynataraj.files.wordpress.com/2014/06/types_of_hashmapiteration_javabynataraj.png)--&gt;

&lt;h2 id=&quot;1ã€HashMap-çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#1ã€HashMap-çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1ã€HashMap çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;1ã€HashMap çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;&lt;p&gt;HashMap æˆ‘ä»¬çŸ¥é“ HashMap çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å¯ä»¥ç†è§£ä¸ºæ•°ç»„+é“¾è¡¨æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœåªæ˜¯æ•°ç»„ï¼Œå°±å­˜åœ¨æ•°ç»„çš„ç¼ºç‚¹ï¼Œå¦‚ï¼šéœ€è¦æ›´é•¿çš„è¿ç»­å†…å­˜ç©ºé—´ï¼›æ‰©å®¹æ›´åŠ é¢‘ç¹ï¼›å¹¶ä¸”åˆ é™¤æ“ä½œéœ€è¦ç§»åŠ¨å…¶ä»–å…ƒç´ ä½ç½®ï¼Œç­‰ç­‰&lt;/li&gt;
&lt;li&gt;å¦‚æœåªæ˜¯é“¾è¡¨ï¼Œå°±å­˜åœ¨é“¾è¡¨çš„ç¼ºç‚¹ï¼Œå¦‚ï¼šæŸ¥æ‰¾å¤æ‚åº¦ O(n) å¤ªé«˜ï¼Œç­‰ç­‰&lt;/li&gt;
&lt;li&gt;è€Œæ•°ç»„+é“¾è¡¨æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-22-111236.png" alt="img"></p><!--[img](https://javabynataraj.files.wordpress.com/2014/06/types_of_hashmapiteration_javabynataraj.png)--><h2 id="1ã€HashMap-çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€HashMap-çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€HashMap çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€HashMap çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>HashMap æˆ‘ä»¬çŸ¥é“ HashMap çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å¯ä»¥ç†è§£ä¸ºæ•°ç»„+é“¾è¡¨æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</p><ul><li>å¦‚æœåªæ˜¯æ•°ç»„ï¼Œå°±å­˜åœ¨æ•°ç»„çš„ç¼ºç‚¹ï¼Œå¦‚ï¼šéœ€è¦æ›´é•¿çš„è¿ç»­å†…å­˜ç©ºé—´ï¼›æ‰©å®¹æ›´åŠ é¢‘ç¹ï¼›å¹¶ä¸”åˆ é™¤æ“ä½œéœ€è¦ç§»åŠ¨å…¶ä»–å…ƒç´ ä½ç½®ï¼Œç­‰ç­‰</li><li>å¦‚æœåªæ˜¯é“¾è¡¨ï¼Œå°±å­˜åœ¨é“¾è¡¨çš„ç¼ºç‚¹ï¼Œå¦‚ï¼šæŸ¥æ‰¾å¤æ‚åº¦ O(n) å¤ªé«˜ï¼Œç­‰ç­‰</li><li>è€Œæ•°ç»„+é“¾è¡¨æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆ</li></ul><a id="more"></a><h2 id="2ã€ä¸ºä»€ä¹ˆæ•°ç»„çš„é»˜è®¤é•¿åº¦æ˜¯-16ï¼Ÿ"><a href="#2ã€ä¸ºä»€ä¹ˆæ•°ç»„çš„é»˜è®¤é•¿åº¦æ˜¯-16ï¼Ÿ" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆæ•°ç»„çš„é»˜è®¤é•¿åº¦æ˜¯ 16ï¼Ÿ"></a>2ã€ä¸ºä»€ä¹ˆæ•°ç»„çš„é»˜è®¤é•¿åº¦æ˜¯ 16ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* The default âˆinitial capacity - MUST be a power of two. é»˜è®¤åˆå§‹å®¹é‡å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br></pre></td></tr></table></figure><p>è¿™è·Ÿè®¡ç®—æ•°ç»„ä¸‹æ ‡æœ‰å…³ï¼Œè®¡ç®—æ•°ç»„ä¸‹æ ‡çš„ä»£ç ä¸º <code>index = hash &amp; (n-1)</code>ï¼Œå½“ n ä¸º 2 çš„å¹‚ï¼Œå¦‚ 16ï¼Œn-1 = 15ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸º <code>1111</code>ï¼Œé€šè¿‡æŒ‰ä½ä¸ <code>&amp;</code> ï¼Œæ•°ç»„ä¸‹æ ‡å°±ç”± hash äºŒè¿›åˆ¶çš„ä½ 4 ä½å†³å®šã€‚æ¯”èµ·ä¼ ç»Ÿçš„å–æ¨¡ï¼ˆä½™ï¼‰æ“ä½œï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><h2 id="3ã€ä¸ºä»€ä¹ˆ-HashMap-æ²¡æœ‰ç›´æ¥ç”¨-Key-çš„-hashCodeï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„-hashï¼Ÿ"><a href="#3ã€ä¸ºä»€ä¹ˆ-HashMap-æ²¡æœ‰ç›´æ¥ç”¨-Key-çš„-hashCodeï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„-hashï¼Ÿ" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆ HashMap æ²¡æœ‰ç›´æ¥ç”¨ Key çš„ hashCodeï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„ hashï¼Ÿ"></a>3ã€ä¸ºä»€ä¹ˆ HashMap æ²¡æœ‰ç›´æ¥ç”¨ Key çš„ hashCodeï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„ hashï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">hash = (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>åŒæ ·è·Ÿæ•°ç»„ä¸‹æ ‡æœ‰å…³ï¼ŒHashMap æ²¡æœ‰ç”¨å–æ¨¡ï¼ˆä½™ï¼‰è¿ç®—ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ä½ 4 ä½ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œå¦‚æœä½¿ç”¨ hashCode ä½ 4 ä½ï¼Œç¢°æ’å‡ ç‡å¾ˆå¤§ï¼Œå°† hashCode çš„ä½ä½å’Œé«˜ä½å¼‚æˆ–ç”Ÿæˆ hashï¼Œå– hash çš„ä½ 4 ä½ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œå¯ä»¥å¢åŠ ä½ä½çš„éšæœºæ€§ï¼Œå‡å°‘ç¢°æ’ã€‚<code>&gt;&gt;&gt;</code> ä¸º<a href="https://depp.wang/2020/01/11/java-operator/#gt-gt-gt-æ— ç¬¦å·å³ç§»è¿ç®—ç¬¦">æ— ç¬¦å·å³ç§»</a>ï¼Œ<code>h &gt;&gt;&gt; 16</code>ï¼šèˆå¼ƒå³è¾¹ 16 ä½ï¼Œå°†é«˜ä½å‘å³ç§»åŠ¨ 16 ä½ï¼Œå·¦è¾¹ç”¨ 0 è¡¥é½ã€‚</p><p>å½“ key == null æ—¶ï¼Œhash ä¸º 0ï¼Œæ‰€ä»¥ key å¯ä»¥ä¸º nullã€‚</p><h2 id="4ã€æ‰©å®¹å› å­ä¸º-0-75ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#4ã€æ‰©å®¹å› å­ä¸º-0-75ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="4ã€æ‰©å®¹å› å­ä¸º 0.75ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>4ã€æ‰©å®¹å› å­ä¸º 0.75ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// As a general rule, the default load factor (.75) offers a good tradeoff between time and space costs. Higher values decrease the space overhead but increase the lookup cost (reflected in most of the operations of the HashMap class, including get and put).</span></span><br><span class="line"><span class="comment">// ä½œä¸ºä¸€èˆ¬çš„è§„åˆ™ï¼Œé»˜è®¤æ‰©å®¹å› å­ï¼ˆ.75ï¼‰åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æŠ˜ä¸­ã€‚è¾ƒé«˜çš„å€¼å‡å°‘äº†ç©ºé—´å¼€é”€ï¼Œä½†å¢åŠ äº†æŸ¥æ‰¾æˆæœ¬ï¼ˆåæ˜ åœ¨ HashMap ç±»çš„å¤§å¤šæ•°æ“ä½œä¸­ï¼ŒåŒ…æ‹¬ get å’Œ putï¼‰ã€‚ </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯ 0.5 çš„è¯ï¼Œç©ºé—´åˆ©ç”¨ç‡ä¸é«˜ï¼Œæ‰©å®¹å¤ªé¢‘ç¹ã€‚</li><li>å¦‚æœæ˜¯ 1 çš„è¯ï¼Œå› ä¸ºä¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼Œç¢°æ’äº§ç”Ÿé“¾è¡¨ï¼Œæ‰©å®¹åï¼Œé“¾è¡¨å°†æ›´é•¿ï¼ŒæŸ¥æ‰¾å’Œä¿®æ”¹çš„æ—¶é—´å¤æ‚åº¦å°†æ›´é«˜ã€‚</li><li>0.75 æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆã€‚</li><li>æ³¨æ„ï¼šæ‰©å®¹è§¦å‘æ¡ä»¶ 0.75ï¼Œä¸æ˜¯æŒ‡æ•°ç»„ 75% çš„åŒºåŸŸè¢«å ç”¨æ—¶ï¼Œè€Œæ˜¯æŒ‡å½“å‰ Map çš„å®¹é‡ï¼ŒåŒ…æ‹¬é“¾è¡¨ä¸Šçš„å…ƒç´ ã€‚</li></ul><h2 id="5ã€HashMap-å¦‚ä½•æ‰©å®¹ï¼Ÿ"><a href="#5ã€HashMap-å¦‚ä½•æ‰©å®¹ï¼Ÿ" class="headerlink" title="5ã€HashMap å¦‚ä½•æ‰©å®¹ï¼Ÿ"></a>5ã€HashMap å¦‚ä½•æ‰©å®¹ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="keyword">int</span> threshold = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line"><span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">    resize();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸ºåŸæ¥çš„ 2 å€çš„æ–°æ•°ç»„</span></span><br><span class="line">    newCap = oldCap &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">        Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å½“åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ ¹æ®èŠ‚ç‚¹åŸæ¥çš„ hash å’Œæ–°çš„æ•°ç»„é•¿åº¦å¾—åˆ°æ–°çš„æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">            <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">            newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// oldCap åˆå§‹ä¸º 16ï¼Œå³ 10000ï¼Œæœ€é«˜ä½å§‹ç»ˆä¸º 1ï¼Œé€šè¿‡ 1 æ¥éšæœºåˆ¤æ–­ä½¿ç”¨åŸæ•°ç»„ä¸‹æ ‡è¿˜æ˜¯åŠ ä¸ŠåŸæ•°ç»„é•¿åº¦çš„æ–°æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">                <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>)</span><br><span class="line">                    loHead = e</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                    hiHead = e</span><br><span class="line">            <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    newTab[j] = loHead;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    newTab[j + oldCap] = hiHead;</span><br><span class="line">                &#125;    </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆï¼ŒHashMap éœ€è¦æ‰©å®¹ï¼Œå¦åˆ™ï¼Œé“¾è¡¨é•¿åº¦è¿‡é•¿ï¼ŒæŸ¥æ‰¾å’Œä¿®æ”¹çš„å¤æ‚åº¦éƒ½å°†å˜é«˜ã€‚</li><li>æ‰©å®¹æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸ºåŸæ¥çš„ 2 å€çš„æ–°æ•°ç»„ï¼Œéå†åŸæ•°ç»„ï¼Œå¦‚æœå½“å‰ä½ç½®åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æ ¹æ®èŠ‚ç‚¹åŸæ¥çš„ hash å’Œæ–°çš„æ•°ç»„é•¿åº¦å¾—åˆ°æ–°çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ™é€šè¿‡ oldCap æ¥éšæœºåˆ¤æ–­ä½¿ç”¨åŸæ•°ç»„ä¸‹æ ‡è¿˜æ˜¯åŠ ä¸ŠåŸæ•°ç»„é•¿åº¦çš„æ–°æ•°ç»„ä¸‹æ ‡</li><li>å› ä¸ºéœ€è¦æ‰©å®¹ï¼Œéœ€è¦é¢å¤–çš„æ€§èƒ½ï¼Œåœ¨èƒ½ä¼°ç®—å®¹é‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®åˆå§‹å®¹é‡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="6ã€HashMap-ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"><a href="#6ã€HashMap-ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ" class="headerlink" title="6ã€HashMap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"></a>6ã€HashMap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* &lt;p&gt;&lt;strong&gt;Note that this implementation is not synchronized.&lt;/strong&gt;</span></span><br></pre></td></tr></table></figure><ul><li>HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒçš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬æ˜¯ HashTable å’Œ ConcurrentHashMap</li><li>å®ƒçš„çº¿ç¨‹ä¸å®‰å…¨æ˜¯å› ä¸º HashMap å­˜åœ¨å˜é‡ï¼Œå¦‚ DEFAULT_INITIAL_CAPACITY ç­‰ï¼Œå¯¹è±¡åœ¨æ–¹æ³•ä¸­ä½¿ç”¨è¿™äº›å…±äº«å˜é‡æ—¶ï¼Œæ²¡æœ‰åŠ é”ã€‚å…±äº«å˜é‡åœ¨å¹¶å‘æ“ä½œï¼Œå€¼å®¹æ˜“è¢«è¦†ç›–ï¼Œå­˜åœ¨ä¸¢å¤±æ•°æ®çš„é—®é¢˜ã€‚</li><li>åœ¨ jdk 1.7 ä¸­ï¼Œå¹¶å‘æ“ä½œä¸‹ï¼Œæ‰©å®¹æ—¶ï¼Œè¿˜å¯èƒ½é€ æˆæ­»å¾ªç¯ï¼Œ<a href="https://stackoverflow.com/questions/35534906/java-hashmap-getobject-infinite-loop/44180452#44180452" target="_blank" rel="noopener">Java HashMap.get(Object) infinite loop</a></li></ul><h2 id="7ã€ä¸ºä»€ä¹ˆå¦‚æœå¯¹è±¡ä½œä¸º-HashMap-çš„-Keyï¼Œå¯¹è±¡éœ€è¦é‡å†™-hashCode-å’Œ-equals-æ–¹æ³•ï¼Ÿ"><a href="#7ã€ä¸ºä»€ä¹ˆå¦‚æœå¯¹è±¡ä½œä¸º-HashMap-çš„-Keyï¼Œå¯¹è±¡éœ€è¦é‡å†™-hashCode-å’Œ-equals-æ–¹æ³•ï¼Ÿ" class="headerlink" title="7ã€ä¸ºä»€ä¹ˆå¦‚æœå¯¹è±¡ä½œä¸º HashMap çš„ Keyï¼Œå¯¹è±¡éœ€è¦é‡å†™ hashCode å’Œ equals æ–¹æ³•ï¼Ÿ"></a>7ã€ä¸ºä»€ä¹ˆå¦‚æœå¯¹è±¡ä½œä¸º HashMap çš„ Keyï¼Œå¯¹è±¡éœ€è¦é‡å†™ hashCode å’Œ equals æ–¹æ³•ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º HashMap é€šè¿‡ Key å¯¹è±¡çš„ hashCode è®¡ç®— hashï¼Œè¿˜é€šè¿‡ equals æ–¹æ³•æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸é‡å†™ï¼Œç›¸åŒå†…å®¹çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå…¶ hashCode å°†ä¸åŒï¼Œä¹Ÿä¸ä¼šç›¸ç­‰ã€‚</p><p>String å¸¸ä½œä¸º Map çš„ Keyï¼ŒString å¦‚ä½•é‡å†™ï¼š</p><ul><li>hashCode() - å¦‚æœå­—ç¬¦ä¸²å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆ hash ä¸å˜ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œé€šè¿‡æ¯ä¸ªå­—ç¬¦çš„ ASSCII ç è®¡ç®—</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>equals() - ä¾æ¬¡æ¯”è¾ƒæ¯ä¸ªå­—ç¬¦æ˜¯å¦ç›¸åŒ</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        String anotherString = (String)anObject;</span><br><span class="line">        <span class="keyword">int</span> n = value.length;</span><br><span class="line">        <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">            <span class="keyword">char</span> v1[] = value;</span><br><span class="line">            <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šHashSet æ˜¯ç‰¹æ®Šçš„ HashMapï¼Œå­˜æ”¾åœ¨ HashSet çš„å¯¹è±¡éƒ½éœ€è¦é‡å†™ hashCode() å’Œ equals() æ–¹æ³•</p><h2 id="8ã€get-å’Œ-containsKey-çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"><a href="#8ã€get-å’Œ-containsKey-çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="8ã€get() å’Œ containsKey() çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"></a>8ã€get() å’Œ containsKey() çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// This implementation provides constant-time performance for the basic operations (get and put)</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªå®ç°ä¸ºåŸºæœ¬æ“ä½œï¼ˆget å’Œ putï¼‰æä¾›äº†å¸¸é‡æ—¶é—´æ€§èƒ½ï¼Œå‡è®¾æ•£åˆ—å‡½æ•°å°†å…ƒç´ æ­£ç¡®åœ°åˆ†æ•£åœ¨å­˜å‚¨æ¡¶ä¸­ã€‚</span></span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå› ä¸ºé“¾è¡¨çš„é•¿åº¦ä¸ä¼šè¿‡é•¿ï¼ŒåŸºæœ¬ä¸ä¼šè¾¾åˆ° 8 ä¸ª</p><h2 id="9ã€å½“é“¾è¡¨é•¿åº¦å¤§äº-8-ä¸ªæ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#9ã€å½“é“¾è¡¨é•¿åº¦å¤§äº-8-ä¸ªæ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="9ã€å½“é“¾è¡¨é•¿åº¦å¤§äº 8 ä¸ªæ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>9ã€å½“é“¾è¡¨é•¿åº¦å¤§äº 8 ä¸ªæ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h2><ul><li>é“¾è¡¨æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ—¶ O(n)</li><li>çº¢é»‘æ ‘æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ—¶ O(logN)</li><li>æ‰€ä»¥å¥½å¤„æ˜¯æŸ¥æ‰¾å’Œä¿®æ”¹çš„æ—¶é—´å¤æ‚åº¦æ›´ä½</li></ul><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="https://www.javarticles.com/2012/11/hashmap-faq.html" target="_blank" rel="noopener">HashMap Interview Questions</a></li><li><a href="https://www.quora.com/Why-is-the-load-factor-set-to-0-75-for-a-HashMap-in-Java" target="_blank" rel="noopener">Why is the load factor set to 0.75 for a HashMap in Java?</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/08/20/hashmap-9-question/#disqus_thread</comments>
    </item>
    
    <item>
      <title>åœ¨ macOS ä¸­ï¼Œå¦‚ä½•è‡ªåŠ¨å‹ç¼©æˆªå±å›¾ç‰‡å¤§å°</title>
      <link>https://depp.wang/2020/08/07/how-to-automatically-compress-screenshot-size-in-macos/</link>
      <guid>https://depp.wang/2020/08/07/how-to-automatically-compress-screenshot-size-in-macos/</guid>
      <pubDate>Fri, 07 Aug 2020 14:25:08 GMT</pubDate>
      <description>
      
        &lt;h2 id=&quot;ä¸€ã€é”™è¯¯çš„è¯¯ä¼š&quot;&gt;&lt;a href=&quot;#ä¸€ã€é”™è¯¯çš„è¯¯ä¼š&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€é”™è¯¯çš„è¯¯ä¼š&quot;&gt;&lt;/a&gt;ä¸€ã€é”™è¯¯çš„è¯¯ä¼š&lt;/h2&gt;&lt;p&gt;æˆ‘æ˜¯è¿™æ ·åœ¨ Markdown ä¸­æ’å…¥æˆªå±å›¾ç‰‡çš„ï¼šæˆªå±åˆ°å‰ªè´´æ¿åï¼Œç›´æ¥åœ¨ &lt;a href=&quot;https://typora.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Typora&lt;/a&gt; ä¸­ç²˜è´´ï¼Œ&lt;a href=&quot;https://apps.apple.com/us/app/ipic-image-file-upload-tool/id1101244278?mt=12&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;iPic&lt;/a&gt; å°†è‡ªåŠ¨å°†å›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘å›¾åºŠï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰ã€‚æˆ‘ä¸€ç›´ä½¿ç”¨ &lt;a href=&quot;https://www.alfredapp.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Alfred&lt;/a&gt; çš„ &lt;a href=&quot;https://www.alfredapp.com/help/features/clipboard/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Clipboard History&lt;/a&gt; åŠŸèƒ½æŸ¥çœ‹æˆªå›¾å¤§å°ï¼Œå‘ç°å›¾ç‰‡å å†…å­˜éƒ½å¾ˆå¤§ï¼Œå…¨å±æˆªå›¾æœ‰ 10 å¤š MBï¼Œå°±æƒ³ç€ä¸€å®šè¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥ç¼©å°æˆªå±å¤§å°ï¼Œä¸ç„¶æˆ‘çš„&lt;a href=&quot;https://cn.aliyun.com/price/detail/oss&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é˜¿é‡Œäº‘å›¾åºŠè´¹ç”¨&lt;/a&gt;å¾—å—–å—–æ¶¨ã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<h2 id="ä¸€ã€é”™è¯¯çš„è¯¯ä¼š"><a href="#ä¸€ã€é”™è¯¯çš„è¯¯ä¼š" class="headerlink" title="ä¸€ã€é”™è¯¯çš„è¯¯ä¼š"></a>ä¸€ã€é”™è¯¯çš„è¯¯ä¼š</h2><p>æˆ‘æ˜¯è¿™æ ·åœ¨ Markdown ä¸­æ’å…¥æˆªå±å›¾ç‰‡çš„ï¼šæˆªå±åˆ°å‰ªè´´æ¿åï¼Œç›´æ¥åœ¨ <a href="https://typora.io/" target="_blank" rel="noopener">Typora</a> ä¸­ç²˜è´´ï¼Œ<a href="https://apps.apple.com/us/app/ipic-image-file-upload-tool/id1101244278?mt=12" target="_blank" rel="noopener">iPic</a> å°†è‡ªåŠ¨å°†å›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘å›¾åºŠï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰ã€‚æˆ‘ä¸€ç›´ä½¿ç”¨ <a href="https://www.alfredapp.com/" target="_blank" rel="noopener">Alfred</a> çš„ <a href="https://www.alfredapp.com/help/features/clipboard/" target="_blank" rel="noopener">Clipboard History</a> åŠŸèƒ½æŸ¥çœ‹æˆªå›¾å¤§å°ï¼Œå‘ç°å›¾ç‰‡å å†…å­˜éƒ½å¾ˆå¤§ï¼Œå…¨å±æˆªå›¾æœ‰ 10 å¤š MBï¼Œå°±æƒ³ç€ä¸€å®šè¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥ç¼©å°æˆªå±å¤§å°ï¼Œä¸ç„¶æˆ‘çš„<a href="https://cn.aliyun.com/price/detail/oss" target="_blank" rel="noopener">é˜¿é‡Œäº‘å›¾åºŠè´¹ç”¨</a>å¾—å—–å—–æ¶¨ã€‚</p> <a id="more"></a><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-02-024029.png" alt="image" style="zoom:50%;"></p><p>æ˜¨å¤©ï¼Œæˆ‘å°†æˆªå›¾ä¸ä¿å­˜åˆ°å‰ªè´´æ¿ï¼Œè€Œç›´æ¥ä¿å­˜åˆ°æœ¬åœ°ï¼Œå‘ç°å›¾ç‰‡æ ¹æœ¬æ²¡æœ‰ 10 å¤š MBï¼Œå°±å‡ ç™¾ KBã€‚æƒ³ç€æˆ‘è¿™ä¸ªé«˜åˆ†è¾¨ç‡è¶…é«˜æ¸… Retain å…¨å±æˆªå›¾ ğŸ¶ ï¼Œä¸èƒ½åªæœ‰å‡ ç™¾ KB å‘€ ï¼Œä¸€å®šæ˜¯æˆ‘ç”µè„‘æ˜¾ç¤ºæœ‰é—®é¢˜ã€‚</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-02-023939.png" alt="image" style="zoom:50%;"></p><p>æœ€åæˆ‘æ‰“å¼€é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨åœ¨çº¿æ£€æŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°çœŸçš„åªæœ‰å‡ ç™¾ KBï¼Œå¼€å§‹å¿ƒé‡Œé»˜é»˜å¯¹ Alfred ***ã€‚é‚åœ¨ Alfred è®ºå›å‘<a href="https://www.alfredforum.com/topic/15361-the-copyed-image-in-the-clipboard-that-size-is-a-error-data-between-with-the-actual-size-its-too-large/" target="_blank" rel="noopener">è®¨è®ºå¸–</a>ï¼Œç½‘å‹å›å¤è¯´ï¼Œå¯¹äºå‰ªè´´æ¿å›¾ç‰‡æ¥è¯´ï¼Œå…¶æ•°æ®æ ¼å¼æ˜¯ <a href="https://en.wikipedia.org/wiki/TIFF" target="_blank" rel="noopener">TIFF</a> æ•°æ®æ ¼å¼ï¼Œä¸æ˜¯å›¾ç‰‡æœ¬èº«çš„å†…å­˜å¤§å°ï¼Œæ‰€ä»¥ Clipboard History æ•°æ®æ˜¾ç¤ºè¾ƒå¤§ã€‚å–”éœï¼ŒåŸæ¥æ˜¯ä¸ªé”™è¯¯çš„è¯¯ä¼šå‘€ã€‚</p><p>è™½ç„¶å‡ ç™¾ KB ç›¸å¯¹ 10 å¤š MB æ˜¯å°å¤šäº†ï¼Œç°åœ¨æˆ‘è¿™å°åšå®¢æ— äººé—®æ´¥ï¼Œå›¾åºŠè´¹ç”¨æ¯æœˆä¹Ÿå°±å‡ æ¯›å‡ åˆ†é’±ï¼Œå›¾ç‰‡å¤§ç‚¹ä¹Ÿæ— æ‰€è°“ã€‚ä½†ä¸ºäº†é•¿è¿œè€ƒè™‘ï¼Œå›¾ç‰‡å½“ç„¶è¶Šå°è¶Šå¥½ã€‚</p><p>æ­£å¥½æœåˆ°ä¸€ç¯‡å…³äºå‹ç¼©å›¾ç‰‡çš„<a href="https://about.gitlab.com/blog/2020/01/30/simple-trick-for-smaller-screenshots/" target="_blank" rel="noopener">ä¼˜è´¨æ•™ç¨‹</a>ï¼Œè¿˜åŒ…å«è§†é¢‘æ•™ç¨‹ï¼Œç®€å•çš„æ–¹å¼å°±èƒ½å®ç°è‡ªåŠ¨å‹ç¼©å›¾ç‰‡ï¼Œé‚£è¿˜ç­‰ä»€ä¹ˆï¼Œå¾—èµ¶å¿«ç”¨èµ·æ¥ã€‚<strong>å¼ºçƒˆæ¨èçœ‹åŸæ–‡</strong>ï¼Œå¾ˆé€šä¿—æ˜“æ‡‚ã€‚</p><!--ä¸‹é¢æ˜¯åŸºäºè¿™ç¯‡æ–‡ç« çš„æ€»ç»“--><h2 id="äºŒã€å›¾ç‰‡å‹ç¼©"><a href="#äºŒã€å›¾ç‰‡å‹ç¼©" class="headerlink" title="äºŒã€å›¾ç‰‡å‹ç¼©"></a>äºŒã€å›¾ç‰‡å‹ç¼©</h2><h3 id="2-1ã€å‹ç¼©æ—¶æœº"><a href="#2-1ã€å‹ç¼©æ—¶æœº" class="headerlink" title="2.1ã€å‹ç¼©æ—¶æœº"></a>2.1ã€å‹ç¼©æ—¶æœº</h3><p>å›¾ç‰‡å‹ç¼©æœ‰ä¸‰ä¸ªæ—¶é—´ç‚¹ï¼Œ1ã€æˆªå±æ—¶ç”±æˆªå±è½¯ä»¶å‹ç¼©ï¼›2ã€ä¸Šä¼ åˆ°å›¾åºŠæ—¶ç”±ä¸Šä¼ è½¯ä»¶å‹ç¼©ï¼›2ã€ä¸Šä¼ åˆ°å›¾åºŠåç”±å›¾åºŠå‹ç¼©ã€‚</p><p>ä¸‹é¢è¦ä»‹ç»çš„è¿™ç§æ–¹å¼å¯ä»¥ç±»ä¼¼çœ‹ä½œæ˜¯ç¬¬ 1 æ¡ã€‚</p><p>å¯¹äºç¬¬ 2 æ¡ï¼Œå¦‚æœä½ ä½¿ç”¨ iPicï¼ŒiPic æœ‰æä¾›å¯é€‰çš„æœ‰æŸå‹ç¼©çš„åŠŸèƒ½ï¼Œå…ˆå‹ç¼©å†ä¸Šä¼ ï¼Œæˆ‘å¤§æ¦‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¸€èˆ¬èƒ½å‹ç¼© 60% å¤šå§ï¼ˆå…·ä½“è§†æƒ…å†µè€Œå®šï¼‰ã€‚ä½†å¦‚æœåœ¨ Typora ä¸­å¤åˆ¶ï¼Œ<a href="https://toolinbox.net/iPic/#comment-4743566071" target="_blank" rel="noopener">ä¸æ”¯æŒå‹ç¼©</a>ï¼Œæ›²çº¿æ•‘å›½çš„æ–¹å¼æ˜¯å…ˆä½¿ç”¨å¿«æ·é”®ä¸Šä¼ ï¼Œå†åœ¨ Typora ä¸­ç²˜è´´è¿”å›çš„ URLã€‚ä¸ªäººè§‰å¾—ä½“éªŒæœ‰åˆ†è£‚ï¼Œæ²¡æœ‰æˆªå±æ—¶å°±å‹ç¼©æ–¹ä¾¿ï¼Œæ‰€ä»¥æ‰ç”¨ç¬¬ 1 ç§å®ç°ã€‚</p><!--ï¼Œå…·ä½“æŸå¤±æ•ˆæœæ²¡æœ‰å¯¹æ¯”ã€‚--><p>å¯¹äºç¬¬ 3 æ¡ï¼Œä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨æä¾›è‡ªåŠ¨å›¾ç‰‡å‹ç¼©åŠŸèƒ½ï¼Œä¸è¿‡æ˜¯æ”¶è´¹åŠŸèƒ½ã€‚</p><h3 id="2-2ã€å‹ç¼©åŸç†"><a href="#2-2ã€å‹ç¼©åŸç†" class="headerlink" title="2.2ã€å‹ç¼©åŸç†"></a>2.2ã€å‹ç¼©åŸç†</h3><p>macOS é»˜è®¤æˆªå±ç”Ÿæˆå›¾ç‰‡çš„æ ¼å¼ä¸º <a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics" target="_blank" rel="noopener">PNG</a>ï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œæ˜¯ PNG-32ï¼Œå³æ¯ä¸ªåƒç´ ç‚¹å  32 ä½ï¼Œæ¯ä¸ªåƒç´ ç‚¹ç”± 4 éƒ¨åˆ†æ„æˆï¼Œåˆ†åˆ«æ˜¯çº¢è‰²ï¼ˆRedï¼‰ã€ç»¿è‰²ï¼ˆGreenï¼‰ã€è“è‰²ï¼ˆBlueï¼‰å’Œé€æ˜åº¦ï¼ˆAlpha (Transparency)ï¼‰ï¼ˆç®€å†™ RGBAï¼‰ã€‚æ‰€ä»¥æ¯ç§é¢œè‰²æœ‰ 2^8ï¼ˆ256ï¼‰ä¸ªçº§åˆ«ï¼Œæ‰€ä»¥å›¾ç‰‡å¯ä»¥æ˜¾ç¤º 1600 ä¸‡ç§é¢œè‰²ï¼ˆ256â€Š Ã—â€Š 256â€Š Ã—â€Š 256, 2^24ï¼‰ã€‚</p><p>æˆªå±ä¸€èˆ¬å¯¹é¢œè‰²è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œæ˜¾ç¤º 1600 ä¸‡ç§é¢œè‰²ä¸ 256 ç§é¢œè‰²å·®åˆ«ä¸å¤§ï¼Œæˆªå±å›¾ç‰‡åŸºäº<a href="https://en.wikipedia.org/wiki/Palette_(computing)" target="_blank" rel="noopener">è°ƒè‰²æ¿</a>ï¼Œå¯ä»¥åˆ©ç”¨å·¥å…·å°†å›¾ç‰‡æ˜¾ç¤ºé¢œè‰²<a href="http://en.wikipedia.org/wiki/Color_quantization" target="_blank" rel="noopener">æ›´æ”¹</a>ä¸º 256 ç§ï¼Œæ¥å®ç°å‹ç¼©å›¾ç‰‡çš„åŠŸèƒ½ã€‚æ­¤æ—¶å•ä½åƒç´ ç”± 32 ä½å˜ä¸º 8 ä½ï¼ˆ4 ä¸ªå­—èŠ‚å˜ä¸º 1 ä¸ªå­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥å¤§çº¦èƒ½å‹ç¼© 75% çš„å®¹é‡ã€‚</p><p>æ³¨æ„ï¼šé™¤äº† 256ï¼Œè¿˜å¯ä»¥é€‰æ‹© 128ã€64ã€24ã€16ã€8ã€4 ç­‰çº§åˆ«ï¼ŒåŸä½œè€…æµ‹è¯• 64 è·Ÿ 256 å·®ä¸å¤šã€‚è¿™é‡Œæˆ‘é€‰æ‹©äº† 256ã€‚</p><h3 id="2-2ã€pngquant"><a href="#2-2ã€pngquant" class="headerlink" title="2.2ã€pngquant"></a>2.2ã€pngquant</h3><p><a href="https://pngquant.org/" target="_blank" rel="noopener">pngquant</a> å°±æ˜¯ä¸€ä¸ªå¯ä»¥å‡ ä¹ä¸æŸå®³å›¾ç‰‡è´¨é‡ï¼Œé€šè¿‡å‡å°‘åƒç´ å¤§å°æ¥å‹ç¼© PNG å›¾ç‰‡çš„å‘½ä»¤è¡Œç¨‹åºï¼ˆåº“ï¼‰ï¼Œå±äºæœ‰æŸå‹ç¼©ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ HomeBrew å®‰è£… pngquant</span></span><br><span class="line">brew install pngquant</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°† 32 ä½çš„ RGBA PNG æ•°å­—è½¬æ¢ä¸º 8 ä½ï¼ˆæˆ–æ›´å°ï¼‰çš„ RGBA è°ƒè‰²æ¿</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pngquant [é¢œè‰²æ•°é‡] [å‚æ•°] input.png</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   --skip-if-larger  ä»…ä¿å­˜è½¬åŒ–åæ¯”åŸæ–‡ä»¶å°çš„æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   --strip           å»é™¤å¯é€‰çš„å…ƒæ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   --ext=.png        è®¾ç½®å‹ç¼©åå›¾ç‰‡åå’ŒåŸå›¾ç‰‡åä¸€æ ·</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   --force           è¦†ç›–åŸæ–‡ä»¶</span></span><br><span class="line">pngquant 256 --skip-if-larger --strip --ext=.png --force example.png</span><br></pre></td></tr></table></figure><p>å½“ pngqunt å‹ç¼©åï¼Œè¿˜å¯ä»¥é€šè¿‡ <a href="https://github.com/google/zopfli" target="_blank" rel="noopener">zopfli</a> è¿›ä¸€æ­¥æ— æŸå‹ç¼©ï¼Œä½†è€—æ—¶è¾ƒé•¿ï¼Œå‹ç¼©æ¯”ä¾‹ä¹Ÿä¸é«˜ï¼Œæˆ‘å°±æ²¡åšè¿™æ­¥æ“ä½œã€‚</p><!--zopfli çš„åŸç†ä½¿ç”¨ [DEFLATE](https://en.wikipedia.org/wiki/DEFLATE) ç®—æ³•æ¥å®ç°æ— æŸå‹ç¼©--><p><a href="https://pngmini.com/" target="_blank" rel="noopener">ImageAlpha</a> æ˜¯ä¸€ä¸ªé›†æˆ <a href="https://pngquant.org/" target="_blank" rel="noopener">pngquant</a> çš„ macOS å®¢æˆ·ç«¯ï¼Œå¯ä»¥å›¾å½¢åŒ–è°ƒæ•´å›¾ç‰‡æ˜¾ç¤ºé¢œè‰²æ•°é‡ã€‚</p><h3 id="2-4ã€å‹ç¼©æ•ˆæœ"><a href="#2-4ã€å‹ç¼©æ•ˆæœ" class="headerlink" title="2.4ã€å‹ç¼©æ•ˆæœ"></a>2.4ã€å‹ç¼©æ•ˆæœ</h3><table><thead><tr><th align="left">PNG-32 (465KB)</th><th align="left">256 colors (117KB)</th></tr></thead><tbody><tr><td align="left"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-04-073500.png" alt="Xnip2020-08-02_20-55-07"></td><td align="left"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-04-073506.png" alt="image-20200802205551304"></td></tr></tbody></table><p>å‹ç¼©æ•ˆæœï¼š74.8%</p><h3 id="2-5ã€è‡ªåŠ¨å‹ç¼©"><a href="#2-5ã€è‡ªåŠ¨å‹ç¼©" class="headerlink" title="2.5ã€è‡ªåŠ¨å‹ç¼©"></a>2.5ã€è‡ªåŠ¨å‹ç¼©</h3><p>ç°åœ¨ï¼Œåªæœ‰åœ¨æœ¬åœ°æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå°±èƒ½å°†å›¾ç‰‡å‹ç¼©äº†ã€‚å¯ä»¥å°†å‘½ä»¤ä½œä¸ºä¸€ä¸ªè„šæœ¬ï¼Œäº¤ç»™å·¥ä½œæµæ¥è‡ªåŠ¨æ‰§è¡Œï¼Œå·¥ä½œæµå¯ä»¥é€‰æ‹© Alfred å·¥ä½œæµï¼ˆ<a href="https://www.alfredapp.com/workflows/" target="_blank" rel="noopener">Workflow</a>ï¼‰ã€ç³»ç»Ÿè‡ªå¸¦çš„ <a href="https://support.apple.com/en-au/guide/automator/welcome/mac" target="_blank" rel="noopener">Automator</a> å’Œä¸“ä¸šå·¥ä½œæµè½¯ä»¶ <a href="https://www.noodlesoft.com/" target="_blank" rel="noopener">Hazelï¼ˆ</a>è¯•ç”¨ç»“æŸåè½¯ä»¶æ”¶è´¹ï¼‰ã€‚Alfred å·¥ä½œæµéœ€è¦å…³é”®å­—æˆ–å¿«æ·é”®è§¦å‘ï¼Œä¸ç¬¦åˆæˆ‘ä»¬è‡ªåŠ¨å‹ç¼©çš„ feelstyleï¼Œpassã€‚ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Hazel å’Œ Automatorã€‚ </p><p>Hazel è®¾ç½®å·¥ä½œæµï¼š</p><ol><li>æ·»åŠ æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œè®¾ç½®è§¦å‘æ¡ä»¶ï¼Œæ¡ä»¶ä¸ºå¯¹æ–‡ä»¶å¤¹ä¸­æœ€è¿‘ä¸€åˆ†é’Ÿæ–°å¢çš„ PNG æ–‡ä»¶æ‰§è¡Œè„šæœ¬</li><li>è®¾ç½®è„šæœ¬ï¼Œè„šæœ¬ä¸ºå‹ç¼©å›¾ç‰‡ï¼Œå¹¶å¤åˆ¶å‹ç¼©åçš„å›¾ç‰‡åˆ°å‰ªè´´æ¿</li><li>é€šçŸ¥å‹ç¼©å®Œæˆ</li></ol><p>Automator è®¾ç½®å·¥ä½œæµï¼š</p><ol><li>æ·»åŠ  Folder Actionï¼Œé€‰æ‹©æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œæ·»åŠ  Run  Shell Script</li><li>è®¾ç½®è„šæœ¬ï¼Œå°†æ–°åŠ å…¥å›¾ç‰‡ä½œä¸ºå‚æ•°ï¼Œéå†æ‰§è¡Œè„šæœ¬</li><li>æ²¡æœ‰é€šçŸ¥åŠŸèƒ½</li></ol><p>è®¾ç½®å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨æˆªå›¾å·¥å…·ï¼ˆå¦‚ï¼š <a href="https://xnipapp.com/" target="_blank" rel="noopener">Xnip</a>ï¼‰å°†æˆªå›¾ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹æ—¶ï¼Œå°†ä¼šè§¦å‘å·¥ä½œæµï¼Œå®Œæˆè‡ªåŠ¨å‹ç¼©ã€‚</p><table><thead><tr><th align="center">Hazel</th><th align="center">Automator</th></tr></thead><tbody><tr><td align="center"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-092800.png" alt="image-20200807172759510"></td><td align="center"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-102228.png" alt="image-20200807182227731"></td></tr><tr><td align="center"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-04-073544.png" alt="image-20200803133233959"></td><td align="center"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-135926.png" alt="image-20200807215926183"></td></tr><tr><td align="center"><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-04-073539.png" alt="image-20200802211111073"></td><td align="center"></td></tr></tbody></table><!--å¯ä»¥é€‰æ‹©å¼€æºå…è´¹çš„ [fswatch](https://github.com/emcrisostomo/fswatch) æŠŠ.--><ul><li>ä½¿ç”¨ Automatorï¼Œéœ€åœ¨ Security &amp; Privayï¼ˆå®‰å…¨ä¸éšç§ï¼‰-&gt; Accessibilityï¼ˆè¾…åŠ©åŠŸèƒ½ï¼‰é‡Œé¢å¼€å¯æƒé™ã€‚</li></ul><p>è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pngquant 256 --skip-if-larger --strip --ext=.png --force "$1"</span><br><span class="line">osascript -e "set the clipboard to (read (POSIX file \"$(perl -e "print glob('$1')")\") as &#123;Â«class PNGfÂ»&#125;)"</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">The compressed image `<span class="built_in">file</span>` has been copied <span class="keyword">to</span> <span class="built_in">the clipboard</span>.</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for f in "$@"</span><br><span class="line">do</span><br><span class="line">/usr/local/bin/pngquant 256 --skip-if-larger --strip --ext=.png --force "$f"</span><br><span class="line">osascript -e "set the clipboard to (read (POSIX file \"$(perl -e "print glob('$f')")\") as &#123;Â«class PNGfÂ»&#125;)"</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>psï¼šHazel å®˜æ–¹ UI çœŸå¿ƒå¥½çœ‹ã€‚<code>/usr/local/bin/pngquan</code> ä¸ <code>pnguant</code> ä½œç”¨ä¸€æ ·ã€‚</p><!--è¯•ç”¨æœŸè¿‡äº†æˆ‘è¿˜æ˜¯è€è€å®å®åˆ‡æ¢å›ç³»ç»Ÿè‡ªå¸¦çš„ Automator å§ã€‚--><!--å¤åˆ¶åˆ°å‰ªè´´æ¿--><!--ä½ å¯èƒ½æ³¨æ„åˆ°äº† `cat "$1" | ./impbcopy -` è¿™è¡Œå‘½ä»¤ï¼Œè¿™æ˜¯ä¸€ä¸ªä»å‘½ä»¤è¡Œå¤åˆ¶å›¾ç‰‡åˆ°å‰ªè´´æ¿çš„å‘½ä»¤ï¼Œç”±äº Hazel  ä¸æä¾›å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½ï¼ˆåæ­£æˆ‘æ²¡æ‰¾åˆ°ï¼‰ï¼Œç½‘ä¸Šå¾ˆå¤šåŠæ³•ä¹Ÿä¸å¥½ä½¿ï¼Œæ‰¾åˆ°ä¸€ä¸ªå°å“¥ç”¨ objective-c å†™çš„[å¤åˆ¶å›¾ç‰‡ä»£ç ](http://www.alecjacobson.com/weblog/?p=3816)ï¼ŒæŒºå¥½ä½¿ã€‚--><!--åœ¨ä¿å­˜æˆªå±å›¾ç‰‡çš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»ºæ–‡ä»¶ `impbcopy.m`ï¼Œå¤åˆ¶ä»£ç åˆ° `impbcopy.m`ï¼Œä¿å­˜--><!--ç¼–è¯‘æ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ°ç”Ÿæˆäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œ`impbcopy` å’Œ `impbcopy.dSYM`ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œå°†ç”¨åˆ° `impbcopy`--> <h2 id="ä¸‰ã€åƒç´ ä¸åˆ†è¾¨ç‡"><a href="#ä¸‰ã€åƒç´ ä¸åˆ†è¾¨ç‡" class="headerlink" title="ä¸‰ã€åƒç´ ä¸åˆ†è¾¨ç‡"></a>ä¸‰ã€åƒç´ ä¸åˆ†è¾¨ç‡</h2><!--**åƒç´ **--><p>ä¸Šé¢ä¸€ç›´è¯´åƒç´ ï¼Œæ‰€ä»¥æ·±å…¥äº†è§£ä¸€ä¸‹ã€‚</p><p><a href="https://en.wikipedia.org/wiki/Pixel" target="_blank" rel="noopener">åƒç´ </a>ï¼ˆPixelï¼Œç®€å†™ pxï¼‰åˆ†ä¸ºç‰©ç†åƒç´ å’Œå›¾ç‰‡åƒç´ ã€‚</p><p><strong>ç‰©ç†åƒç´ </strong>æ˜¯ç‰©ç†è®¾å¤‡ä¸Šæ˜¾ç¤ºé¢œè‰²çš„ç‰©ç†ç‚¹ã€‚ç‰©ç†è®¾å¤‡å¦‚ç”µè„‘ã€æ‰‹æœºã€ç”µè§†ç­‰ã€‚</p><ul><li>ä»¥ <a href="https://support.apple.com/kb/SP754?locale=en_AU" target="_blank" rel="noopener">MacBook Pro 2017 13.3-inch</a>ï¼ˆåé¢ç®€ç§° MacBook Proï¼‰ä¸ºä¾‹ï¼Œå±å¹•å°ºå¯¸æ˜¯ 13.3 è‹±å¯¸ï¼Œå³å±å¹•æ–œå¯¹è§’é•¿ä¸º 13.3 è‹±å¯¸ï¼ˆ1 è‹±å¯¸ = 2.54 cmï¼‰ã€‚ï¼ˆæ–œå¯¹è§’é•¿çº¦ 34.0 cmï¼Œé•¿çº¦ 28.8 cmï¼Œå®½çº¦ 18.0 cmï¼‰ï¼Œåƒç´ ä¸ªæ•°ä¸º  2560 Ã— 1600ï¼Œæ‰€ä»¥æ¯ä¸ªåƒç´ ç‚¹çš„é¢ç§¯çº¦ä¸º 0.01125 cm Ã— 0.01125 cmã€‚</li><li><a href="https://www.apple.com/iphone-xr/specs/" target="_blank" rel="noopener">iPhone XR</a>ï¼Œå±å¹•å°ºå¯¸ä¸º 6.06-inchã€‚ï¼ˆæ–œå¯¹è§’é•¿çº¦ 15.4 cmï¼Œé•¿çº¦ 14 cmï¼Œå®½çº¦ 6.5 cmï¼‰ï¼Œåƒç´ ä¸ªæ•°ä¸ºï¼š1792 Ã— 828ï¼Œæ‰€ä»¥æ¯ä¸ªåƒç´ ç‚¹çš„é¢ç§¯çº¦ä¸º 0.00785cm Ã— 0.00785 cmã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒMacBook Rro å’Œ iPhone XR å±å¹•çš„åƒç´ ç‚¹ä¸ºæ­£æ–¹å½¢ã€‚</p><p><strong>å›¾ç‰‡åƒç´ </strong>æ˜¯å›¾ç‰‡ä¸­æœ€å°çš„å•ä½ã€‚åŒæ ·å¤§å°çš„ç…§ç‰‡ï¼ŒåŒ…å«çš„åƒç´ å¯èƒ½ä¸åŒã€‚å°ç±³ 10 æœ‰ä¸€ä¸ªé¢— 1 äº¿åƒç´ çš„æ‘„åƒå¤´ï¼Œå¦‚æœå…¨è¾“å‡ºï¼Œæ‹å‡ºæ¥çš„ç…§ç‰‡ï¼ŒåŒ…å«åƒç´ ä¸ªæ•°ä¸º 12032 Ã— 9024 ï¼Œä¹˜ç§¯ç»“æœä¸º 1.08 äº¿ã€‚iPhone XR æ˜¯ 1200 ä¸‡åƒç´ ï¼Œç…§ç‰‡åƒç´ ä¸º 3024â€Š Ã— â€Š4032ã€‚æ‘„åƒå¤´ä¸€èˆ¬è¯´å¤šå°‘å¤šå°‘åƒç´ ï¼Œå¯¹äºå±å¹•ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°åˆ†è¾¨ç‡ã€‚</p><!--**åˆ†è¾¨ç‡ **--><p><a href="https://en.wikipedia.org/wiki/Dispute_resolution" target="_blank" rel="noopener">åˆ†è¾¨ç‡</a>ï¼Œä¹Ÿå«æ˜¾ç¤ºåˆ†è¾¨ç‡ï¼ˆDisplay Resolutionï¼‰ï¼Œåˆ†è¾¨ç‡æŒ‡åƒç´ çš„æ€»å’Œï¼Œæ¯”å¦‚æˆ‘ä»¬è¯´ MacBook Pro å±å¹•çš„åˆ†è¾¨ç‡æ˜¯  2560 Ã— 1600 pxã€‚åˆ†è¾¨ç‡å’Œå±å¹•å¤§å°å°ºå¯¸æ²¡æœ‰å…³ç³»ï¼ŒMacBook Pro çš„åˆ†è¾¨ç‡æ˜¯  2560 Ã— 1600 pxï¼Œä¸€å° 75 è‹±å¯¸çš„ <a href="https://www.mi.com/mitv5/75/specs" target="_blank" rel="noopener">å°ç±³ç”µè§† 5</a> çš„åˆ†è¾¨ç‡ä¹Ÿæ‰ 3840 Ã— 2160 pxã€‚å°ç±³ç”µè§† 5 è‡ªç§°æ˜¯ <a href="https://en.wikipedia.org/wiki/4K_resolution" target="_blank" rel="noopener">4K</a>ï¼Œå…¶å®åªæ˜¯æ¥è¿‘ 4Kï¼Œ4K çš„æ ‡å‡†æ˜¯æ¨ªå‘åƒç´ è¾¾åˆ° 4000ã€‚è¡¡é‡å±å¹•æ˜¾ç¤ºçš„æ˜¯åƒç´ å¯†åº¦ã€‚</p><!--**åƒç´ å¯†åº¦**--><p><a href="https://en.wikipedia.org/wiki/Pixel_density" target="_blank" rel="noopener">åƒç´ å¯†åº¦</a> ï¼Œè‹±è¯­ä¸º Pixel Densityï¼Œä¹Ÿå« Pixels Per Inchï¼ˆPPIï¼‰ï¼Œå³å•ä½è‹±å¯¸åƒç´ çš„å¤šå°‘ï¼ˆä¸ªæ•°ï¼‰ã€‚è®¡ç®—å…¬å¼ä¸º ppi = åƒç´ /è‹±å¯¸ã€‚</p><ul><li>ä»¥ MacBook Pro 2017 13.3-inch ä¸ºä¾‹ï¼Œppi = âˆš(2560^2 Ã— 1600^2) / 13.3 â‰ˆ 227ï¼Œå³æ–œå¯¹è§’æ¯è‹±å¯¸æœ‰ 227 ä¸ªåƒç´ </li><li>ä»¥ iPhone XR ä¸ºä¾‹ï¼Œppi = âˆš(1792^2 Ã— 828^2) / 6.06 â‰ˆ 326</li><li>ä»¥ <a href="https://www.apple.com/iphone-11-pro/specs/" target="_blank" rel="noopener">iPhone 11 PRO</a> ä¸ºä¾‹ï¼Œppi = âˆš(2436^ Ã— 1125^) / 5.8 â‰ˆ 458</li></ul><p>å¯¹äºå±å¹•æ¥è¯´ï¼Œppi è¶Šé«˜ï¼Œæ˜¾ç¤ºå°±è¶Šæ¸…æ™°ï¼Œå°±è¶Šä¸å®¹æ˜“çœ‹è§é¢—ç²’æ„Ÿã€‚</p><h3 id="3-1ã€åƒç´ çš„å†…å­˜å¤§å°"><a href="#3-1ã€åƒç´ çš„å†…å­˜å¤§å°" class="headerlink" title="3.1ã€åƒç´ çš„å†…å­˜å¤§å°"></a>3.1ã€åƒç´ çš„å†…å­˜å¤§å°</h3><p>ä¸Šé¢é‚£å¼ æˆªå›¾å å†…å­˜å¤ªå°ï¼Œæ‰¾å¼ å å†…å­˜å¤§ä¸€ç‚¹çš„åˆ†æã€‚</p><table><thead><tr><th>æœªå‹ç¼©å‰</th><th>å‹ç¼©å</th></tr></thead><tbody><tr><td><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-101445.png" alt="image-20200807181444442"></td><td><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-101336.png" alt="image-20200807181336766"></td></tr><tr><td><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-101537.png" alt="image-20200807181537056"></td><td><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-08-07-101616.png" alt="image-20200807181616576"></td></tr></tbody></table><ul><li>1KB = 1000 Bytesï¼ˆå­—èŠ‚ï¼‰ï¼ˆåè¿›åˆ¶æ¢ç®—ï¼‰ï¼›1KB = 1024 Bytesï¼ˆäºŒè¿›åˆ¶æ¢ç®—ï¼‰</li></ul><p>è¿™å¼ å…¨å±å£çº¸æˆªå›¾æœªå‹ç¼©å‰å¤§å°ä¸º 2880â€ŠÃ—â€Š1800ï¼Œæ‰€ä»¥æœ‰ 5,184,000 ä¸ªåƒç´ ç‚¹ï¼Œå›¾ç‰‡å†…å­˜ä¸º 8.7 MBï¼ˆ8,738,825 bytesï¼‰ï¼Œæœ‰ 69,910,600 ä½ï¼ˆbitï¼‰ï¼Œæ¯ä¸ªåƒç´ ç‚¹çº¦å  13.5 ä½ã€‚</p><p>å‹ç¼©ååˆ†è¾¨ç‡ä¸å˜ï¼Œå†…å­˜ä¸º 2.8 MBï¼Œä¸º 23,488,102 ä½ï¼Œæ¯ä¸ªåƒç´ ç‚¹çº¦å  4.3 ä½ã€‚</p><p>å¯ä»¥çœ‹å‡ºï¼Œæˆªå±å›¾ç‰‡çš„åƒç´ æ²¡æœ‰è¾¾åˆ°é»˜è®¤çš„ 32 ä½ï¼Œæˆ‘è®¤ä¸ºæ˜¯å›¾ç‰‡é¢œè‰²æ²¡æœ‰ç‰¹åˆ«ä¸°å¯Œï¼Œæ‰€ä»¥ç”¨ä¸äº† 32 ä½è¡¨ç¤ºã€‚æµ‹è¯•æˆªé¢œè‰²å•ä¸€çš„å±å¹•ï¼Œæ‰€éœ€è¦çš„å†…å­˜æ›´ä½ã€‚ä¸ªäººè®¤ä¸ºè¿™è·Ÿ UTF-8 ç±»ä¼¼ï¼Œåƒç´ ç‚¹çš„å¤§å°ä¸ºå¯å˜ï¼Œä¸å¸¸è§çš„é¢œè‰²æ›´å å†…å­˜ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ MacBook Pro çš„å±å¹•åˆ†è¾¨ç‡æ˜¯ 2560 Ã— 1600 pxï¼Œä½†ç³»ç»Ÿé»˜è®¤åšäº†ä¸€å®šç¼©æ”¾ï¼Œç¼©æ”¾ä¸ºäº† 2880â€Š Ã—â€Š 1800 pxï¼Œè€Œå±å¹•æ˜¾ç¤ºä¸º 1440 â€ŠÃ—â€Š 900 ptï¼ˆpointï¼Œ1pt = 2pxï¼‰ï¼Œå³å°† 4 ä¸ªåƒç´ å‹ç¼©ä¸º 1 ä¸ªåƒç´ æ˜¾ç¤ºï¼Œæ¥å®ç°æ›´å¥½çš„æ˜¾ç¤ºæ•ˆæœï¼Œè¿™è¢«ç§°ä¸º Retain æŠ€æœ¯ã€‚æ‰€ä»¥åœ¨ macOS ä¸­ï¼Œæµè§ˆå™¨å‰ç«¯æ ·å¼ 1 px å¯¹åº” 1 ptã€‚</p><h2 id="å››ã€PNG-vs-JPEG-JPG"><a href="#å››ã€PNG-vs-JPEG-JPG" class="headerlink" title="å››ã€PNG vs JPEG(JPG)"></a>å››ã€PNG vs JPEG(JPG)</h2><p><a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics" target="_blank" rel="noopener">PNG</a>ï¼š<strong>P</strong>ortable <strong>N</strong>etwork <strong>G</strong>raphicsï¼Œä¾¿æºå¼ç½‘ç»œå›¾å½¢ã€‚æ˜¯ä¸€ç§æ”¯æŒ<a href="https://en.wikipedia.org/wiki/Lossless_compression" target="_blank" rel="noopener">æ— æŸå‹ç¼©</a>çš„<a href="https://zh.wikipedia.org/wiki/ä½å›¾" target="_blank" rel="noopener">ä½å›¾</a>å›¾å½¢æ ¼å¼ã€‚PNG æ›´é€‚åˆä¿å­˜æˆªå±ã€‚</p><p>æ— æŸå‹ç¼©ä¸€æ–¹é¢æŒ‡å‹ç¼©åå¯¹å›¾ç‰‡è´¨é‡æ²¡æœ‰æŸå¤±ï¼Œå¦ä¸€æ–¹é¢æŒ‡å‹ç¼©åè¿˜å¯ä»¥è¿˜åŸï¼ˆå¦‚å‹ç¼©åŒ…è§£å‹ï¼‰ã€‚PNG å›¾ç‰‡å¯ä»¥æ— æŸå‹ç¼©ï¼Œä½†ä¹Ÿå¯ä»¥æœ‰æŸå‹ç¼©ï¼Œå°±åƒå‰é¢çš„ pngquant ä¸€æ ·ã€‚</p><p><a href="https://en.wikipedia.org/wiki/JPEG" target="_blank" rel="noopener">JPEG</a>ï¼š<strong>J</strong>oint <strong>P</strong>hotographic <strong>E</strong>xperts <strong>G</strong>roupï¼Œè”åˆå›¾åƒä¸“å®¶å°ç»„ã€‚ä¸€ç§ç”¨äº<a href="https://en.wikipedia.org/wiki/Lossy_compression" target="_blank" rel="noopener">æœ‰æŸå‹ç¼©</a>çš„å›¾ç‰‡æ ¼å¼ã€‚æ›´é€‚åˆä¿å­˜ç…§ç‰‡ã€‚</p><!--å¯¹äºè‰²å½©å’Œé˜´å½±å¤æ‚çš„å›¾åƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚--><p>æœ‰æŸå‹ç¼©çš„åŸç†ä¸€èˆ¬æ˜¯å˜æ¢æ•°æ®ç¼–ç æ–¹æ³•ï¼Œå˜æ¢ç¼–ç æ–¹æ³•ä¸ºç”¨ä¸ç²¾ç¡®é€¼è¿‘å’Œéƒ¨åˆ†æ•°æ®ä¸¢å¼ƒæ¥è¡¨ç¤ºå†…å®¹ã€‚æœ‰æŸå‹ç¼©åä¸èƒ½è¿˜åŸã€‚</p><ul><li>JPGï¼šJPG æ˜¯  JPEG å›¾ç‰‡çš„ä¸€ç§æ–‡ä»¶åç¼€ï¼Œå¯ä»¥è®¤ä¸ºä¸¤è€…æ²¡æœ‰åŒºåˆ«ã€‚psï¼šä¸€ä¸ªå·ç§°å¯ä»¥æ— æŸå‹ç¼© JPEG å›¾ç‰‡çš„ç½‘ç«™ï¼š<a href="https://www.picdiet.com/zh-cn" target="_blank" rel="noopener">picdiect</a></li></ul><!--ä¿®æ”¹æˆªå±å›¾ç‰‡ç±»å‹ï¼šdefaults write com.apple.screencapture type PNG--><h2 id="äº”ã€ç»“è¯­"><a href="#äº”ã€ç»“è¯­" class="headerlink" title="äº”ã€ç»“è¯­"></a>äº”ã€ç»“è¯­</h2><p>å…³äºå›¾ç‰‡å¤§å°çš„é”™è§‰ï¼Œæ¥è‡ªä¸€æ¬¡æˆ‘å…¬ä¼—å·ä¸èƒ½æ˜¾ç¤ºæ–‡ç« å›¾ç‰‡çš„ç»å†ï¼Œé‚£å¼ å›¾ç‰‡æ˜¯æˆ‘ç”¨ iPhone æ‹æ‘„çš„å›¾ç‰‡ï¼Œæœ‰å‡  MBï¼Œè¿™é€ æˆäº†æˆ‘è®¤ä¸ºè‹¹æœè®¾å¤‡å›¾ç‰‡ä¼šå¾ˆå¤§çš„é”™è§‰ï¼Œæ‰€ä»¥è®¤ä¸º Clipboard History æ˜¾ç¤ºæˆªå±å›¾ç‰‡å¤§å°å°±æ˜¯æ­£ç¡®çš„ã€‚æˆ‘è¿˜é€šè¿‡å°†å›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘åï¼Œåœ¨çº¿æ‰“å¼€é“¾æ¥ï¼Œå¤åˆ¶å›¾ç‰‡åˆ°å‰ªè´´æ¿ï¼Œå†é€šè¿‡ Clipboard History æ¥æŸ¥çœ‹å›¾ç‰‡å¤§å°æ¥éªŒè¯å›¾ç‰‡æ˜¯ä¸æ˜¯çœŸçš„è¿™ä¹ˆå¤§ï¼Œè¿™ç§é”™è¯¯çš„æ–¹å¼è¿›ä¸€æ­¥åŠ æ·±äº†æˆ‘è®¤ä¸ºå›¾ç‰‡ç¡®å®å¾ˆå¤§çš„é”™è§‰ã€‚æ±—é¢œã€‚</p><p>å‹æƒ…æç¤ºï¼šä½¿ç”¨é˜¿é‡Œäº‘å¯¹è±¡å‚¨å­˜ä½œä¸ºå›¾åºŠæ—¶ï¼Œå»ºè®®è®¾ç½®<a href="https://help.aliyun.com/document_detail/31869.html" target="_blank" rel="noopener">é˜²ç›—é“¾</a>ï¼Œé¿å…åˆ«äººä½¿ç”¨ä½ å›¾ç‰‡é“¾æ¥é€ æˆä½ å›¾åºŠè´¹ç”¨å¤§å¹…å¢åŠ çš„é—®é¢˜ã€‚</p><p>è¿™ç¯‡æ–‡ç« å®ç°è‡ªåŠ¨å‹ç¼©æˆªå±ç”¨æ—¶ä¸å¤šï¼Œä½†ä¸ºäº†æ­£ç¡®è¡¨è¿°å‡ºã€Œåƒç´ ä¸åˆ†è¾¨ç‡ã€å´ç”¨æ—¶ä¸å°‘ï¼Œè€Œå…³äºä¸ºä»€ä¹ˆ PNG é€‚åˆä¿å­˜æˆªå›¾ï¼ŒJPEG é€‚åˆä¿å­˜ç…§ç‰‡ï¼Œä¹Ÿè¿˜æ²¡å½»åº•ææ‡‚ï¼Œåé¢æœ‰æœºä¼šå†æ·±å…¥ç ”ç©¶ä¸€ä¸‹ã€‚</p><p>æœ€åï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ³•å®ç°æˆªå±å‹ç¼©ï¼Œè¯·ä¸€å®šç•™è¨€å‘Šè¯‰æˆ‘ã€‚</p><h2 id="å…­ã€å»¶ä¼¸é˜…è¯»"><a href="#å…­ã€å»¶ä¼¸é˜…è¯»" class="headerlink" title="å…­ã€å»¶ä¼¸é˜…è¯»"></a>å…­ã€å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="https://about.gitlab.com/blog/2020/01/30/simple-trick-for-smaller-screenshots/" target="_blank" rel="noopener">One simple trick to make your screenshots 80% smaller</a></li><li><a href="https://undsgn.com/jpg-vs-png/" target="_blank" rel="noopener">JPG vs PNG: Which to Choose for Your Website?</a></li><li><a href="http://screen-size.info/" target="_blank" rel="noopener">Screen Size Calculator</a></li><li><a href="https://www.piliapp.com/actual-size/cm-ruler/" target="_blank" rel="noopener">What is my monitor size?</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/08/07/how-to-automatically-compress-screenshot-size-in-macos/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä¸€é“ç®—æ³•é¢˜ï¼šæ°´æµè¿‡å‡ ä¸ªæ ¼å­</title>
      <link>https://depp.wang/2020/07/01/how-many-the-grids-does-water-flow-through/</link>
      <guid>https://depp.wang/2020/07/01/how-many-the-grids-does-water-flow-through/</guid>
      <pubDate>Wed, 01 Jul 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;https://depp.wang&quot;&gt;DeppWang&lt;/a&gt;ã€&lt;a href=&quot;https://depp.wang/2020/07/01/how-many-the-grids-does-water-flow-through&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;é¢˜ç›®æ¥æº&quot;&gt;&lt;a href=&quot;#é¢˜ç›®æ¥æº&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®æ¥æº&quot;&gt;&lt;/a&gt;é¢˜ç›®æ¥æº&lt;/h2&gt;&lt;p&gt;ä¸€é“åšæ™ºèƒ½çš„å¯¹è¯æœºå™¨äººå…¬å¸çš„ç®—æ³•æµ‹è¯•é¢˜&lt;/p&gt;
&lt;!--[çˆ±å› äº’åŠ¨](https://einplus.cn/) Python èŒä½æµ‹è¯•é¢˜--&gt;
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>ä½œè€…ï¼š<a href="https://depp.wang">DeppWang</a>ã€<a href="https://depp.wang/2020/07/01/how-many-the-grids-does-water-flow-through">åŸæ–‡åœ°å€</a></p></blockquote><h2 id="é¢˜ç›®æ¥æº"><a href="#é¢˜ç›®æ¥æº" class="headerlink" title="é¢˜ç›®æ¥æº"></a>é¢˜ç›®æ¥æº</h2><p>ä¸€é“åšæ™ºèƒ½çš„å¯¹è¯æœºå™¨äººå…¬å¸çš„ç®—æ³•æµ‹è¯•é¢˜</p><!--[çˆ±å› äº’åŠ¨](https://einplus.cn/) Python èŒä½æµ‹è¯•é¢˜--><a id="more"></a><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>æœ‰ä¸€ä¸ªçŸ©å½¢çš„æ°´æ§½è¢«åˆ†ä¸ºäº† N * M ä¸ªæ ¼å­ï¼Œæ¯ä¸ªæ ¼å­å†…çš„é«˜åº¦éƒ½ä¸åŒï¼Œæ¯ä¸ªæ ¼å­å’Œç›´æ¥ç›¸é‚»çš„æ ¼å­ç›¸é€šï¼ˆå¯¹è§’ç›¸é‚»çš„ä¸ç›¸é€šï¼‰ã€‚ä»æœ€å·¦ä¸Šè§’çš„æ ¼å­æ³¨å…¥æ°´ï¼Œæ°´ä¼šå‘ç›¸é€šçš„è¾ƒä½çš„æˆ–åŒæ ·é«˜çš„æ ¼å­æµåŠ¨ï¼Œä½†ä¸ä¼šæµå‘è¾ƒé«˜çš„æ ¼å­ã€‚è¯·å†™ç¨‹åºè®¡ç®—æ°´ä¸€å…±ä¼šæµç»å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ</p><p> ä¾‹å¦‚å¦‚æœæ ¼å­é«˜åº¦å¦‚ä¸‹åˆ†å¸ƒï¼š</p><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">3 | 5 | 1</span><br><span class="line">---------</span><br><span class="line">2 | 1 | 5  </span><br><span class="line">---------</span><br><span class="line">4 | 2 | 1</span><br></pre></td></tr></table></figure><p>åˆ™æ°´ä¼šä»å·¦ä¸Šè§’æµç» 3ã€2ã€1 ä¸‰ä¸ªæ ¼å­ï¼Œç­”æ¡ˆä¸º 3ã€‚</p><h2 id="è§£é¢˜æ–¹æ¡ˆ"><a href="#è§£é¢˜æ–¹æ¡ˆ" class="headerlink" title="è§£é¢˜æ–¹æ¡ˆ"></a>è§£é¢˜æ–¹æ¡ˆ</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ul><li>éœ€è¦åˆ©ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆé˜Ÿåˆ—ï¼‰çš„æ€è·¯</li><li>å°†å…ƒç´ ä½ç½®ä½œä¸ºé˜Ÿåˆ—å…ƒç´ ï¼Œè€Œä¸ä½¿ç”¨å…ƒç´ å€¼ä½œä¸ºé˜Ÿåˆ—å…ƒç´ </li><li>å°† [0, 0] åŠ å…¥é˜Ÿåˆ—ï¼Œä¾æ¬¡éå†é˜Ÿåˆ—ï¼Œå°†å››å‘¨å°äºå½“å‰æ•°å€¼çš„å…ƒç´ åŠ å…¥é˜Ÿåˆ—ï¼Œç›´åˆ°éå†å®Œ</li></ul><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">3 | 5 | 1</span><br><span class="line">---------</span><br><span class="line">2 | 1 | 5  </span><br><span class="line">---------</span><br><span class="line">4 | 2 | 1</span><br></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">   <span class="number">3</span></span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">   <span class="number">3</span>     <span class="number">2</span></span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">0</span>]]</span><br><span class="line">   â†‘     </span><br><span class="line">   <span class="number">3</span>     <span class="number">2</span>     <span class="number">1</span></span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">1</span>]]</span><br><span class="line">         â†‘</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">5 | 5 | 1</span><br><span class="line">---------</span><br><span class="line">2 | 1 | 5  </span><br><span class="line">---------</span><br><span class="line">4 | 2 | 1</span><br></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">   <span class="number">5</span></span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>]]</span><br><span class="line">   </span><br><span class="line">   <span class="number">5</span>     <span class="number">5</span>    <span class="number">2</span></span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>]]</span><br><span class="line">   â†‘</span><br><span class="line">   <span class="number">5</span>     <span class="number">5</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">1</span>]]</span><br><span class="line">         â†‘</span><br><span class="line">   <span class="number">5</span>     <span class="number">5</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">1</span>     </span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">1</span>]]  [<span class="number">1</span>,<span class="number">1</span>] å·²å­˜åœ¨ï¼Œè·³è¿‡</span><br><span class="line">               â†‘</span><br><span class="line">   <span class="number">5</span>     <span class="number">5</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">1</span>     </span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">1</span>]]</span><br><span class="line">                     â†‘</span><br><span class="line">   <span class="number">5</span>     <span class="number">5</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">1</span>     </span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">1</span>]]</span><br><span class="line">                           â†‘</span><br></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(N^2)ã€‚N ä¸ºæ ¼å­æ•°é‡ï¼Œå› éœ€è¦åˆ¤æ–­å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦è·Ÿå…¶ä»–å…ƒç´ æ¯”è¾ƒ</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(N)ã€‚N ä¸ºæ ¼å­æ•°é‡ï¼Œæœ€é•¿éœ€è¦é•¿åº¦ä¸º N çš„é¢å¤–é˜Ÿåˆ—</li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printGridNumber</span><span class="params">(self, height_arr)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">judge_contain</span><span class="params">(key, queue)</span>:</span></span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> queue:</span><br><span class="line">                <span class="keyword">if</span> x == key:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(queue, i, j)</span>:</span></span><br><span class="line">            xlen = len(height_arr)</span><br><span class="line">            ylen = len(height_arr[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> i - <span class="number">1</span> &gt;= <span class="number">0</span> <span class="keyword">and</span> height_arr[i - <span class="number">1</span>][j] &lt;= height_arr[i][j] <span class="keyword">and</span> <span class="keyword">not</span> judge_contain([i - <span class="number">1</span>, j], queue):</span><br><span class="line">                queue.append([i - <span class="number">1</span>, j])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> j - <span class="number">1</span> &gt;= <span class="number">0</span> <span class="keyword">and</span> height_arr[i][j - <span class="number">1</span>] &lt;= height_arr[i][j] <span class="keyword">and</span> <span class="keyword">not</span> judge_contain([i, j - <span class="number">1</span>], queue):</span><br><span class="line">                queue.append([i, j - <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i + <span class="number">1</span> &lt; xlen <span class="keyword">and</span> height_arr[i + <span class="number">1</span>][j] &lt;= height_arr[i][j] <span class="keyword">and</span> <span class="keyword">not</span> judge_contain([i + <span class="number">1</span>, j], queue):</span><br><span class="line">                queue.append([i + <span class="number">1</span>, j])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> j + <span class="number">1</span> &lt; ylen <span class="keyword">and</span> height_arr[i][j + <span class="number">1</span>] &lt;= height_arr[i][j] <span class="keyword">and</span> <span class="keyword">not</span> judge_contain([i, j + <span class="number">1</span>], queue):</span><br><span class="line">                queue.append([i, j + <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        queue = [[<span class="number">0</span>, <span class="number">0</span>]]</span><br><span class="line">        append(queue, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> queue:</span><br><span class="line">            append(queue, x[<span class="number">0</span>], x[<span class="number">1</span>])</span><br><span class="line">            <span class="comment"># print(queue)</span></span><br><span class="line">        <span class="keyword">return</span> len(queue)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    height_arr = [[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>]]</span><br><span class="line">    print(solution.printGridNumber(height_arr))</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h2><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[[<span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>], [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>]]  # input</span><br><span class="line"><span class="number">3</span>                                  # expect value</span><br><span class="line"></span><br><span class="line">[[<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>], [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>]]</span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]]</span><br><span class="line"><span class="number">9</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>]]</span><br><span class="line"><span class="number">8</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>], [<span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>], [<span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]]</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯æ€è·¯"><a href="#é”™è¯¯æ€è·¯" class="headerlink" title="é”™è¯¯æ€è·¯"></a>é”™è¯¯æ€è·¯</h2><ul><li>ç›´æ¥éå†æ‰€æœ‰å…ƒç´ ï¼Œå¦‚æœå½“å‰å€¼å°äºå·¦ä¸Šè§’ã€å°äºå‘¨å›´çš„å€¼ã€å‘¨å›´çš„å€¼å°äºå·¦ä¸Šè§’ï¼Œåˆ™å°†ç»“æœåŠ  1</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printGridNumber</span><span class="params">(self, height_arr)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">judge</span><span class="params">(i, j)</span>:</span></span><br><span class="line">            left_top_height = height_arr[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            xlen = len(height_arr)</span><br><span class="line">            ylen = len(height_arr[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> i - <span class="number">1</span> &gt;= <span class="number">0</span> <span class="keyword">and</span> left_top_height &gt;= height_arr[i - <span class="number">1</span>][j] &gt;= height_arr[i][j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> j - <span class="number">1</span> &gt;= <span class="number">0</span> <span class="keyword">and</span> left_top_height &gt;= height_arr[i][j - <span class="number">1</span>] &gt;= height_arr[i][j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i + <span class="number">1</span> &lt; xlen <span class="keyword">and</span> left_top_height &gt;= height_arr[i + <span class="number">1</span>][j] &gt;= height_arr[i][j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> j + <span class="number">1</span> &lt; ylen <span class="keyword">and</span> left_top_height &gt;= height_arr[i][j + <span class="number">1</span>] &gt;= height_arr[i][j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(height_arr) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> len(height_arr[<span class="number">0</span>]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        left_top_height = height_arr[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># print(left_top_height)</span></span><br><span class="line">        number = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(height_arr)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(height_arr[<span class="number">0</span>])):</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">and</span> j == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> height_arr[i][j] &lt;= left_top_height <span class="keyword">and</span> judge(i, j):</span><br><span class="line">                    number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> number</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    height_arr = [[<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>],[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>],[<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>]]</span><br><span class="line">    print(solution.printGridNumber(height_arr))</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>https://depp.wang/2020/07/01/how-many-the-grids-does-water-flow-through/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä¸€ä¸ªå‘å¸ƒæ–‡ç« åˆ°åšå®¢å›­çš„ Python è„šæœ¬</title>
      <link>https://depp.wang/2020/06/20/a-python-script-to-edit-and-add-cnblogs-posts/</link>
      <guid>https://depp.wang/2020/06/20/a-python-script-to-edit-and-add-cnblogs-posts/</guid>
      <pubDate>Sat, 20 Jun 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;!--ä¸€ä¸ªè‡ªåŠ¨å‘å¸ƒã€æ›´æ–°æœ¬åœ°æ–‡ç« åˆ°åšå®¢å›­çš„ Python è„šæœ¬--&gt;

&lt;!--ä¸€ä¸ªå¯è‡ªåŠ¨å‘å¸ƒæœ¬åœ°æ–‡ç« åˆ°åšå®¢å›­åŠæ›´æ–°åšå®¢å›­æ–‡ç« çš„ Python è„šæœ¬--&gt;

&lt;!--ä¸€ä¸ªå¯ç¼–è¾‘ä¸æ–°å¢åšå®¢å›­æ–‡ç« çš„ Python è„šæœ¬--&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://depp.wang/2020/06/20/a-python-script-to-edit-and-add-cnblogs-posts&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘çš„&lt;a href=&quot;https//depp.wang&quot;&gt;ä¸ªäººç‹¬ç«‹åšå®¢&lt;/a&gt;æ˜¯åŸºäº Hexo æ­å»ºçš„ï¼Œå› ä¸ºå°ç«™ï¼ŒGoogle æœç´¢å¼•æ“æ”¶å½•æ–‡ç« æ¯”è¾ƒæ…¢ï¼Œè¿˜æœä¸åˆ°&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›æŠŠæ–‡ç« ä¹Ÿé¡ºä¾¿å‘å¸ƒåˆ°åšå®¢å¹³å°&lt;a href=&quot;https://www.cnblogs.com/deppwang&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åšå®¢å›­&lt;/a&gt;ä¸Šã€‚ä½†ä¸æƒ³æ¯æ¬¡æ‰‹åŠ¨å¤åˆ¶ç²˜è´´ï¼Œæ‰“ç®—åˆ©ç”¨è„šæœ¬å®ç°ï¼Œå¸Œæœ›é™¤äº†å‘å¸ƒï¼Œå¹¶ä¸”è¿˜èƒ½æ›´æ–°æ–‡ç« ã€‚åŸæ¥æ‰“ç®—&lt;a href=&quot;https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/&quot;&gt;æ‰¾åˆ°åšå®¢å›­æ¥å£&lt;/a&gt;ï¼Œæ¨¡æ‹Ÿæ“ä½œæ¥å£å®ç°ã€‚æœç´¢å‘ç°åšå®¢å›­æä¾›äº† &lt;a href=&quot;https://rpc.cnblogs.com/metaweblog/deppwang&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MetaWeblog æ¥å£&lt;/a&gt;ï¼Œæ‰€ä»¥åˆ©ç”¨æ¥å£ï¼Œå¼€å‘äº†è¿™ä¸ªè„šæœ¬ã€‚&lt;a href=&quot;https://github.com/DeppWang/cnblogs-post&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æºç åœ°å€&lt;/a&gt;&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<!--ä¸€ä¸ªè‡ªåŠ¨å‘å¸ƒã€æ›´æ–°æœ¬åœ°æ–‡ç« åˆ°åšå®¢å›­çš„ Python è„šæœ¬--><!--ä¸€ä¸ªå¯è‡ªåŠ¨å‘å¸ƒæœ¬åœ°æ–‡ç« åˆ°åšå®¢å›­åŠæ›´æ–°åšå®¢å›­æ–‡ç« çš„ Python è„šæœ¬--><!--ä¸€ä¸ªå¯ç¼–è¾‘ä¸æ–°å¢åšå®¢å›­æ–‡ç« çš„ Python è„šæœ¬--><blockquote><p><a href="https://depp.wang/2020/06/20/a-python-script-to-edit-and-add-cnblogs-posts">åŸæ–‡åœ°å€</a></p></blockquote><p>æˆ‘çš„<a href="https//depp.wang">ä¸ªäººç‹¬ç«‹åšå®¢</a>æ˜¯åŸºäº Hexo æ­å»ºçš„ï¼Œå› ä¸ºå°ç«™ï¼ŒGoogle æœç´¢å¼•æ“æ”¶å½•æ–‡ç« æ¯”è¾ƒæ…¢ï¼Œè¿˜æœä¸åˆ°</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›æŠŠæ–‡ç« ä¹Ÿé¡ºä¾¿å‘å¸ƒåˆ°åšå®¢å¹³å°<a href="https://www.cnblogs.com/deppwang" target="_blank" rel="noopener">åšå®¢å›­</a>ä¸Šã€‚ä½†ä¸æƒ³æ¯æ¬¡æ‰‹åŠ¨å¤åˆ¶ç²˜è´´ï¼Œæ‰“ç®—åˆ©ç”¨è„šæœ¬å®ç°ï¼Œå¸Œæœ›é™¤äº†å‘å¸ƒï¼Œå¹¶ä¸”è¿˜èƒ½æ›´æ–°æ–‡ç« ã€‚åŸæ¥æ‰“ç®—<a href="https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/">æ‰¾åˆ°åšå®¢å›­æ¥å£</a>ï¼Œæ¨¡æ‹Ÿæ“ä½œæ¥å£å®ç°ã€‚æœç´¢å‘ç°åšå®¢å›­æä¾›äº† <a href="https://rpc.cnblogs.com/metaweblog/deppwang" target="_blank" rel="noopener">MetaWeblog æ¥å£</a>ï¼Œæ‰€ä»¥åˆ©ç”¨æ¥å£ï¼Œå¼€å‘äº†è¿™ä¸ªè„šæœ¬ã€‚<a href="https://github.com/DeppWang/cnblogs-post" target="_blank" rel="noopener">æºç åœ°å€</a></p><a id="more"></a><h2 id="å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè„šæœ¬"><a href="#å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè„šæœ¬" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè„šæœ¬"></a>å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè„šæœ¬</h2><p>åšå®¢å›­ -&gt; ç®¡ç† -&gt; è®¾ç½® -&gt; å…è®¸ MetaWeblog åšå®¢å®¢æˆ·ç«¯è®¿é—®</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-20-105444.png" alt="image-20200620185444059"></p><p>åœ¨ <code>cnblogs-post.py</code> ä¸­é…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">config = &#123;</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'https://rpc.cnblogs.com/metaweblog/deppwang'</span>,               <span class="comment"># ä½ çš„ MetaWeblog è®¿é—®åœ°å€</span></span><br><span class="line">    <span class="string">'username'</span>: <span class="string">'DeppWangXQ'</span>,                                           <span class="comment"># ä½ çš„ç™»å½•ç”¨æˆ·åï¼Œå¯èƒ½è·Ÿä¸Šé¢çš„ä¸ä¸€è‡´</span></span><br><span class="line">    <span class="string">'password'</span>: <span class="string">'12345678'</span>                                              <span class="comment"># ä½ çš„ç™»å½•å¯†ç </span></span><br><span class="line">    <span class="string">'local_post_path'</span>: <span class="string">'/Users/yanjie/GitHub/HexoBlog/source/_posts/'</span>   <span class="comment"># ä½ çš„æœ¬åœ°åšæ–‡è·¯å¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ç« å¼€å¤´ï¼Œæ·»åŠ æ–‡ç« ä¿¡æ¯å—ï¼Œè‡³å°‘éœ€è¦åŒ…æ‹¬ title å’Œ tagsï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: ä¸€ä¸ªå¯ç¼–è¾‘ä¸æ–°å¢åšå®¢å›­æ–‡ç« çš„ Python è„šæœ¬</span><br><span class="line">english_title: a-python-script-to-edit-and-add-cnblogs-posts</span><br><span class="line">date: 2020-06-20 20:48:37</span><br><span class="line">tags: åšå®¢å›­</span><br><span class="line">categories: Tools</span><br><span class="line">---</span><br><span class="line">æ­£æ–‡å¼€å§‹ ...</span><br></pre></td></tr></table></figure><p>è„šæœ¬æ ¹æ®æ–‡ç« åç§°æ¥åˆ¤æ–­æ˜¯å¦å·²ç»å‘å¸ƒï¼Œå¦‚æœå·²ç»å‘å¸ƒï¼Œæ›´æ–°ï¼Œå¦åˆ™æ–°å¢ã€‚é»˜è®¤åªæ“ä½œæœ€è¿‘ä¿®æ”¹æ–‡ç« ï¼Œä½†ä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ç« æ•°é‡ï¼ˆcountï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 cnblogs-post.py [count]   <span class="comment"># macOS/Linux</span></span><br><span class="line">python cnblogs-post.py [count]    <span class="comment"># Windows</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤æœ€è¿‘å‘å¸ƒæ–‡ç« </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 cnblogs-post.py delete    <span class="comment"># macOS/Linux</span></span><br><span class="line">python cnblogs-post.py delete     <span class="comment"># Windows</span></span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xmlrpc.client</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'https://rpc.cnblogs.com/metaweblog/deppwang'</span>,</span><br><span class="line">    <span class="string">'username'</span>: <span class="string">''</span>, </span><br><span class="line">    <span class="string">'password'</span>: <span class="string">''</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaWeblog</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, url, username, password)</span>:</span></span><br><span class="line">        self.url, self.username, self.password = url, username, password</span><br><span class="line">        self.proxy = xmlrpc.client.ServerProxy(self.url)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRecentPosts</span><span class="params">(self, count)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.proxy.metaWeblog.getRecentPosts(<span class="string">''</span>, self.username, self.password, count)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    metaWeblog = MetaWeblog(config[<span class="string">'url'</span>], config[<span class="string">'username'</span>], config[<span class="string">'password'</span>])</span><br><span class="line">    posts = metaWeblog.getRecentPosts(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><h2 id="ä¸€æ–‡å¤šå‘"><a href="#ä¸€æ–‡å¤šå‘" class="headerlink" title="ä¸€æ–‡å¤šå‘"></a>ä¸€æ–‡å¤šå‘</h2><p>è„šæœ¬åªå®ç°å‘å¸ƒã€æ›´æ–°æ–‡ç« åˆ°åšå®¢å›­ã€‚å¦‚æœæƒ³å®ç°ä¸€æ–‡å¤šå‘ï¼Œå¯ä½¿ç”¨ OpenWritï¼Œæˆ–è‡ªå·±å¼€å‘ç›¸åº”è„šæœ¬ï¼Œæ–¹æ³•ä¸º<a href="https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/">æ‰¾åˆ°ç›¸åº”æ¥å£</a>ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ“ä½œæ¥å£çš„æ–¹å¼å®ç°</p><p>æˆ‘ä¸ªäººæ²¡æœ‰ä¸€æ–‡å¤šå‘çš„éœ€æ±‚ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åšåš</p><!--ä¸€æ–‡å¤šå‘æ›´å¤šæ˜¯é¢å‘è‡ªåª’ä½“å·¥ä½œè€…ï¼Œä»–ä»¬éœ€è¦å›¾å½¢åŒ–é¡µé¢ï¼Œç»Ÿè®¡æ•°æ®ç­‰åŠŸèƒ½ã€‚--><!--ArtiPub ä½¿ç”¨ [Puppeteer](https://github.com/puppeteer/puppeteer)ï¼Œå¤ªé‡é‡çº§äº†ï¼Œç¨³å®šæ€§ä¹Ÿæ¯”è¾ƒå·®ã€‚ä¸€æ–‡å¤šå‘çš„ç›®çš„æ˜¯æ‰©æ•£ï¼Œæœ€é‡è¦æ˜¯æ–¹ä¾¿ã€å¿«é€Ÿï¼ˆå‘½ä»¤è¡Œè¿è¡Œå³å¯ï¼‰ï¼Œé™¤äº†å‘å¸ƒï¼Œæœ€å¥½è¿˜æœ‰æ›´æ–°åŠŸèƒ½ï¼Œåƒé˜…è¯»ç»Ÿè®¡ä¹‹ç±»çš„åŠŸèƒ½å…¶å®å¯æœ‰å¯æ— ã€‚--><!--OpenWrit åº”è¯¥ä¹Ÿå°±æ˜¯ä½¿ç”¨æ¨¡æ‹Ÿæ“ä½œæ¥å£çš„æ–¹å¼å®ç°çš„ï¼Œå…¶å®æˆ‘ä»¬è‡ªå·±å¯ä»¥æ‰¾åˆ°ç›¸åº”æ¥å£ï¼Œå†™è„šæœ¬å®ç°ï¼Œæ‰¾æ¥å£å¯å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/)--><!--æˆ‘ä¸ªäººæ²¡æœ‰ä¸€æ–‡å¤šå‘çš„éœ€æ±‚ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åšåš--><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://extendswind.top/posts/technical/python3_publish_blog/" target="_blank" rel="noopener">https://extendswind.top/posts/technical/python3_publish_blog/</a></li><li><a href="https://github.com/Whistle1988/auto_post_article" target="_blank" rel="noopener">https://github.com/Whistle1988/auto_post_article</a></li><li><a href="https://rpc.cnblogs.com/metaweblog/deppwang" target="_blank" rel="noopener">https://rpc.cnblogs.com/metaweblog/deppwang</a></li><li><a href="http://samwirch.com/blog/recursively-find-the-last-modified-file-in-python" target="_blank" rel="noopener">http://samwirch.com/blog/recursively-find-the-last-modified-file-in-python</a></li><li><a href="https://github.com/executablebooks/markdown-it-py" target="_blank" rel="noopener">https://github.com/executablebooks/markdown-it-py</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/06/20/a-python-script-to-edit-and-add-cnblogs-posts/#disqus_thread</comments>
    </item>
    
    <item>
      <title>å¿«é€Ÿæ’åºçš„å‡ ç§å®ç°æ–¹å¼</title>
      <link>https://depp.wang/2020/06/18/several-implementations-of-quick-sort/</link>
      <guid>https://depp.wang/2020/06/18/several-implementations-of-quick-sort/</guid>
      <pubDate>Thu, 18 Jun 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://depp.wang/2020/06/18/several-implementations-of-quick-sort/&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¿«é€Ÿæ’åºï¼ˆquick sortï¼‰çš„ç‰¹ç‚¹æ˜¯åˆ†å—æ’åºï¼Œä¹Ÿå«åˆ’åˆ†äº¤æ¢æ’åºï¼ˆpartition-exchange sortï¼‰&lt;/p&gt;
&lt;p&gt;ä»£ç å®ç°æ–¹å¼å¯ä»¥æœ‰è¿™ä¹ˆå‡ ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‹¼æ¥ç»“æœ&lt;/li&gt;
&lt;li&gt;å·¦å³ç›¸äº’äº¤æ¢&lt;/li&gt;
&lt;li&gt;å¿«æ…¢æŒ‡é’ˆ&lt;/li&gt;
&lt;/ol&gt;
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://depp.wang/2020/06/18/several-implementations-of-quick-sort/">åŸæ–‡åœ°å€</a></p></blockquote><p>å¿«é€Ÿæ’åºï¼ˆquick sortï¼‰çš„ç‰¹ç‚¹æ˜¯åˆ†å—æ’åºï¼Œä¹Ÿå«åˆ’åˆ†äº¤æ¢æ’åºï¼ˆpartition-exchange sortï¼‰</p><p>ä»£ç å®ç°æ–¹å¼å¯ä»¥æœ‰è¿™ä¹ˆå‡ ç§ï¼š</p><ol><li>æ‹¼æ¥ç»“æœ</li><li>å·¦å³ç›¸äº’äº¤æ¢</li><li>å¿«æ…¢æŒ‡é’ˆ</li></ol><a id="more"></a><h2 id="1-æ‹¼æ¥ç»“æœ"><a href="#1-æ‹¼æ¥ç»“æœ" class="headerlink" title="1. æ‹¼æ¥ç»“æœ"></a>1. æ‹¼æ¥ç»“æœ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quicksort</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="comment"># å½“ä¸º 0 ä¸ªæˆ– 1 ä¸ªæ—¶ï¼Œè‚¯å®šæœ‰åºï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> nums</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># é€‰æ‹©ç¬¬ä¸€ä½ä½œä¸ºä¸­ä½æ•°</span></span><br><span class="line">            mid = nums[<span class="number">0</span>]</span><br><span class="line">            less = [num <span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:] <span class="keyword">if</span> num &lt;= mid]</span><br><span class="line">            greater = [num <span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:] <span class="keyword">if</span> num &gt; mid]</span><br><span class="line">            <span class="keyword">return</span> self.quicksort(less) + [mid] + self.quicksort(greater)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æœ€ç›´è§‚ï¼Œæœ€å¥½ç†è§£ï¼Œä½†æ•ˆç‡ä¸é«˜ã€‚ä¸ºäº†æ‰¾å‡ºå¤§äºå’Œå°äºä¸­ä½æ•°çš„å…ƒç´ ï¼Œå¾ªç¯éå†äº† 2 æ¬¡</p><p>åšä¸€ç‚¹å°å°çš„ä¿®æ”¹ï¼Œæ”¹ä¸ºä¸€æ¬¡éå†ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quicksort</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> nums</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mid = nums[<span class="number">0</span>]</span><br><span class="line">            less, greater = self.partition(nums, mid)[<span class="number">0</span>], self.partition(nums, mid)[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">return</span> self.quicksort(less) + [mid] + self.quicksort(greater)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, nums, mid)</span>:</span></span><br><span class="line">        less, greater = [], []</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line">            <span class="keyword">if</span> num &lt;= mid:</span><br><span class="line">                less.append(num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                greater.append(num)</span><br><span class="line">        <span class="keyword">return</span> less, greater</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–åï¼Œè¿è¡Œæ—¶é—´é™ä½äº†ï¼Œä½†ç©ºé—´ä½¿ç”¨è¿˜å¾ˆé«˜ï¼Œæ¯æ¬¡é€’å½’éƒ½é¢å¤–éœ€è¦ 2 ä¸ªå¹³å‡é•¿åº¦ä¸º  &frac14; n çš„æ•°ç»„</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span> ... + n<span class="number">-1</span> + n = ((n + <span class="number">1</span>) * n ) / <span class="number">2</span></span><br><span class="line">å¹³å‡å€¼ = ((n + <span class="number">1</span>) * n ) / <span class="number">2</span> / n = (n + <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">ä¸¤ä¸ªæ•°ç»„å¹³åˆ†å¹³å‡å€¼ï¼š (n + <span class="number">1</span>) / <span class="number">2</span> / <span class="number">2</span> â‰ˆ <span class="number">1</span>/<span class="number">4</span> n</span><br></pre></td></tr></table></figure><h2 id="2-å·¦å³ç›¸äº’äº¤æ¢"><a href="#2-å·¦å³ç›¸äº’äº¤æ¢" class="headerlink" title="2. å·¦å³ç›¸äº’äº¤æ¢"></a>2. å·¦å³ç›¸äº’äº¤æ¢</h2><p>å…¶å®å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œç›´æ¥æ“ä½œåŸæ•°ç»„ã€‚é€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ï¼Œå°†å°äºå®ƒå’Œå¤§äºå®ƒçš„å…ƒç´ ç›¸äº’äº¤æ¢ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quicksort</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        self.quick_sort(nums, <span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(self, nums, start, end)</span>:</span></span><br><span class="line">        <span class="comment"># end - start &lt; 1</span></span><br><span class="line">        <span class="keyword">if</span> start &gt;= end:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ¯æ¬¡ä½¿ç”¨æœ€åä¸€ä¸ªæ•°ä½œä¸ºåŸºå‡†å€¼</span></span><br><span class="line">        pivot_index = end</span><br><span class="line">        pivot = nums[pivot_index]</span><br><span class="line">        </span><br><span class="line">        left, right = start, end - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            <span class="comment"># å·¦è¾¹è·³è¿‡æ‰€æœ‰å°äºåŸºå‡†å€¼çš„å…ƒç´ </span></span><br><span class="line">            <span class="keyword">while</span> nums[left] &lt;= pivot <span class="keyword">and</span> left &lt; right:</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">            <span class="comment"># å³è¾¹è·³è¿‡æ‰€æœ‰å¤§äºåŸºå‡†å€¼çš„å…ƒç´ </span></span><br><span class="line">            <span class="keyword">while</span> nums[right] &gt; pivot <span class="keyword">and</span> left &lt; right:</span><br><span class="line">                right -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># äº¤æ¢</span></span><br><span class="line">            nums[left], nums[right] = nums[right], nums[left]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ­¤æ—¶å·¦å³æŒ‡é’ˆé‡åˆï¼ˆleft == rightï¼‰ï¼Œå…¶æŒ‡å‘å…ƒç´ å¯èƒ½å¤§äºåŸºå‡†å€¼</span></span><br><span class="line">        <span class="keyword">if</span> nums[left] &gt; pivot:</span><br><span class="line">            nums[left], nums[pivot_index] = nums[pivot_index], nums[left]</span><br><span class="line">        <span class="comment"># ä½¿ left å§‹ç»ˆä½œä¸ºè¾ƒå¤§åŒºé—´çš„ç¬¬ 1 ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">        self.quick_sort(nums, start, left - <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># pivot ä¸ä¸€å®šåœ¨ä¸­é—´ï¼Œæ‰€ä»¥åŒ…å« left</span></span><br><span class="line">        self.quick_sort(nums, left, end)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ­¤ç§æ–¹å¼ï¼Œæœ€å¥½è¦å°†å¼€å¤´ï¼ˆæˆ–æœ«å°¾ï¼‰çš„å…ƒç´ è®¾ä¸ºåŸºå‡†å€¼ã€‚å¦‚æœä½¿ç”¨ä¸­é—´å…ƒç´ ï¼Œä¹Ÿæœ€å¥½å…ˆäº¤æ¢åˆ°å¼€å¤´ï¼ˆæˆ–æœ«å°¾ï¼‰ï¼Œå¦åˆ™å°†è€ƒè™‘å¤§é‡åœºæ™¯ã€‚</p><p>æ’åºè¿‡ç¨‹ï¼š</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[<span class="number">6</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">2</span>  <span class="number">4</span>]</span><br><span class="line"> â†‘                 â†‘  ^</span><br><span class="line">[<span class="number">2</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">4</span>]</span><br><span class="line">    â†‘     â†‘           ^</span><br><span class="line">[<span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">4</span>]</span><br><span class="line">          â†‘â†‘          ^</span><br><span class="line">[<span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br><span class="line">          ^           </span><br><span class="line">[<span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>][<span class="number">4</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br></pre></td></tr></table></figure><p>nums[left] &lt;= pivot æ—¶ï¼š</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[<span class="number">6</span>  <span class="number">7</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span>]</span><br><span class="line"> â†‘                 â†‘  ^</span><br><span class="line">[<span class="number">2</span>  <span class="number">7</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">1</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br><span class="line">    â†‘           â†‘     ^</span><br><span class="line">[<span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br><span class="line">          â†‘â†‘          ^</span><br><span class="line">[<span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">4</span>][<span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br></pre></td></tr></table></figure><h2 id="3-å¿«æ…¢æŒ‡é’ˆ"><a href="#3-å¿«æ…¢æŒ‡é’ˆ" class="headerlink" title="3. å¿«æ…¢æŒ‡é’ˆ"></a>3. å¿«æ…¢æŒ‡é’ˆ</h2><p>ä¸Šé¢è¿™ç§æ–¹å¼å…¶å®ä½¿ç”¨ä¸¤ä¸ªç›¸å‘æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒå‘å¿«æ…¢æŒ‡é’ˆå®ç°å…ƒç´ äº¤æ¢ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quicksort</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(left, right)</span>:</span></span><br><span class="line">            <span class="comment"># right - left &lt; 1</span></span><br><span class="line">            <span class="keyword">if</span> left &gt;= right:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸º pivot</span></span><br><span class="line">            pivot_index = random.randint(left, right)</span><br><span class="line">            pivot = nums[pivot_index]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 1. å°†ä¸­ä½æ•°ä¸æœ«å°¾æ•°äº¤æ¢ï¼Œä¾¿äºæ“ä½œ</span></span><br><span class="line">            nums[pivot_index], nums[right] = nums[right], nums[pivot_index]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 2. ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå°†æ‰€æœ‰å°äºä¸­ä½æ•°çš„å…ƒç´ ç§»åŠ¨åˆ°å·¦è¾¹</span></span><br><span class="line">            store_index = left</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(left, right):</span><br><span class="line">                <span class="keyword">if</span> nums[i] &lt;= pivot:</span><br><span class="line">                    nums[store_index], nums[i] = nums[i], nums[store_index]</span><br><span class="line">                    store_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 3. store_index ä½ç½®å…ƒç´ è‚¯å®šå¤§äºç­‰äº pivotï¼Œæ‰€ä»¥äº¤æ¢</span></span><br><span class="line">            nums[right], nums[store_index] = nums[store_index], nums[right]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å› ä¸º pivot åœ¨ä¸­é—´ï¼Œæ‰€ä»¥å‡ 1</span></span><br><span class="line">            quick_sort(left, store_index - <span class="number">1</span>)</span><br><span class="line">            <span class="comment"># å› ä¸º pivot åœ¨ä¸­é—´ï¼Œæ‰€ä»¥åŠ  1</span></span><br><span class="line">            quick_sort(store_index + <span class="number">1</span>, right)</span><br><span class="line"></span><br><span class="line">        quick_sort(<span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æ’åºè¿‡ç¨‹ï¼š</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[<span class="number">6</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">2</span>  <span class="number">4</span>]</span><br><span class="line"> â†‘â†‘                   ^</span><br><span class="line">[<span class="number">6</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">2</span>  <span class="number">4</span>]</span><br><span class="line"> â†‘     â†‘              ^</span><br><span class="line">[<span class="number">3</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">2</span>  <span class="number">4</span>]</span><br><span class="line">    â†‘     â†‘           ^</span><br><span class="line">[<span class="number">3</span>  <span class="number">1</span>  <span class="number">6</span>  <span class="number">5</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">2</span>  <span class="number">4</span>]</span><br><span class="line">       â†‘           â†‘  ^</span><br><span class="line">[<span class="number">3</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">4</span>]</span><br><span class="line">          â†‘           ^</span><br><span class="line">[<span class="number">3</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br><span class="line">          ^     </span><br><span class="line">[<span class="number">3</span>  <span class="number">1</span>  <span class="number">2</span>][<span class="number">4</span>][<span class="number">8</span>  <span class="number">7</span>  <span class="number">6</span>  <span class="number">5</span>]</span><br></pre></td></tr></table></figure><p>éšæœºé€‰æ‹©å¯ä»¥å¢åŠ æ¯æ¬¡é€‰æ‹©çš„åŸºå‡†å€¼ä¸ºä¸­ä½æ•°çš„å‡ ç‡</p><h2 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h2><h3 id="æœ€åæ—¶é—´å¤æ‚åº¦"><a href="#æœ€åæ—¶é—´å¤æ‚åº¦" class="headerlink" title="æœ€åæ—¶é—´å¤æ‚åº¦"></a>æœ€åæ—¶é—´å¤æ‚åº¦</h3><p>æ¯æ¬¡åŸºå‡†å€¼éƒ½æ˜¯æœ€å¤§ ï¼ˆæˆ–æœ€å°ï¼‰å€¼æ—¶ï¼Œæ‰€éœ€é€’å½’æ¬¡æ•°æœ€å¤šï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>æ•°ç»„æœ‰åºæ—¶ï¼Œæ¯æ¬¡ä½¿ç”¨æœ€å 1 ä½ï¼ˆæˆ–ç¬¬ 1 ä½ï¼‰ä½œä¸ºåŸºå‡†å€¼</li></ol><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">                      ^</span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span> [<span class="number">8</span>]</span><br><span class="line">                   ^</span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span> [<span class="number">7</span>]</span><br><span class="line">                ^</span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span> [<span class="number">6</span>]</span><br><span class="line">             ^  </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span> [<span class="number">5</span>]</span><br><span class="line">          ^  </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span> [<span class="number">4</span>]</span><br><span class="line">       ^  </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span> [<span class="number">3</span>]</span><br><span class="line">    ^ </span><br><span class="line"> <span class="number">1</span> [<span class="number">2</span>]</span><br><span class="line"> ^ </span><br><span class="line">[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><ol start="2"><li>éšæœºé€‰æ‹©æ—¶ï¼Œæ¯æ¬¡é€‰æ‹©åˆ°æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰çš„ä¸€ä½</li></ol><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"> <span class="number">6</span>  <span class="number">7</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span></span><br><span class="line">             ^</span><br><span class="line"> <span class="number">6</span>  <span class="number">7</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span> [<span class="number">8</span>]</span><br><span class="line">    ^         </span><br><span class="line"> <span class="number">6</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span> [<span class="number">7</span>] <span class="number">8</span></span><br><span class="line"> ^ </span><br><span class="line"> <span class="number">3</span>  <span class="number">4</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span> [<span class="number">6</span>] <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">             ^ </span><br><span class="line"> <span class="number">3</span>  <span class="number">4</span>  <span class="number">1</span>  <span class="number">2</span> [<span class="number">5</span>] <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">    ^ </span><br><span class="line"> <span class="number">3</span>  <span class="number">1</span>  <span class="number">2</span> [<span class="number">4</span>] <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line"> ^</span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span> [<span class="number">3</span>] <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">    ^</span><br><span class="line"> <span class="number">1</span> [<span class="number">2</span>] <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line"> ^</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é€’å½’æ¬¡æ•°ä¸º n + 1ï¼Œå¹³å‡æ¯æ¬¡æ’åº  &frac12; n ä¸ªæ•°ã€‚æ‰€ä»¥æœ€åæ—¶é—´å¤æ‚åº¦ï¼šO(n^2)ã€‚</p><h3 id="æœ€å¥½æ—¶é—´å¤æ‚åº¦"><a href="#æœ€å¥½æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æœ€å¥½æ—¶é—´å¤æ‚åº¦"></a>æœ€å¥½æ—¶é—´å¤æ‚åº¦</h3><p>å¦‚æœæ¯æ¬¡é€‰æ‹©ä¸­ä½æ•°ä½œä¸ºåŸºå‡†å€¼ï¼Œé€’å½’æ¬¡æ•°ä¼šå‡å°‘ä¹ˆï¼Ÿå…¶å®ä¸ä¼šå‡å°‘ï¼Œä½†é€’å½’ä¸­éå†çš„æ¬¡æ•°ä¼šå‡å°‘ã€‚å¦‚æœæ¯å±‚éå†çœ‹æˆ n æ¬¡çš„è¯ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è¿™ä¸ªå›¾è¡¨ç¤ºï¼š</p><!--[å›¾ç‰‡æ¥è‡ªã€Šç®—æ³•å›¾è§£ã€‹](https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-18-124518.png)--><p><figure>  <img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-18-124518.png" alt="å›¾ç‰‡æ¥è‡ªã€Šç®—æ³•å›¾è§£ã€‹">  <figcaption style="text-align: center">å›¾ç‰‡æ¥è‡ªã€Šç®—æ³•å›¾è§£ã€‹</figcaption></figure></p><p>æ‰€ä»¥æœ€å¥½æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n * log n)</p><h3 id="å¹³å‡æ—¶é—´å¤æ‚åº¦"><a href="#å¹³å‡æ—¶é—´å¤æ‚åº¦" class="headerlink" title="å¹³å‡æ—¶é—´å¤æ‚åº¦"></a>å¹³å‡æ—¶é—´å¤æ‚åº¦</h3><p>æœ€åæ—¶é—´å¤æ‚åº¦çš„æƒ…å†µå¾ˆå°‘è§ï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯æœ€å¥½æ—¶é—´å¤æ‚åº¦ O(n * log n)</p><h2 id="ç©ºé—´å¤æ‚åº¦"><a href="#ç©ºé—´å¤æ‚åº¦" class="headerlink" title="ç©ºé—´å¤æ‚åº¦"></a>ç©ºé—´å¤æ‚åº¦</h2><p>æ¯æ¬¡é€’å½’å‡ä¼šä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦è·Ÿé€’å½’æ¬¡æ•°æœ‰å…³ã€‚</p><p>æœ€åæ—¶é—´å¤æ‚åº¦æ—¶ï¼Œæœ€åç©ºé—´å¤æ‚åº¦ä¹Ÿä¸º O(n)ã€‚æœ€å¥½æ—¶é—´å¤æ‚åº¦æ—¶æ—¶ï¼Œè™½ç„¶é€’å½’æ²¡æœ‰å‡å°‘ï¼Œä½†å½“åªæœ‰ 1 ä¸ªæˆ– 0 ä¸ªå…ƒç´ æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œç›´æ¥è¿”å›ï¼Œæ‰€ä»¥æœ€å¥½ç©ºé—´å¤æ‚åº¦ä¸º O(log n)ã€‚å¹³å‡æ—¶é—´å¤æ‚åº¦ä¹Ÿä¸º O(log n)ã€‚</p><p>ç¬¬ 1 ç§å®ç°å› ä¸ºä½¿ç”¨é¢å¤–æ•°ç»„ï¼Œæœ€åç©ºé—´å¤æ‚åº¦ä¸º O(n^2)ï¼Œæœ€å¥½ç©ºé—´å¤æ‚åº¦ä¸º O(n * log n)ï¼Œ</p><h2 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># nums = [3, 2, 1, 5, 6, 4]</span></span><br><span class="line">    <span class="comment"># é’ˆå¯¹ç¬¬ 1 ç§</span></span><br><span class="line">    print(Solution().quicksort(nums))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é’ˆå¯¹ç¬¬ 2ã€3 ç§</span></span><br><span class="line">    <span class="comment"># Solution().quicksort(nums)</span></span><br><span class="line">    <span class="comment"># print(nums)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">[]</span><br></pre></td></tr></table></figure><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="https://en.wikipedia.org/wiki/Quicksort" target="_blank" rel="noopener">Quicksort</a></li><li><a href="https://zh.wikipedia.org/wiki/ä¸­ä½æ•¸" target="_blank" rel="noopener">ä¸­ä½æ•°</a></li><li><a href="http://en.wikipedia.org/wiki/Pivot_element" target="_blank" rel="noopener">Pivot element</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/06/18/several-implementations-of-quick-sort/#disqus_thread</comments>
    </item>
    
    <item>
      <title>å¦‚ä½•æŸ¥æ‰¾æŸä¸ªç½‘ç«™çš„ï¼ˆå¦‚ï¼šæœ‰é“äº‘ç¬”è®°ï¼‰çš„æ¥å£</title>
      <link>https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/</link>
      <guid>https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/</guid>
      <pubDate>Thu, 11 Jun 2020 20:48:37 GMT</pubDate>
      <description>
      
        &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;https://depp.wang&quot;&gt;DeppWang&lt;/a&gt;ã€&lt;a href=&quot;https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¼€å‘äº†ä¸ª ã€Šä¸€é”®å¯¼å‡º / å¤‡ä»½ã€Œæœ‰é“äº‘ç¬”è®°ã€æ‰€æœ‰ç¬”è®°ã€‹çš„&lt;a href=&quot;https://github.com/DeppWang/youdaonote-pull&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è„šæœ¬&lt;/a&gt;ã€‚ä¸»è¦åŸç†æ˜¯åˆ©ç”¨æœ‰é“äº‘ç¬”è®°æœ¬èº«çš„æ¥å£ã€‚ä¸‹é¢æ˜¯æ ¹æ®æ­£å¸¸ç”¨æˆ·æ“ä½œé€»è¾‘ï¼Œæ‰¾åˆ°éœ€è¦çš„æ¥å£ï¼Œä¸»è¦æ˜¯ç™»å½•å’Œã€Œä¸‹è½½ã€ã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>ä½œè€…ï¼š<a href="https://depp.wang">DeppWang</a>ã€<a href="https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com">åŸæ–‡åœ°å€</a></p></blockquote><p>å¼€å‘äº†ä¸ª ã€Šä¸€é”®å¯¼å‡º / å¤‡ä»½ã€Œæœ‰é“äº‘ç¬”è®°ã€æ‰€æœ‰ç¬”è®°ã€‹çš„<a href="https://github.com/DeppWang/youdaonote-pull" target="_blank" rel="noopener">è„šæœ¬</a>ã€‚ä¸»è¦åŸç†æ˜¯åˆ©ç”¨æœ‰é“äº‘ç¬”è®°æœ¬èº«çš„æ¥å£ã€‚ä¸‹é¢æ˜¯æ ¹æ®æ­£å¸¸ç”¨æˆ·æ“ä½œé€»è¾‘ï¼Œæ‰¾åˆ°éœ€è¦çš„æ¥å£ï¼Œä¸»è¦æ˜¯ç™»å½•å’Œã€Œä¸‹è½½ã€ã€‚</p><a id="more"></a><h2 id="ä¸€ã€ç™»å½•"><a href="#ä¸€ã€ç™»å½•" class="headerlink" title="ä¸€ã€ç™»å½•"></a>ä¸€ã€ç™»å½•</h2><p>ç™»å½•çš„ç›®çš„æ˜¯è·å– Cookie</p><h3 id="1-1-æ‰¾ç™»å½•æ¥å£"><a href="#1-1-æ‰¾ç™»å½•æ¥å£" class="headerlink" title="1.1 æ‰¾ç™»å½•æ¥å£"></a>1.1 æ‰¾ç™»å½•æ¥å£</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-150019.png" alt="image-20200610230018739" style="zoom:50%;"></p><p>æ¥å£åº”è¯¥åœ¨ç™»å½•æ—¶æ‰§è¡Œã€‚ä½¿ç”¨<strong>é”™è¯¯å¯†ç </strong>æµ‹è¯•ï¼Œå¯å¾—åˆ°ç™»å½• post è¯·æ±‚æ¥å£ã€‚æ³¨æ„è¿‡æ»¤æ¡ä»¶æ˜¯ <strong>All</strong></p><figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">https://note.youdao.com/login/acc/urs/verify/<span class="meta">check</span>?app=web<span class="variable">&amp;product</span>=YNOTE<span class="variable">&amp;tp</span>=urstoken<span class="variable">&amp;cf</span>=6<span class="variable">&amp;fr</span>=1<span class="variable">&amp;systemName</span>=<span class="variable">&amp;deviceType</span>=<span class="variable">&amp;ru</span>=</span><br><span class="line">https://note.youdao.com/signIn//loginCallback.html<span class="variable">&amp;er</span>=</span><br><span class="line">https://note.youdao.com/signIn//loginCallback.html&amp;</span><br><span class="line">vcode=dman9<span class="variable">&amp;systemName</span>=mac<span class="variable">&amp;deviceType</span>=MacPC<span class="variable">&amp;timestamp</span>=1591770253472</span><br></pre></td></tr></table></figure><h3 id="1-2-æ¨å¯¼å¯†ç åŠ å¯†è§„åˆ™"><a href="#1-2-æ¨å¯¼å¯†ç åŠ å¯†è§„åˆ™" class="headerlink" title="1.2 æ¨å¯¼å¯†ç åŠ å¯†è§„åˆ™"></a>1.2 æ¨å¯¼å¯†ç åŠ å¯†è§„åˆ™</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-062936.png" alt="image-20200610142935436"></p><p>æœ¬åœ°æµ‹è¯•ä½¿ç”¨åŒæ ·é”™è¯¯å¯†ç ç”¨ä¸åŒåŠ å¯†ç®—æ³•åŠ å¯†ï¼Œçœ‹åŠ å¯†ç»“æœæ˜¯å¦ä¸€è‡´</p><p>å‘ç°ä½¿ç”¨ md5 åŠ å¯†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Python3</span></span><br><span class="line">password=hashlib.md5(password.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br></pre></td></tr></table></figure><h3 id="1-3-æ‰¾è¿”å›éªŒè¯ç™»å½•çŠ¶æ€-Cookie-çš„æ¥å£"><a href="#1-3-æ‰¾è¿”å›éªŒè¯ç™»å½•çŠ¶æ€-Cookie-çš„æ¥å£" class="headerlink" title="1.3 æ‰¾è¿”å›éªŒè¯ç™»å½•çŠ¶æ€ Cookie çš„æ¥å£"></a>1.3 æ‰¾è¿”å›éªŒè¯ç™»å½•çŠ¶æ€ Cookie çš„æ¥å£</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-091312.png" alt="image-20200610171312277" style="zoom:50%;"></p><p>ç™»å½•æˆåŠŸåï¼Œä¼šè¿”å›éªŒè¯ç™»å½•çŠ¶æ€çš„ Cookieã€‚æ¥å£åº”è¯¥åœ¨ç™»å½•æˆåŠŸåæ‰§è¡Œã€‚å‘ç°è·³è½¬é¦–é¡µåç¬¬ä¸€ä¸ª XHR æ¥å£ä¸­åŒ…å«éªŒè¯ç™»å½•çŠ¶æ€çš„ Cookieï¼ŒYNOTE_CSTK</p><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">https://note.youdao.com/yws/mapi/<span class="keyword">user</span>?<span class="keyword">method</span>=<span class="keyword">get</span>&amp;multilevelEnable=<span class="keyword">true</span></span><br></pre></td></tr></table></figure><!--åªéœ€è¦æœ‰ YNOTE_CSTK å’Œ YNOTE_SESS ä¸¤ä¸ªå³å¯ç™»å½•ï¼Œä¸¤ä¸ªéƒ½éœ€è¦ç™»å½•æˆåŠŸåçš„å€¼ï¼Œä¸ä¸€å®šè¦ä¸€èµ·è¿”å›çš„ã€‚åªæš´éœ² YNOTE_CSTK ä¸ç”¨æ‹…å¿ƒè´¦å·è¢«ç™»å½•--><h2 id="äºŒã€ã€Œä¸‹è½½ã€"><a href="#äºŒã€ã€Œä¸‹è½½ã€" class="headerlink" title="äºŒã€ã€Œä¸‹è½½ã€"></a>äºŒã€ã€Œä¸‹è½½ã€</h2><h3 id="2-1-æ‰¾è¿”å›æ ¹ç›®å½•-id-çš„æ¥å£"><a href="#2-1-æ‰¾è¿”å›æ ¹ç›®å½•-id-çš„æ¥å£" class="headerlink" title="2.1 æ‰¾è¿”å›æ ¹ç›®å½• id çš„æ¥å£"></a>2.1 æ‰¾è¿”å›æ ¹ç›®å½• id çš„æ¥å£</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-11-054205.png" alt="image-20200611134205218" style="zoom:50%;"></p><p>æˆ‘ä»¬æ ¹æ®ä¸€ä¸ªç¬”è®° URL å¯ä»¥çœ‹å‡ºï¼ŒURL é‡ŒåŒ…å«äº†çˆ¶æ–‡ä»¶å¤¹ id å’Œå½“å‰æ–‡ä»¶ idã€‚ã€Œæˆ‘çš„æ–‡ä»¶å¤¹ã€ä¸‹çš„ test.md çš„ URLï¼š</p><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/note.youdao.com/web</span><span class="regexp">/#/file</span><span class="regexp">/F83DF1ADA69344D194C7CE861D09B1A1/note</span><span class="regexp">/WEB4aa8bf8074d61befea1dd20f5593f01c/</span></span><br></pre></td></tr></table></figure><p>ã€Œæˆ‘çš„æ–‡ä»¶å¤¹ã€ æ˜¯æ ¹ç›®å½•ï¼Œå®ƒçš„ id æ˜¯ <code>F83DF1ADA69344D194C7CE861D09B1A1</code>ï¼Œä¸‹é¢ç§°å®ƒä¸º root_idã€‚</p><p>æˆ‘ä»¬æ¨æµ‹ï¼Œæœ‰é“äº‘ç¬”è®°æ˜¯è®¾è®¡æ˜¯æ ¹æ®æ–‡ä»¶å¤¹ idï¼Œè·å–æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼ˆæ‰“å¼€æ–‡ä»¶å¤¹ï¼Œå¯çœ‹åˆ°æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¾—åˆ° root_idã€‚å½“ç™»å½•æˆåŠŸåï¼Œè·³è½¬åˆ°é¦–é¡µæ—¶ï¼Œåº”è¯¥æœ‰æ¥å£èƒ½å¾—åˆ° root_idã€‚</p><p>æµ‹è¯•å‘ç°ä¸‹é¢æ¥å£è¿”å›å€¼åŒ…å« root_idï¼š</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>note.youdao.com<span class="regexp">/yws/</span>api<span class="regexp">/personal/</span>file?method=getByPath&amp;keyfrom=web&amp;cstk=<span class="number">01</span>PvSwwu</span><br></pre></td></tr></table></figure><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-11-070108.png" alt="image-20200611150107522" style="zoom:50%;"></p><p>æ¥å£è¿”å›æ ¼å¼ç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"fileEntry"</span>:&#123;</span><br><span class="line">        <span class="attr">"userId"</span>:<span class="string">"m17191082115@163.com"</span>,</span><br><span class="line">        "id":"F83DF1ADA69344D194C7CE861D09B1A1", // root_id</span><br><span class="line">        "version":22888,</span><br><span class="line">        "name":"ROOT",</span><br><span class="line">        "parentId":"0",</span><br><span class="line">        "createTimeForSort":1497860357,</span><br><span class="line">        "modifyTimeForSort":1497860357,</span><br><span class="line">        ....</span><br><span class="line">    &#125;,</span><br><span class="line">    "fileMeta":&#123;</span><br><span class="line">        "chunkList":"None",</span><br><span class="line">        "sharedCount":0,</span><br><span class="line">        "title":"ROOT",</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">root_id = response.content[<span class="string">'fileEntry'</span>][<span class="string">'id'</span>]</span><br></pre></td></tr></table></figure><h3 id="2-2-æ‰¾è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„æ¥å£"><a href="#2-2-æ‰¾è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„æ¥å£" class="headerlink" title="2.2 æ‰¾è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„æ¥å£"></a>2.2 æ‰¾è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„æ¥å£</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-11-052343.png" alt="image-20200611132342543" style="zoom:50%;"></p><p>æœ‰äº† root_idï¼Œéœ€è¦æ‰¾åˆ°æ ¹æ® id è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„æ¥å£ã€‚</p><p>æ¥å£åº”è¯¥åœ¨æ‰“å¼€æ–‡ä»¶å¤¹æ—¶æ‰§è¡Œã€‚ç‚¹å‡»æŸä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæµ‹è¯•å‘ç°åŒ…å«å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„æ¥å£ä¸ºï¼š</p><figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">https://note.youdao.com/yws/api/personal/<span class="meta">file</span>/9d8a2385eeec77338211b4f04bbf844d?all=true<span class="variable">&amp;f</span>=true<span class="variable">&amp;len</span>=30<span class="variable">&amp;sort</span>=1<span class="variable">&amp;isReverse</span>=false<span class="variable">&amp;method</span>=listPageByParentId<span class="variable">&amp;keyfrom</span>=web<span class="variable">&amp;cstk</span>=01PvSwwu</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›æ ¼å¼è·Ÿä¸Šé¢å·®ä¸å¤šï¼Œåªæ˜¯æ•°é‡æ›´å¤šï¼Œå±æ€§å¤šäº† parentIdï¼ˆçˆ¶æ–‡ä»¶å¤¹ idï¼‰ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"fileEntry"</span>:&#123;</span><br><span class="line">            <span class="attr">"userId"</span>:<span class="string">"m17191082115@163.com"</span>,</span><br><span class="line">            <span class="attr">"id"</span>:<span class="string">"9d8a2385eeec77338211b4f04bbf844d"</span>,</span><br><span class="line">            <span class="attr">"version"</span>:<span class="number">14168</span>,</span><br><span class="line">            <span class="attr">"name"</span>:<span class="string">"æ¥è‡ªæ‰‹æœº"</span>,</span><br><span class="line">            "parentId":"F83DF1ADA69344D194C7CE861D09B1A1", // çˆ¶æ–‡ä»¶å¤¹çš„ idï¼Œæ­¤æ—¶æ˜¯ root_id</span><br><span class="line">            "createTimeForSort":1550712995,</span><br><span class="line">            "modifyTimeForSort":1550713003,</span><br><span class="line">            ....</span><br><span class="line">        &#125;,</span><br><span class="line">        "fileMeta":&#123;</span><br><span class="line">            "chunkList":null,</span><br><span class="line">            "sharedCount":0,</span><br><span class="line">            "title":"æ¥è‡ªæ‰‹æœº",</span><br><span class="line">            "fileSize":0,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="2-3-æ‰¾åˆ°è·å–æ–‡ä»¶å†…å®¹çš„æ¥å£"><a href="#2-3-æ‰¾åˆ°è·å–æ–‡ä»¶å†…å®¹çš„æ¥å£" class="headerlink" title="2.3 æ‰¾åˆ°è·å–æ–‡ä»¶å†…å®¹çš„æ¥å£"></a>2.3 æ‰¾åˆ°è·å–æ–‡ä»¶å†…å®¹çš„æ¥å£</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-095111.png" alt="image-20200610175111568" style="zoom:50%;"></p><p>é€šè¿‡æ–‡ä»¶å¤¹ id å¾—åˆ°äº†æ–‡ä»¶ idï¼ˆfileIdï¼‰ï¼Œéœ€è¦æ‰¾åˆ°æ ¹æ® fileId è·å–æ–‡ä»¶å†…å®¹çš„æ¥å£ã€‚</p><p>æ¥å£åº”è¯¥åœ¨ç‚¹å‡»ç¬”è®°æ ‡é¢˜å¾—åˆ°ç¬”è®°å†…å®¹æ—¶æ‰§è¡Œã€‚ç‚¹å‡»æŸä¸€ç¯‡ç¬”è®°æ ‡é¢˜ï¼Œå¯ä»¥æ‰¾åˆ°è·å–æ–‡ä»¶å†…å®¹çš„æ¥å£ï¼š</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>note.youdao.com<span class="regexp">/yws/</span>api<span class="regexp">/personal/</span>sync?method=download&amp;keyfrom=web&amp;cstk=<span class="number">01</span>PvSwwu</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œ"><a href="#ä¸‰ã€æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œ" class="headerlink" title="ä¸‰ã€æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œ"></a>ä¸‰ã€æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œ</h2><h3 id="3-1-è®¾ç½®è¯·æ±‚å¤´"><a href="#3-1-è®¾ç½®è¯·æ±‚å¤´" class="headerlink" title="3.1 è®¾ç½®è¯·æ±‚å¤´"></a>3.1 è®¾ç½®è¯·æ±‚å¤´</h3><p>éšä¾¿å“ªä¸ªé¡µé¢ï¼ˆå¦‚ï¼šé¦–é¡µ <code>https://note.youdao.com/</code>ï¼‰å¯ä»¥çœ‹åˆ°è¯·æ±‚å¤´åŒ…å«ä¸‹é¢è¿™äº›å†…å®¹ï¼š</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-102800.png" alt="image-20200610182800122" style="zoom:50%;"></p><p>å–ä¸€éƒ¨åˆ†è®¾ç½®å³å¯</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YoudaoNoteSession</span><span class="params">(requests.Session)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Accept'</span>: <span class="string">'*/*'</span>,</span><br><span class="line">            <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate, br'</span>,</span><br><span class="line">            <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8'</span>,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ¨¡æ‹Ÿã€Œè¿›å…¥ç½‘é¡µç‰ˆã€"><a href="#3-2-æ¨¡æ‹Ÿã€Œè¿›å…¥ç½‘é¡µç‰ˆã€" class="headerlink" title="3.2 æ¨¡æ‹Ÿã€Œè¿›å…¥ç½‘é¡µç‰ˆã€"></a>3.2 æ¨¡æ‹Ÿã€Œè¿›å…¥ç½‘é¡µç‰ˆã€</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-113424.png" alt="image-20200610193423993" style="zoom: 50%;"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.get(<span class="string">'https://note.youdao.com/web/'</span>)</span><br></pre></td></tr></table></figure><p>ç‚¹å‡»ã€Œè¿›å…¥ç½‘é¡µç‰ˆã€ï¼Œä¼šé‡å®šå‘åˆ°ç™»å½•é¡µé¢</p><h3 id="3-3-æ¨¡æ‹Ÿæ‰“å¼€ç™»å½•é¡µ"><a href="#3-3-æ¨¡æ‹Ÿæ‰“å¼€ç™»å½•é¡µ" class="headerlink" title="3.3 æ¨¡æ‹Ÿæ‰“å¼€ç™»å½•é¡µ"></a>3.3 æ¨¡æ‹Ÿæ‰“å¼€ç™»å½•é¡µ</h3><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-10-060620.png" alt="image-20200610140619564" style="zoom: 67%;"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.get(<span class="string">'https://note.youdao.com/signIn/index.html?&amp;callback=https%3A%2F%2Fnote.youdao.com%2Fweb%2F&amp;from=web'</span>)</span><br></pre></td></tr></table></figure><p>è·³è½¬ç™»å½•é¡µåï¼Œè¦æ‰§è¡Œä¸‹é¢ 3 ä¸ªæ¥å£ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.get(<span class="string">'https://note.youdao.com/login/acc/pe/getsess?product=YNOTE&amp;_='</span> + timestamp())</span><br><span class="line">self.get(<span class="string">'https://note.youdao.com/auth/cq.json?app=web&amp;_='</span> + timestamp())</span><br><span class="line">self.get(<span class="string">'https://note.youdao.com/auth/urs/login.json?app=web&amp;_='</span> + timestamp())</span><br></pre></td></tr></table></figure><h2 id="å››ã€ç»“è¯­"><a href="#å››ã€ç»“è¯­" class="headerlink" title="å››ã€ç»“è¯­"></a>å››ã€ç»“è¯­</h2><p>æ ¹æ®æ‰¾åˆ°çš„æ¥å£ï¼Œæ¨¡æ‹Ÿç”¨æˆ·æ“ä½œä¹Ÿæœ‰ä¸å°‘åº”ç”¨åœºæ™¯ã€‚é™¤äº†å¼€å‘åƒè¿™ç§å¯¼å‡ºæ–‡ä»¶çš„è„šæœ¬ï¼Œå¯ä»¥å¼€å‘ä¸€åˆ‡ä½ æƒ³è‡ªåŠ¨åŒ–æ‰§è¡Œçš„æ“ä½œã€‚æ¯”æ–¹ cnblogsã€juejin å‘æ–‡ç« ç­‰ã€‚æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯åƒä¸Šé¢è¿™æ ·æ‰¾æ¥å£äº†ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰äººæœ‰è¿‡æ€»ç»“ã€‚</p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸€äº›æµè§ˆå™¨çš„ APIï¼Œå¦‚ <a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener">Puppeteer</a>ï¼Œå®ƒæä¾›ä¸€ä¸ªçœŸå®çš„æµè§ˆå™¨ç¯å¢ƒï¼Œå¯ä»¥çœŸæ­£æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œï¼Œä¸éœ€è¦æ‰¾åˆ°æ‰€æœ‰æ¥å£ï¼Œåªéœ€è¦è®¾ç½®ç½‘é¡µ urlï¼Œä»¥åŠè®¾ç½®éœ€è¦æ“ä½œçš„ã€ŒæŒ‰é’®ã€å±æ€§ã€‚å› ä¸ºæä¾›æµè§ˆå™¨ç¯å¢ƒï¼Œå®ƒå±äºé‡é‡çº§æ“ä½œã€‚å¯ä»¥çœ‹çœ‹ <a href="https://github.com/crawlab-team/artipub" target="_blank" rel="noopener">ArtiPub</a> å¦‚ä½•ä½¿ç”¨ Puppeteerã€‚è¿™ç§æ–¹å¼æœ‰ç‚¹ä¸å¥½çš„åœ°æ–¹å°±æ˜¯å¹³å°å¯èƒ½æ”¹å‰ç«¯å±æ€§ï¼Œéœ€è¦æ³¨æ„æ›´æ–°ã€‚</p><!--æœ‰ä»€ä¹ˆä¸æ˜ç™½çš„çœ‹çœ‹[æºç ](http://github.com/DeppWang/youdaonote-pull/blob/master/pull.py)å°±çŸ¥é“äº†ã€‚--><p>å…¨æ–‡å®Œã€‚</p><!--cnblogs.com å‘å¸ƒæ–‡ç« æ˜¯ç”¨ i.cnblogs.com/api/posts æ¥å£ã€‚æ‰€ä»¥ ArtiPub æ²¡æœ‰æ¥å£ï¼Ÿ-->]]></content:encoded>
      
      <comments>https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com/#disqus_thread</comments>
    </item>
    
    <item>
      <title>iTranswarp éƒ¨ç½²è®°å½•</title>
      <link>https://depp.wang/2020/05/26/itranswarp-deploy-record/</link>
      <guid>https://depp.wang/2020/05/26/itranswarp-deploy-record/</guid>
      <pubDate>Tue, 26 May 2020 17:58:35 GMT</pubDate>
      <description>
      
        &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;https://depp.wang&quot;&gt;DeppWang&lt;/a&gt;ã€&lt;a href=&quot;https://depp.wang/2020/05/26/itranswarp-deploy-record/&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç›®çš„ï¼šä½¿ç”¨ &lt;a href=&quot;https://github.com/michaelliao/itranswarp&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;iTranswarp&lt;/a&gt; å­¦ä¹  nginx é…ç½®&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åªæƒ³æœ¬åœ°å¯åŠ¨ï¼Œç›´æ¥ä¿®æ”¹ ipï¼Œä½¿ç”¨ docker-compose å³å¯&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>ä½œè€…ï¼š<a href="https://depp.wang">DeppWang</a>ã€<a href="https://depp.wang/2020/05/26/itranswarp-deploy-record/">åŸæ–‡åœ°å€</a></p><p>ç›®çš„ï¼šä½¿ç”¨ <a href="https://github.com/michaelliao/itranswarp" target="_blank" rel="noopener">iTranswarp</a> å­¦ä¹  nginx é…ç½®</p><p>å¦‚æœä½ åªæƒ³æœ¬åœ°å¯åŠ¨ï¼Œç›´æ¥ä¿®æ”¹ ipï¼Œä½¿ç”¨ docker-compose å³å¯</p><a id="more"></a><h2 id="Google-Cloud-Platform-é…ç½®"><a href="#Google-Cloud-Platform-é…ç½®" class="headerlink" title="Google Cloud Platform é…ç½®"></a>Google Cloud Platform é…ç½®</h2><p>æœ¬åœ°éƒ¨ç½²è€—èµ„æºï¼ŒæœåŠ¡å™¨éƒ¨ç½²</p><p>è…¾è®¯äº‘ clone GitHub é¡¹ç›®å¤ªæ…¢ï¼Œä½¿ç”¨ <a href="https://console.cloud.google.com/" target="_blank" rel="noopener">Google Cloud Platform</a>ï¼Œæ‹›å•†é“¶è¡Œå›½é™…ä¿¡ç”¨å¡æ³¨å†Œ</p><p>Compute Engine æ–°å»ºã€Œè™šæ‹Ÿæœºå®ä¾‹ã€ CentOS7</p><p>å®ä¾‹é…ç½®ï¼ˆé˜²ç«å¢™ï¼‰å…¥ç«™ç«¯å£</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span> tcp:<span class="number">13306</span>,<span class="number">16379</span>,<span class="number">443</span>,<span class="number">80</span></span><br></pre></td></tr></table></figure><p>ã€Œå…ƒæ•°æ®ã€æ·»åŠ å…¬é’¥ id_rsa.pubï¼Œä½¿ç”¨ SSH å…¬é’¥ç™»å½•ï¼ŒåŸç†è¯·çœ‹<a href="https://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html" target="_blank" rel="noopener">SSH åŸç†ä¸è¿ç”¨ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç™»å½•</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh -i ~/.ssh/id_rsa(ç§é’¥) your_user_name@ip</span><br><span class="line"></span><br><span class="line">ssh -i ~/.ssh/id_rsa_4 deppwxq@35.201.176.108 # ç¤ºä¾‹</span><br></pre></td></tr></table></figure><p>å®‰è£… Gitã€é…ç½®åˆ«å</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install git-core</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global alias.st status</span><br><span class="line">git config --global alias.co checkout</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.unstage <span class="string">'reset HEAD'</span></span><br><span class="line">git config --global alias.last <span class="string">'log -1'</span></span><br><span class="line">git config --global alias.lg <span class="string">"log --color --graph --pretty=format:'% Cred% h% Creset -% C(yellow)% d% Creset % s % Cgreen(% cr) % C(bold blue)&lt;% an&gt;% Creset' --abbrev-commit"</span></span><br></pre></td></tr></table></figure><p>åˆ‡æ¢ä¸º ohmyzshï¼ˆä¸ªäººä¹ æƒ¯ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum update &amp;&amp; sudo yum -y install zsh</span><br><span class="line">sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢ zsh å¤±è´¥æ—¶ï¼Œé‡æ–°åˆ‡æ¢</span></span><br><span class="line">sudo chsh -s /bin/zsh your_user_name</span><br><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure><ul><li>å¯èƒ½éœ€è¦è¾“å…¥ç”¨æˆ·å¯†ç ï¼Œç”¨æˆ·å¯†ç ä¸º Google è´¦å·å¯†ç </li><li>æœªç”Ÿæ•ˆæ—¶é‡å¯å®ä¾‹ï¼Œé‡å¯ ip ä¼šå˜ï¼</li></ul><p>è¯­è¨€è®¾ç½®ä¸ºè‹±æ–‡ï¼ˆé»˜è®¤å°±æ˜¯è‹±æ–‡ï¼Œä¸ºä½• Git æ˜¾ç¤ºä¸­æ–‡ï¼‰</p><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">localectl</span></span><br></pre></td></tr></table></figure><p>å®‰è£… <a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener">Docker</a>ï¼Œ<a href="https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">Docker æ•™ç¨‹</a></p><p>å®‰è£… <a href="https://docs.docker.com/compose/install/#install-compose" target="_blank" rel="noopener">Docker-Compose</a>ï¼Œ<a href="https://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html" target="_blank" rel="noopener">Docker-Compose æ•™ç¨‹</a></p><p>é‡å¯å®ä¾‹ï¼Œip ä¼šå˜ï¼éœ€è¦é‡å¯ docker daemon</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo<span class="built_in"> service </span>docker start</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡å™¨è¿è¡Œé¡¹ç›®"><a href="#æœåŠ¡å™¨è¿è¡Œé¡¹ç›®" class="headerlink" title="æœåŠ¡å™¨è¿è¡Œé¡¹ç›®"></a>æœåŠ¡å™¨è¿è¡Œé¡¹ç›®</h2><p>å…ˆ fork é¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/your-name/itranswarp.git <span class="comment"># ä½¿ç”¨ HTTPS</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> itranswarp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> docker</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp .env.example .env</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim .env <span class="comment"># ä¿®æ”¹ä¸ºæœåŠ¡å™¨å…¬ç½‘ ip</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose up <span class="comment"># å¯åŠ¨</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose stop <span class="comment"># åœæ­¢</span></span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æœåŠ¡å™¨ hostsï¼Œç›¸å½“äº DNS</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://zh.wikipedia.org/wiki/Lynx" target="_blank" rel="noopener">lynx</a> æ¨¡æ‹ŸæœåŠ¡å™¨æœ¬åœ°æµè§ˆå™¨æ‰“å¼€ <code>https://www.local.itranswarp.com/</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install lynx</span><br><span class="line">lynx https://www.local.itranswarp.com/</span><br></pre></td></tr></table></figure><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-05-25-143614.png" alt="image-20200525223613874"></p><p>è¿œç¨‹è¿æ¥ Redis</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿œç¨‹è¿æ¥</span></span><br><span class="line">redis-cli -h XXX.XXX.XXX.XXX(ip) -p port -a password</span><br><span class="line">redis-cli -h ip -p 16379 -a JFPRJ</span><br></pre></td></tr></table></figure><p>è¿œç¨‹è¿æ¥ Mysql ä½¿ç”¨ Navicat Premium</p><p>è¿›å…¥å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container exec -it [containerId] /bin/bash # å¯åŠ¨å®¹å™¨å®ä¾‹ bash</span><br><span class="line">or</span><br><span class="line">docker exec -it [containerId] /bin/bash</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨è‡ªå®šä¹‰åŸŸå"><a href="#ä½¿ç”¨è‡ªå®šä¹‰åŸŸå" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰åŸŸå"></a>ä½¿ç”¨è‡ªå®šä¹‰åŸŸå</h2><h3 id="é…ç½®åŸŸåè§£æ"><a href="#é…ç½®åŸŸåè§£æ" class="headerlink" title="é…ç½®åŸŸåè§£æ"></a>é…ç½®åŸŸåè§£æ</h3><p>ï¼ˆä¾‹ï¼šä¸‡ç½‘ï¼‰é…ç½®åŸŸåè§£æ</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">A www.xingquan.wang ip</span><br><span class="line">A static.xingquan.wang ip</span><br><span class="line">A source.xingquan.wang ip</span><br><span class="line">A @xingquan.wang ip</span><br></pre></td></tr></table></figure><h3 id="ç”³è¯·æ•°å­—è¯ä¹¦"><a href="#ç”³è¯·æ•°å­—è¯ä¹¦" class="headerlink" title="ç”³è¯·æ•°å­—è¯ä¹¦"></a>ç”³è¯·æ•°å­—è¯ä¹¦</h3><p><a href="https://freessl.org/" target="_blank" rel="noopener">freessl</a> ç”³è¯·å…è´¹æ•°å­—è¯ä¹¦</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">www<span class="selector-class">.xingquan</span><span class="selector-class">.wang</span></span><br><span class="line">static<span class="selector-class">.xingquan</span><span class="selector-class">.wang</span></span><br><span class="line">source<span class="selector-class">.xingquan</span><span class="selector-class">.wang</span></span><br><span class="line">xingquan.wang</span><br></pre></td></tr></table></figure><p>å¯å››ä¸ªåŸŸååŒæ—¶ç”³è¯·åŒä¸€ä¸ªæ•°å­—è¯ä¹¦ï¼Œä¹Ÿå¯åˆ†å¼€ç”³è¯·</p><p>ç¦»çº¿ç”³è¯·ï¼Œä½¿ç”¨ <a href="https://keymanager.org/" target="_blank" rel="noopener">KeyManager</a>ï¼Œæœ€åã€Œå¯¼å‡ºè¯ä¹¦ã€ï¼Œè§£å‹å¯å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>**</code>.crtï¼Œ<code>**</code>.keyã€‚crt ä¸ºæ•°å­—è¯ä¹¦ï¼Œkey ä¸ºæœåŠ¡å™¨ç§é’¥ï¼Œæ·±å…¥ç†è§£è¯·çœ‹<a href="https://mp.weixin.qq.com/s?__biz=MzAxOTc0NzExNg==&mid=2665513779&idx=1&sn=a1de58690ad4f95111e013254a026ca2&chksm=80d67b70b7a1f26697fa1626b3e9830dbdf4857d7a9528d22662f2e43af149265c4fd1b60024&scene=21#wechat_redirect" target="_blank" rel="noopener">ä¸€ä¸ªæ•…äº‹è®²å®Œ https</a></p><h3 id="ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶</h3><p>clone fork é¡¹ç›®åˆ°æœ¬åœ°ï¼Œï¼ˆåˆ‡æ¢åˆ†æ”¯ï¼‰ä¿®æ”¹é…ç½®ã€‚</p><p>å…¨å±€å°† local.itranswarp.com ä¿®æ”¹ä¸ºä½ çš„åŸŸåï¼ˆå¦‚ï¼šxingquan.wangï¼‰</p><p>ä¿®æ”¹ local.itranswarp.com.crt / local.itranswarp.com.key ä¸º xingquan.wang.crtã€xingquan.wang.keyï¼Œä½¿ç”¨ã€Œå¯¼å‡ºè¯ä¹¦ã€çš„ crtã€key æ›¿æ¢ã€‚local-conf æ–‡ä»¶å¤¹ä¸‹å¯ä¸ä¿®æ”¹</p><p>ä¿®æ”¹é…ç½®åï¼Œåªé‡å¯ docker-composeï¼ˆå®¹å™¨ï¼‰ï¼Œé…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Ÿç”Ÿæ•ˆ</p><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><a href="https://www.xingquan.wang" target="_blank" rel="noopener">https://www.xingquan.wang</a></p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-05-26-084417.png" alt="image-20200526164417094" style="zoom:50%;"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­¦ä¹ åˆ°</p><ul><li>HTTPSã€è¯ä¹¦</li><li>nginx é…ç½®</li></ul><p>é—®é¢˜ï¼š</p><ul><li>Docker å¦‚ä½•è¿›å…¥å®¹å™¨æ“ä½œï¼Œå¦‚æŸ¥çœ‹æ—¥å¿—ã€ä¿®æ”¹æ•°æ®åº“</li><li>iTranswarp ä½œä¸ºåšå®¢ï¼Œæ²¡æœ‰è®¢é˜…åœ°å€ï¼Ÿ</li></ul><p>admin é»˜è®¤å¯†ç ä¸º 123456</p>]]></content:encoded>
      
      <comments>https://depp.wang/2020/05/26/itranswarp-deploy-record/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä¸€ä¸ªä¸€é”®å¯¼å‡º/å¤‡ä»½ã€Œæœ‰é“äº‘ç¬”è®°ã€æ‰€æœ‰ç¬”è®°çš„è„šæœ¬</title>
      <link>https://depp.wang/2020/05/18/export-youdaonote-all-notes/</link>
      <guid>https://depp.wang/2020/05/18/export-youdaonote-all-notes/</guid>
      <pubDate>Mon, 18 May 2020 13:26:55 GMT</pubDate>
      <description>
      
        &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;https://depp.wang&quot;&gt;DeppWang&lt;/a&gt;ã€&lt;a href=&quot;https://depp.wang/2020/05/18/export-youdaonote-all-notes/&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å‡ºå‘ç‚¹&quot;&gt;&lt;a href=&quot;#å‡ºå‘ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;å‡ºå‘ç‚¹&quot;&gt;&lt;/a&gt;å‡ºå‘ç‚¹&lt;/h2&gt;&lt;p&gt;åŸæ¥ä¸€ç›´æ˜¯æœ‰é“äº‘ç¬”è®°çš„å¿ å®ç”¨æˆ·ï¼Œåé¢æ¥è§¦åˆ°äº†æ‰€è§å³æ‰€å¾—çš„ &lt;a href=&quot;https://typora.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Typora&lt;/a&gt;ï¼Œæœ‰ç‚¹ç”¨ä¸æƒ¯æœ‰é“äº‘ç¬”è®°äº†ï¼Œæƒ³ç€æœ‰ä»€ä¹ˆæ³•å­èƒ½ç”µè„‘æœ¬åœ°æ–‡ä»¶å’Œæœ‰é“äº‘ç¬”è®°åŒæ­¥ï¼Œè¿™æ ·ç”µè„‘ä½¿ç”¨ Typoraï¼Œæ‰‹æœºä½¿ç”¨æœ‰é“äº‘ç¬”è®°ã€‚å‘ç°æœ‰é“äº‘ç¬”è®°æœ‰ &lt;a href=&quot;http://note.youdao.com/open/developguide.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Open API&lt;/a&gt; ï¼Œæ‰“ç®—åˆ©ç”¨æä¾›çš„ APIï¼Œå†™ä¸¤ä¸ªè„šæœ¬ï¼Œä¸€ä¸ª pull æ‰€æœ‰æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œä¸€ä¸ª push æœ¬åœ°æ–‡ä»¶åˆ°äº‘ç¬”è®°ã€‚ä½† API å¤ªéš¾ç”¨äº†ï¼ŒN å¤šå¹´æ²¡æ›´æ–°äº†ï¼Œé—®å®¢æœä¹Ÿæ²¡æ›´æ–°çš„æ„æ€ï¼Œå¼€å‘åˆ°æœ€åå‘ç°ç«Ÿç„¶æ²¡æœ‰ Markdown æ–‡ä»¶çš„æ¥å£ï¼Œé†‰äº†ã€‚é‚æ”¾å¼ƒã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä½¿ç”¨ Typora + &lt;a href=&quot;https://www.dropbox.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Dropbox&lt;/a&gt; + &lt;a href=&quot;https://www.mweb.im/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MWeb&lt;/a&gt; å®ç°åŒæ­¥ç¬”è®°å’Œæ‰‹æœºæŸ¥çœ‹ç¼–è¾‘çš„åŠŸèƒ½ï¼Œå¾ˆé¦™ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ç»™æœ‹å‹æ¨èæ­¤æ–¹å¼ï¼Œä½†å‘ç°æœ‰é“äº‘ç¬”è®°æœ€æ–°çš„ Mac å®¢æˆ·ç«¯å’Œç½‘é¡µç«¯å»é™¤äº†å¯¼å‡ºæ‰€æœ‰ç¬”è®°çš„åŠŸèƒ½ï¼è¿™æ˜¯ä»€ä¹ˆé€»è¾‘ï¼Œæ€•ç”¨æˆ·è·‘äº†ä¹ˆã€‚æ‰€ä»¥åœ¨åŸæ¥ pull è„šæœ¬çš„åŸºç¡€ä¸Šä¿®æ”¹å¾—åˆ°æ­¤è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;è„šæœ¬åœ°å€ï¼š&lt;a href=&quot;https://github.com/DeppWang/youdaonote-pull&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/DeppWang/youdaonote-pull&lt;/a&gt;&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>ä½œè€…ï¼š<a href="https://depp.wang">DeppWang</a>ã€<a href="https://depp.wang/2020/05/18/export-youdaonote-all-notes/">åŸæ–‡åœ°å€</a></p></blockquote><h2 id="å‡ºå‘ç‚¹"><a href="#å‡ºå‘ç‚¹" class="headerlink" title="å‡ºå‘ç‚¹"></a>å‡ºå‘ç‚¹</h2><p>åŸæ¥ä¸€ç›´æ˜¯æœ‰é“äº‘ç¬”è®°çš„å¿ å®ç”¨æˆ·ï¼Œåé¢æ¥è§¦åˆ°äº†æ‰€è§å³æ‰€å¾—çš„ <a href="https://typora.io/" target="_blank" rel="noopener">Typora</a>ï¼Œæœ‰ç‚¹ç”¨ä¸æƒ¯æœ‰é“äº‘ç¬”è®°äº†ï¼Œæƒ³ç€æœ‰ä»€ä¹ˆæ³•å­èƒ½ç”µè„‘æœ¬åœ°æ–‡ä»¶å’Œæœ‰é“äº‘ç¬”è®°åŒæ­¥ï¼Œè¿™æ ·ç”µè„‘ä½¿ç”¨ Typoraï¼Œæ‰‹æœºä½¿ç”¨æœ‰é“äº‘ç¬”è®°ã€‚å‘ç°æœ‰é“äº‘ç¬”è®°æœ‰ <a href="http://note.youdao.com/open/developguide.html" target="_blank" rel="noopener">Open API</a> ï¼Œæ‰“ç®—åˆ©ç”¨æä¾›çš„ APIï¼Œå†™ä¸¤ä¸ªè„šæœ¬ï¼Œä¸€ä¸ª pull æ‰€æœ‰æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œä¸€ä¸ª push æœ¬åœ°æ–‡ä»¶åˆ°äº‘ç¬”è®°ã€‚ä½† API å¤ªéš¾ç”¨äº†ï¼ŒN å¤šå¹´æ²¡æ›´æ–°äº†ï¼Œé—®å®¢æœä¹Ÿæ²¡æ›´æ–°çš„æ„æ€ï¼Œå¼€å‘åˆ°æœ€åå‘ç°ç«Ÿç„¶æ²¡æœ‰ Markdown æ–‡ä»¶çš„æ¥å£ï¼Œé†‰äº†ã€‚é‚æ”¾å¼ƒã€‚</p><p>ç°åœ¨æˆ‘ä½¿ç”¨ Typora + <a href="https://www.dropbox.com/" target="_blank" rel="noopener">Dropbox</a> + <a href="https://www.mweb.im/" target="_blank" rel="noopener">MWeb</a> å®ç°åŒæ­¥ç¬”è®°å’Œæ‰‹æœºæŸ¥çœ‹ç¼–è¾‘çš„åŠŸèƒ½ï¼Œå¾ˆé¦™ã€‚</p><p>æœ€è¿‘ç»™æœ‹å‹æ¨èæ­¤æ–¹å¼ï¼Œä½†å‘ç°æœ‰é“äº‘ç¬”è®°æœ€æ–°çš„ Mac å®¢æˆ·ç«¯å’Œç½‘é¡µç«¯å»é™¤äº†å¯¼å‡ºæ‰€æœ‰ç¬”è®°çš„åŠŸèƒ½ï¼è¿™æ˜¯ä»€ä¹ˆé€»è¾‘ï¼Œæ€•ç”¨æˆ·è·‘äº†ä¹ˆã€‚æ‰€ä»¥åœ¨åŸæ¥ pull è„šæœ¬çš„åŸºç¡€ä¸Šä¿®æ”¹å¾—åˆ°æ­¤è„šæœ¬ã€‚</p><p>è„šæœ¬åœ°å€ï¼š<a href="https://github.com/DeppWang/youdaonote-pull" target="_blank" rel="noopener">https://github.com/DeppWang/youdaonote-pull</a></p><a id="more"></a><h2 id="ä½¿ç”¨æç¤º"><a href="#ä½¿ç”¨æç¤º" class="headerlink" title="ä½¿ç”¨æç¤º"></a>ä½¿ç”¨æç¤º</h2><ol><li>è„šæœ¬å•çº¯æœ¬åœ°è¿è¡Œï¼Œä¸ç”¨æ‹…å¿ƒä½ çš„è´¦å·å¯†ç æ³„éœ²ã€‚ä½†æ³¨æ„ï¼Œå¦‚æœä½ è‡ªå·±ä¿®æ”¹è„šæœ¬ï¼Œæ³¨æ„ä¸è¦å°† config.json æ–‡ä»¶ push åˆ° GitHub</li><li>.note æ ¼å¼ç¬”è®°ä¸‹è½½åä¸º xml æ ¼å¼ï¼Œ<strong>é»˜è®¤å°† .note æ ¼å¼ç¬”è®°è½¬æ¢ä¸º Markdown æ ¼å¼</strong>ï¼Œtable ç­‰æœªè½¬æ¢ï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶</li><li>æœ‰é“äº‘ç¬”è®°å›¾åºŠå›¾ç‰‡åœ¨æœ‰é“äº‘ç¬”è®°å¤–ä¸æ˜¾ç¤ºï¼Œ<strong>é»˜è®¤ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨æœ¬åœ°å›¾ç‰‡é“¾æ¥ï¼Œå¯è®¾ç½®ä¸Šä¼ åˆ°å…è´¹çš„ <a href="https://sm.ms" target="_blank" rel="noopener">SM.MS</a> ä¸Š</strong></li><li>å¦‚æœä½ ä¸æ˜¯å¼€å‘è€…ï¼Œå¯èƒ½å¯¹ä¸‹é¢çš„å‘½ä»¤è¡Œæ“ä½œæœ‰æ‰€é™Œç”Ÿï¼Œå»ºè®®æŒ‰æ­¥éª¤æ…¢æ…¢æ“ä½œä¸€éã€‚åç»­æˆ‘ä¼šæ›´åŠ å®Œå–„æ­¤æ–‡æ¡£ï¼Œå¹¶æ ¹æ®éœ€æ±‚çœ‹æ˜¯å¦åº”è¯¥æä¾›ç½‘é¡µä¸‹è½½</li><li>è¯·ç¡®è®¤ä»£ç æ˜¯å¦ä¸ºæœ€æ–°ï¼Œæœ‰é—®é¢˜è¯·æäº¤ issue</li></ol><h2 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h2><!--é’ˆå¯¹æ™®é€šç”¨æˆ·--><h3 id="ä¸€ã€å¯¼å‡ºå‰çš„å‡†å¤‡å·¥ä½œ"><a href="#ä¸€ã€å¯¼å‡ºå‰çš„å‡†å¤‡å·¥ä½œ" class="headerlink" title="ä¸€ã€å¯¼å‡ºå‰çš„å‡†å¤‡å·¥ä½œ"></a>ä¸€ã€å¯¼å‡ºå‰çš„å‡†å¤‡å·¥ä½œ</h3><h4 id="1ã€å®‰è£…-Gitã€clone-é¡¹ç›®"><a href="#1ã€å®‰è£…-Gitã€clone-é¡¹ç›®" class="headerlink" title="1ã€å®‰è£…  Gitã€clone é¡¹ç›®"></a>1ã€å®‰è£…  <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">Git</a>ã€clone é¡¹ç›®</h4><ul><li>å¯æ ¹æ® <a href="https://www.liaoxuefeng.com/wiki/896043488029600/896067074338496" target="_blank" rel="noopener">å»–é›ªå³° Git æ•™ç¨‹</a> å®‰è£… Gitï¼Œæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€å‘½ä»¤è¡Œè½¯ä»¶ï¼Œå¦‚ Terminal (macOS)ã€PowerShell(Windows)ï¼Œclone é¡¹ç›®ï¼Œé‡Œé¢åŒ…å«è„šæœ¬</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pwd</span><br><span class="line">git clone https://github.com/DeppWang/youdaonote-pull.git</span><br><span class="line">cd youdaonote-pull</span><br></pre></td></tr></table></figure><h4 id="2ã€å®‰è£…-Python3ã€å®‰è£…ä¾èµ–æ¨¡å—ï¼ˆåŒ…ï¼‰"><a href="#2ã€å®‰è£…-Python3ã€å®‰è£…ä¾èµ–æ¨¡å—ï¼ˆåŒ…ï¼‰" class="headerlink" title="2ã€å®‰è£… Python3ã€å®‰è£…ä¾èµ–æ¨¡å—ï¼ˆåŒ…ï¼‰"></a>2ã€å®‰è£… Python3ã€å®‰è£…ä¾èµ–æ¨¡å—ï¼ˆåŒ…ï¼‰</h4><ul><li>å¯æ ¹æ® <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1016959856222624" target="_blank" rel="noopener">å»–é›ªå³° Python æ•™ç¨‹</a> å®‰è£… Python3ï¼Œæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 --version  # macOS/Linux</span><br><span class="line">python --version  # Windows</span><br></pre></td></tr></table></figure><ul><li>å®‰è£… requests ä¾èµ–åŒ…</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> macOS/Linux</span></span><br><span class="line">sudo easy_install pip3 # å®‰è£… Python3 Package Installer</span><br><span class="line">pip3 install requests # å®‰è£… requests åŒ…ï¼Œè„šæœ¬ä¾èµ– requests</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Windows</span></span><br><span class="line">pip install requests # å®‰è£… requests åŒ…ï¼Œè„šæœ¬ä¾èµ– requests</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ‰é—®é¢˜å¯å‚è€ƒ https://www.liaoxuefeng.com/wiki/1016959663602400/1017493741106496</span></span><br></pre></td></tr></table></figure><h4 id="3ã€è®¾ç½®è„šæœ¬å‚æ•°é…ç½®æ–‡ä»¶"><a href="#3ã€è®¾ç½®è„šæœ¬å‚æ•°é…ç½®æ–‡ä»¶" class="headerlink" title="3ã€è®¾ç½®è„šæœ¬å‚æ•°é…ç½®æ–‡ä»¶"></a>3ã€è®¾ç½®è„šæœ¬å‚æ•°é…ç½®æ–‡ä»¶</h4><p>config.json</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"username"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="attr">"password"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="attr">"local_dir"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="attr">"ydnote_dir"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="attr">"smms_secret_token"</span>: <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>usernameï¼š<strong>å¿…å¡«</strong>ï¼Œä½ çš„æœ‰é“äº‘ç¬”è®°ç”¨æˆ·å</li><li>passwordï¼š<strong>å¿…å¡«</strong>ï¼Œä½ çš„æœ‰é“äº‘ç¬”è®°å¯†ç </li><li>local_dirï¼šé€‰å¡«ï¼Œæœ¬åœ°å­˜æ”¾å¯¼å‡ºæ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œä¸å¡«åˆ™é»˜è®¤ä¸ºå½“å‰æ–‡ä»¶å¤¹</li><li>ydnote_dirï¼šé€‰å¡«ï¼Œæœ‰é“äº‘ç¬”è®°æŒ‡å®šå¯¼å‡ºæ–‡ä»¶å¤¹åï¼Œä¸å¡«åˆ™å¯¼å‡ºæ‰€æœ‰æ–‡ä»¶</li><li>smms_secret_tokenï¼šé€‰å¡«ï¼Œ <a href="https://sm.ms" target="_blank" rel="noopener">SM.MS</a> çš„ Secret Tokenï¼ˆæ³¨å†Œå -&gt; Dashboard -&gt; API Tokenï¼‰ï¼Œç”¨äºä¸Šä¼ ç¬”è®°ä¸­æœ‰é“äº‘å›¾åºŠå›¾ç‰‡åˆ° SM.MS å›¾åºŠï¼Œä¸å¡«åˆ™åªä¸‹è½½åˆ°æœ¬åœ°ï¼ˆyoudaonote-images æ–‡ä»¶å¤¹ï¼‰ï¼ŒMarkdown ä½¿ç”¨æœ¬åœ°é“¾æ¥</li><li>å»ºè®®ä½¿ç”¨ <a href="https://www.sublimetext.com/3" target="_blank" rel="noopener">Sublime</a> ç¼–è¾‘ config.json</li></ul><p>ç¤ºä¾‹ï¼š</p><ul><li>macOS</li></ul><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"username"</span>: <span class="string">"deppwang@163.com"</span>,</span><br><span class="line">   <span class="attr">"password"</span>: <span class="string">"12345678"</span>,</span><br><span class="line">   <span class="attr">"local_dir"</span>: <span class="string">"/Users/yanjie/Dropbox/youdaonote/test"</span>,</span><br><span class="line">   <span class="attr">"ydnote_dir"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="attr">"smms_secret_token"</span>: <span class="string">"SGSLk9yWdTe4RenXYqEPWkqVrx0Yexample"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Windows</li></ul><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"username"</span>: <span class="string">"deppwang@163.com"</span>,</span><br><span class="line">   <span class="attr">"password"</span>: <span class="string">"12345678"</span>,</span><br><span class="line">   <span class="attr">"local_dir"</span>: <span class="string">"D:/Dropbox/youdaonote/test"</span>,</span><br><span class="line">   <span class="attr">"ydnote_dir"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="attr">"smms_secret_token"</span>: <span class="string">"SGSLk9yWdTe4RenXYqEPWkqVrx0Yexample"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€è¿è¡Œå¯¼å‡ºè„šæœ¬"><a href="#äºŒã€è¿è¡Œå¯¼å‡ºè„šæœ¬" class="headerlink" title="äºŒã€è¿è¡Œå¯¼å‡ºè„šæœ¬"></a>äºŒã€è¿è¡Œå¯¼å‡ºè„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 pull.py # macOS/Linux</span><br><span class="line">python pull.py  # Windows</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><img src="https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-09-130325.jpg" alt=""></p><!--[](https://deppwang.oss-cn-beijing.aliyuncs.com/blog/2020-06-07-140101.jpg)--><h3 id="ä¸‰ã€å¤šæ¬¡å¯¼å‡º"><a href="#ä¸‰ã€å¤šæ¬¡å¯¼å‡º" class="headerlink" title="ä¸‰ã€å¤šæ¬¡å¯¼å‡º"></a>ä¸‰ã€å¤šæ¬¡å¯¼å‡º</h3><p>å¤šæ¬¡å¯¼å‡ºæ—¶ï¼ŒåŒæ ·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 pull.py # macOS/Linux</span><br><span class="line">python pull.py # Windows</span><br></pre></td></tr></table></figure><p>æ ¹æ®æœ‰é“äº‘ç¬”è®°çš„æœ€åä¿®æ”¹æ—¶é—´æ˜¯å¦å¤§äºæœ¬åœ°æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æ›´æ–°ã€‚å†æ¬¡å¯¼å‡ºæ—¶ï¼Œåªä¼šå¯¼å‡ºæœ‰é“äº‘ç¬”è®°ä¸Šæ¬¡å¯¼å‡ºåæ–°å¢ã€ä¿®æ”¹çš„ç¬”è®°ï¼Œä¸ä¼šè¦†ç›–æœ¬åœ°å·²ç»ä¿®æ”¹çš„æ–‡ä»¶ã€‚<strong>ä½†æœ‰é“äº‘ç¬”è®°å’Œæœ¬åœ°ä¸è¦åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´æœ¬åœ°ä¿®æ”¹ä¸¢å¤±</strong>ï¼</p><p>å¯¼å‡ºæ˜¯æ ¹æ®æœ€åä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­ï¼Œæ‰€ä»¥è¢«æ›´æ–°æ–‡ä»¶å’Œæ–°å¯¼å‡ºä¸€æ ·ï¼Œä¼šé‡å¤ä¸‹è½½å›¾ç‰‡</p><h2 id="åç»­å¼€å‘è®¡åˆ’"><a href="#åç»­å¼€å‘è®¡åˆ’" class="headerlink" title="åç»­å¼€å‘è®¡åˆ’"></a>åç»­å¼€å‘è®¡åˆ’</h2><ul><li><input checked disabled type="checkbox"> å°† .note æ–‡ä»¶è½¬æ¢ä¸º MarkDown æ–‡ä»¶</li><li><input checked disabled type="checkbox"> è§£å†³æœ‰é“äº‘å›¾åºŠå›¾ç‰‡ä¸èƒ½æ˜¾ç¤ºé—®é¢˜ï¼Œå®ç°æ–¹å¼ä¸ºé»˜è®¤ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨æœ¬åœ°å›¾ç‰‡é“¾æ¥ï¼Œä¹Ÿå¯ä¸Šä¼ åˆ° SM.MS å›¾åºŠ</li><li><input checked disabled type="checkbox"> é¦–æ¬¡å¯¼å‡ºä½¿ç”¨è´¦å·å¯†ç ç™»å½•ï¼Œå†æ¬¡å¯¼å‡ºæ—¶ä½¿ç”¨ Cookie ç™»å½•ï¼ˆCookie ä¿å­˜åœ¨ cookies.json ä¸­ï¼‰ï¼Œé¿å…é¢‘ç¹æ“ä½œæ—¶å› ä¸ºéœ€è¦è¾“å…¥éªŒè¯ç å¯¼è‡´ç™»å½•ä¸ä¸Šçš„æƒ…å†µ</li><li><input disabled type="checkbox"> ä¼˜åŒ–å¦‚æœåŒä¸€ç›®å½•å­˜åœ¨åŒåçš„ .md å’Œ .note æ–‡ä»¶ï¼Œ.md æ–‡ä»¶å°†è¢«è¦†ç›–çš„æƒ…å†µ</li><li><input disabled type="checkbox"> å¹¶å‘æ‰§è¡Œä»¥åŠ å¿«é€Ÿåº¦</li><li><input disabled type="checkbox"> é’ˆå¯¹éå¼€å‘è€…ç”¨æˆ·ï¼Œæä¾›ç½‘é¡µè¾“å…¥è´¦å·å¯†ç ç›´æ¥ä¸‹è½½æ‰€æœ‰ç¬”è®°å‹ç¼©åŒ…çš„æ–¹å¼</li></ul><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><ul><li>æ­£å¸¸ç”¨æˆ·æ“ä½œæ—¶ï¼Œæµè§ˆå™¨ï¼ˆå‰ç«¯ï¼‰è°ƒç”¨æœåŠ¡å™¨ï¼ˆåç«¯ï¼‰æ¥å£ï¼Œæ¥å£è¿”å›æ–‡ä»¶å†…å®¹ç”±å‰ç«¯æ¸²æŸ“æ˜¾ç¤ºã€‚</li><li>åŸç†æ˜¯åˆ©ç”¨æœ‰é“äº‘ç¬”è®°æœ¬èº«çš„æ¥å£ï¼Œæ¨¡æ‹Ÿæ“ä½œæ¥å£ï¼Œå°†å‰ç«¯æ˜¾ç¤ºæ”¹ä¸ºå­˜æ”¾åˆ°æœ¬åœ°ã€‚å¯ä»¥çœ‹çœ‹<a href="https://depp.wang/2020/06/11/how-to-find-the-api-of-a-website-eg-note-youdao-com">å¦‚ä½•æ‰¾åˆ°æœ‰é“äº‘ç¬”è®°çš„æ¥å£</a></li><li>Xml è½¬æ¢ä¸º Markdownï¼šä½¿ç”¨äº† <a href="http://docs.python.org/3.7/library/xml.etree.elementtree.html" target="_blank" rel="noopener">xml.etree.ElementTreeI</a></li></ul><h2 id="æ„Ÿè°¢ï¼ˆå‚è€ƒï¼‰"><a href="#æ„Ÿè°¢ï¼ˆå‚è€ƒï¼‰" class="headerlink" title="æ„Ÿè°¢ï¼ˆå‚è€ƒï¼‰"></a>æ„Ÿè°¢ï¼ˆå‚è€ƒï¼‰</h2><ul><li><a href="https://github.com/wesley2012/YoudaoNoteExport" target="_blank" rel="noopener">YoudaoNoteExport</a></li></ul>]]></content:encoded>
      
      <comments>https://depp.wang/2020/05/18/export-youdaonote-all-notes/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä»è™šæ‹Ÿæœºè§’åº¦ç†è§£ï¼Œä¸ºä»€ä¹ˆé™æ€å—å‡½æ•°å…ˆäºæ„é€ å‡½æ•°æ‰§è¡Œ</title>
      <link>https://depp.wang/2020/05/06/static-block-method-and-constructor-method/</link>
      <guid>https://depp.wang/2020/05/06/static-block-method-and-constructor-method/</guid>
      <pubDate>Wed, 06 May 2020 15:02:25 GMT</pubDate>
      <description>
      
        &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;https://depp.wang&quot;&gt;DeppWang&lt;/a&gt;ã€&lt;a href=&quot;https://depp.wang/2020/05/06/static-block-method-and-constructor-method/&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;&lt;a href=&quot;#ä¸€ã€å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€å‰è¨€&quot;&gt;&lt;/a&gt;ä¸€ã€å‰è¨€&lt;/h2&gt;&lt;p&gt;å¸¸å¸¸æœ‰å…³äºé™æ€å—å‡½æ•°ã€æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåºçš„é¢è¯•é¢˜ï¼Œå¦‚æœæ­»è®°ç¡¬èƒŒï¼Œå¾€å¾€å®¹æ˜“æ··æ·†ã€‚éœ€è¦ä»è™šæ‹Ÿè§’åº¦æ¥ç†è§£ï¼Œå½“çœŸæ­£ç†è§£åï¼Œå…¶å®å¾ˆç®€å•ã€‚&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>ä½œè€…ï¼š<a href="https://depp.wang">DeppWang</a>ã€<a href="https://depp.wang/2020/05/06/static-block-method-and-constructor-method/">åŸæ–‡åœ°å€</a></p></blockquote><h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><p>å¸¸å¸¸æœ‰å…³äºé™æ€å—å‡½æ•°ã€æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåºçš„é¢è¯•é¢˜ï¼Œå¦‚æœæ­»è®°ç¡¬èƒŒï¼Œå¾€å¾€å®¹æ˜“æ··æ·†ã€‚éœ€è¦ä»è™šæ‹Ÿè§’åº¦æ¥ç†è§£ï¼Œå½“çœŸæ­£ç†è§£åï¼Œå…¶å®å¾ˆç®€å•ã€‚</p><a id="more"></a><p>ä¸€ä¸ªé¢è¯•é¢˜æ —å­ï¼Œè¯·è¾“å‡ºä¸‹é¢ä»£ç çš„è¿è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticSuper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"super static block"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StaticSuper() &#123;</span><br><span class="line">        System.out.println(<span class="string">"super constructor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticTest</span> <span class="keyword">extends</span> <span class="title">StaticSuper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"static block"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StaticTest() &#123;</span><br><span class="line">        System.out.println(<span class="string">"constructor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"in main"</span>);</span><br><span class="line">        StaticTest s = <span class="keyword">new</span> StaticTest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">super <span class="keyword">static</span> <span class="keyword">block</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">block</span></span><br><span class="line"><span class="keyword">in</span> main</span><br><span class="line">super <span class="function"><span class="keyword">constructor</span></span></span><br><span class="line"><span class="function"><span class="title">constructor</span></span></span><br></pre></td></tr></table></figure><h2 id="äºŒã€åˆ†æ"><a href="#äºŒã€åˆ†æ" class="headerlink" title="äºŒã€åˆ†æ"></a>äºŒã€åˆ†æ</h2><p>å½“æ‰§è¡Œ StaticTest.main() æ—¶ï¼Œç±»åŠ è½½å™¨åŠ è½½ StaticTest.class æ–‡ä»¶åˆ°è™šæ‹Ÿæœºï¼Œæ–°å»ºä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ Class å¯¹è±¡ï¼Œå¦‚æœæœ‰ç±»å˜é‡ï¼Œä¸ºç±»å˜é‡è®¾ç½®åˆå§‹å€¼ã€‚</p><p>æ‰§è¡Œ StaticTest.main()ï¼Œå…¶å®æ˜¯æ‰§è¡Œ invokestatic æŒ‡ä»¤ï¼ŒJava è™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œæ‰§è¡Œ invokestatic æŒ‡ä»¤æ—¶ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ç±»ï¼Œåˆå§‹åŒ–ç±»æ—¶ï¼Œæ‰§è¡Œç±»æ„é€ å™¨ <code>&lt;clinit&gt;()</code> æ–¹æ³•ï¼Œ <code>&lt;clinit&gt;()</code> æ–¹æ³•ä¸ºç±»å˜é‡èµ‹å€¼ä»¥åŠæ‰§è¡Œé™æ€ä»£ç å—ï¼Œè™šæ‹Ÿæœºä¿è¯æ‰§è¡Œ <code>&lt;clinit&gt;()</code> æ–¹æ³•å‰å…ˆæ‰§è¡Œçˆ¶ç±» <code>&lt;clinit&gt;()</code> æ–¹æ³•ã€‚</p><p>æ‰§è¡Œå®Œ <code>&lt;clinit&gt;()</code> æ–¹æ³•åæ‰§è¡Œ main() æ–¹æ³•</p><p>æ‰§è¡Œ new æŒ‡ä»¤æ—¶ï¼Œå®ä¾‹åŒ–ç”Ÿæˆå¯¹è±¡ï¼Œå¹¶ä¸ºå®ä¾‹å˜é‡è®¾ç½®åˆå§‹å€¼ï¼ˆå¦‚æœæ²¡æœ‰åˆå§‹å€¼ï¼‰ï¼Œå†è°ƒç”¨å®ä¾‹æ„é€ æ–¹æ³•  <code>&lt;init&gt;()</code>  ä¸ºå®ä¾‹å˜é‡èµ‹å€¼ã€‚</p><h2 id="ä¸‰ã€åŠ å…¥æ„é€ ä»£ç å—"><a href="#ä¸‰ã€åŠ å…¥æ„é€ ä»£ç å—" class="headerlink" title="ä¸‰ã€åŠ å…¥æ„é€ ä»£ç å—"></a>ä¸‰ã€åŠ å…¥æ„é€ ä»£ç å—</h2><p>æœ‰æ—¶å€™ï¼Œä¸ºäº†åŠ å¤§éš¾åº¦ï¼Œé‡Œé¢è¿˜ä¼šåŠ ä¸Šæ„é€ ä»£ç å—</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticSuper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"super static block"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"super constructor block"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StaticSuper() &#123;</span><br><span class="line">        System.out.println(<span class="string">"super constructor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticTest</span> <span class="keyword">extends</span> <span class="title">StaticSuper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"static block"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"constructor block"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StaticTest() &#123;</span><br><span class="line">        System.out.println(<span class="string">"constructor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"in main"</span>);</span><br><span class="line">        StaticTest s = <span class="keyword">new</span> StaticTest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ ä»£ç å—å¯ä»¥çœ‹æˆä¸€ä¸ªå…¬å…±æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ä»»ä½•æ„é€ å‡½æ•°å‰éƒ½éœ€è¦å…ˆæ‰§è¡Œæ„é€ ä»£ç å—ã€‚æ‰€ä»¥æ‰§è¡Œç»“æœä¸ºï¼š</p><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">super <span class="keyword">static</span> <span class="keyword">block</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">block</span></span><br><span class="line"><span class="keyword">in</span> main</span><br><span class="line">super <span class="function"><span class="keyword">constructor</span> <span class="title">block</span></span></span><br><span class="line"><span class="function"><span class="title">super</span> <span class="title">constructor</span></span></span><br><span class="line"><span class="function"><span class="title">constructor</span> <span class="title">block</span></span></span><br><span class="line"><span class="function"><span class="title">constructor</span></span></span><br></pre></td></tr></table></figure><h2 id="å››ã€åº”ç”¨"><a href="#å››ã€åº”ç”¨" class="headerlink" title="å››ã€åº”ç”¨"></a>å››ã€åº”ç”¨</h2><p>é™æ€ä»£ç å—å±äºç±»æ„é€ å‡½æ•°çš„èŒƒç•´ï¼Œæ‰€ä»¥å¸¸ç”¨äºè®¾ç½®é™æ€å˜é‡ã€‚å¦‚ï¼ŒInteger é‡Œé¢çš„ IntegerCacheã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerCache</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> low = -<span class="number">128</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> high;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="comment">// high value may be configured by property</span></span><br><span class="line">            <span class="keyword">int</span> h = <span class="number">127</span>;</span><br><span class="line">            ...</span><br><span class="line">            high = h;</span><br><span class="line"></span><br><span class="line">            cache = <span class="keyword">new</span> Integer[(high - low) + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> j = low;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">                cache[k] = <span class="keyword">new</span> Integer(j++);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span></span><br><span class="line">            <span class="keyword">assert</span> IntegerCache.high &gt;= <span class="number">127</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>1ã€æˆ‘ä»¬<strong>å°†é™æ€ä»£ç å—çœ‹æˆç±»æ„é€ æ–¹æ³•</strong>ï¼Œç±»æ„é€ æ–¹æ³•è‚¯å®šå…ˆäºå®ä¾‹æ„é€ æ–¹æ³•æ‰§è¡Œã€‚</p><p>2ã€æ„é€ ä»£ç å—å¯ä»¥çœ‹æˆå…¬å…±æ„é€ å‡½æ•°ï¼Œå…ˆäºæ„é€ å‡½æ•°æ‰§è¡Œ</p><p>è¿™æ–¹é¢çš„å†…å®¹å¯ä»¥<a href="https://weread.qq.com/web/reader/cf1320d071a1a78ecf19254k283328802332838023a7529" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ï¼ˆç¬¬ 3 ç‰ˆï¼‰- 7.3 ç±»åŠ è½½çš„è¿‡ç¨‹</a>ï¼Œä¼šæ¯”çœ‹åšæ–‡ç†è§£å¾—æ›´æ·±åˆ»ã€‚</p><!--å½“è¿è¡Œ StaticTest.main() åï¼Œç±»åŠ è½½å™¨å°±ä¼šå¯»æ‰¾å·²ç»ç¼–è¯‘çš„ StaticTest.class æ–‡ä»¶ï¼Œå°†å…¶åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ï¼Œ--><blockquote><!--é™æ€å—å‡½æ•°ä¹Ÿå«é™æ€åˆå§‹åŒ–å‡½æ•°ï¼ˆstatic initializerï¼‰æ˜¯ä¸€æ®µåœ¨åŠ è½½ç±»æ—¶ä¼šæ‰§è¡Œçš„ç¨‹åºä»£ç ï¼Œå®ƒä¼šåœ¨å…¶ä»–ç¨‹åºå¯ä»¥ä½¿ç”¨è¯¥ç±»ä¹‹å‰å°±æ‰§è¡Œã€‚--></blockquote><blockquote><!--æ„é€ å‡½æ•°çš„ä½œç”¨æ˜¯ç”¨äºç»™å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ã€‚ä¸å»ºç«‹å¯¹è±¡ï¼Œæ„é€ å‡½æ•°æ—¶ä¸ä¼šæ‰§è¡Œã€‚--></blockquote><!--è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š--><!--å½“è¿è¡Œ StaticTest.main()(è¿™æ˜¯ä¸€ä¸ª static æ–¹æ³•) åï¼Œç±»è£…è½½å™¨å°±ä¼šå¯»æ‰¾å·²ç»ç¼–è¯‘çš„ StaticTest.class æ–‡ä»¶ã€‚åœ¨è£…è½½çš„è¿‡ç¨‹ä¸­ï¼Œè£…è½½å™¨æ³¨æ„åˆ°å®ƒæœ‰ä¸€ä¸ªåŸºç±»ï¼ˆStaticSuper.classï¼‰ï¼Œäºæ˜¯å®ƒå†è£…è½½åŸºç±»ã€‚ä¸ç®¡åˆ›ä¸åˆ›å»ºåŸºç±»å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ€»ä¼šå‘ç”Ÿã€‚å¦‚æœåŸºç±»è¿˜æœ‰åŸºç±»ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªåŸºç±»ä¹Ÿä¼šè¢«è£…è½½ï¼Œä¾æ­¤ç±»æ¨ã€‚--><!--æ‰€æœ‰åŸºç±»è£…è½½å®Œæˆåï¼Œå…ˆæ‰§è¡Œæ ¹åŸºç±»çš„ static åˆå§‹åŒ–å‡½æ•°ï¼Œç„¶åæ˜¯ä¸‹ä¸€ä¸ªæ´¾ç”Ÿç±»çš„ static åˆå§‹åŒ–å‡½æ•°ï¼Œä¾æ­¤ç±»æ¨ã€‚è¿™ä¸ªé¡ºåºéå¸¸é‡è¦ï¼Œå› ä¸ºæ´¾ç”Ÿç±»çš„ â€œstatic åˆå§‹åŒ–å‡½æ•°â€ æœ‰å¯èƒ½è¦ä¾èµ–åŸºç±»æˆå‘˜çš„æ­£ç¡®åˆå§‹åŒ–ã€‚æ‰€ä»¥ä¾æ¬¡è¾“å‡º `super static block`,`static  block`--><!--å½“æ‰€æœ‰å¿…è¦çš„ç±»éƒ½å·²ç»è£…è½½ç»“æŸï¼Œå¼€å§‹æ‰§è¡Œ main() æ–¹æ³•ä½“ï¼Œå…ˆè¾“å‡º `in main`ï¼Œå†ç”¨ new StaticSuperTest() åˆ›å»ºå¯¹è±¡ã€‚--><!--ç±» StaticTest å­˜åœ¨çˆ¶ç±» StaticSuperï¼Œå…ˆè°ƒç”¨ StaticSuper çš„æ„é€ å‡½æ•°ï¼Œè¾“å‡º `super constructor`ï¼Œæœ€åè°ƒç”¨ StaticSuperTest çš„æ„é€ å‡½æ•°è¾“å‡º `constructor`ã€‚--><!--å¯ä»¥ä½¿ç”¨ super æ˜¾å¼æ¥æŒ‡å®šè°ƒç”¨å“ªä¸ªæ„é€ å‡½æ•°ã€‚åŸºç±»çš„æ„é€ è¿‡ç¨‹ä»¥åŠæ„é€ é¡ºåºï¼ŒåŒæ´¾ç”Ÿç±»çš„ç›¸åŒã€‚--><!--äº”ã€å»¶ä¼¸é˜…è¯»--><!--[Java æé«˜ç¯‡ ---- é™æ€ä»£ç å—ã€æ„é€ ä»£ç å—ã€æ„é€ å‡½æ•°ä»¥åŠ Java ç±»åˆå§‹åŒ–é¡ºåº](http://www.cnblogs.com/Qian123/p/5713440.html)-->]]></content:encoded>
      
      <comments>https://depp.wang/2020/05/06/static-block-method-and-constructor-method/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä¸€é“ç®—æ³•é¢˜ï¼šæŸ¥æ‰¾æ•°ç»„ arr ä¸­ç¬¬ k å°çš„å¥‡æ•°</title>
      <link>https://depp.wang/2020/05/06/find-the-k-th-smallest-odd-number-in-the-array-arr/</link>
      <guid>https://depp.wang/2020/05/06/find-the-k-th-smallest-odd-number-in-the-array-arr/</guid>
      <pubDate>Wed, 06 May 2020 08:09:37 GMT</pubDate>
      <description>
      
        &lt;!--é¢˜ç›®æ¥æº--&gt;

&lt;!--ã€ŒåŒ—äº¬æ³¢ç²’å­ç§‘æŠ€æœ‰é™å…¬å¸ã€é¢è¯•é¢˜--&gt;

&lt;h2 id=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;a href=&quot;#é¢˜ç›®æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;/a&gt;é¢˜ç›®æè¿°&lt;/h2&gt;&lt;p&gt;æŸ¥æ‰¾æ•°ç»„ arr ä¸­ç¬¬ k å°çš„å¥‡æ•°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› 0ã€‚&lt;/p&gt;
&lt;p&gt;è®¡ç®—å‡ºæ—¶é—´å¤æ‚åº¦ï¼ˆæ³¨æ„ä»£ç æ³¨é‡Šï¼Œå°½å¯èƒ½ä¸ç”¨å…¨æ’åºï¼Œä¸è¦ä½¿â½¤åº“å‡½æ•°æˆ–è„šæœ¬ä¸­å·²ç»å®ç°å¥½çš„æ’åºç®—æ³•å’Œâ¼¯å…·ï¼Œéœ€è¦â¾ƒâ¼°å®ç°æ•°æ®ç»“æ„å’Œæ‰€éœ€è¦çš„ç®—æ³•ï¼‰&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<!--é¢˜ç›®æ¥æº--><!--ã€ŒåŒ—äº¬æ³¢ç²’å­ç§‘æŠ€æœ‰é™å…¬å¸ã€é¢è¯•é¢˜--><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>æŸ¥æ‰¾æ•°ç»„ arr ä¸­ç¬¬ k å°çš„å¥‡æ•°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› 0ã€‚</p><p>è®¡ç®—å‡ºæ—¶é—´å¤æ‚åº¦ï¼ˆæ³¨æ„ä»£ç æ³¨é‡Šï¼Œå°½å¯èƒ½ä¸ç”¨å…¨æ’åºï¼Œä¸è¦ä½¿â½¤åº“å‡½æ•°æˆ–è„šæœ¬ä¸­å·²ç»å®ç°å¥½çš„æ’åºç®—æ³•å’Œâ¼¯å…·ï¼Œéœ€è¦â¾ƒâ¼°å®ç°æ•°æ®ç»“æ„å’Œæ‰€éœ€è¦çš„ç®—æ³•ï¼‰</p><a id="more"></a><h2 id="è§£é¢˜æ–¹æ¡ˆ"><a href="#è§£é¢˜æ–¹æ¡ˆ" class="headerlink" title="è§£é¢˜æ–¹æ¡ˆ"></a>è§£é¢˜æ–¹æ¡ˆ</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ul><li>å±äº Top K é—®é¢˜</li><li>å‡è®¾æ•°ç»„ä¸­æ•°æ®èŒƒå›´æœ‰é™ï¼Œä½¿ç”¨ä¸€ä¸ªé¢å¤–æ•°ç»„ï¼Œå­˜æ”¾æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ï¼Œæ•°ç»„ä¸‹æ ‡ä½ç½®å°±æ˜¯æ•°å­—å¤§å°ï¼Œæ­¤ç§æ–¹å¼ä¸ºã€Œè®¡æ•°æ’åºæ³•ã€</li><li>æ—¶é—´å¤æ‚åº¦ï¼šO(N)ï¼ŒN ä¸ºç¬¬ k å°çš„å¥‡æ•°çš„å¤§å°</li><li>æœ€åæ—¶é—´å¤æ‚åº¦ï¼šå½“ä¸å­˜åœ¨æ—¶ï¼Œéœ€è¦éå†å®Œ counter æ•°ç»„ï¼ŒO(M)ï¼ŒM ä¸ºæŒ‡å®šæ•°ç»„çš„èŒƒå›´</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(M)ï¼Œéœ€è¦é•¿åº¦ä¸º M çš„é¢å¤–æ•°ç»„ã€‚</li><li>æ ‡ç­¾ï¼š<code>è®¡æ•°æ’åº</code></li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findKth</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»Ÿè®¡æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span>[] counter = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10001</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : arr) &#123;</span><br><span class="line">            counter[num] = counter[num] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// éå† counterï¼ŒæŸ¥æ‰¾ç¬¬ k å°çš„å¥‡æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num = <span class="number">0</span>; num &lt; counter.length; num++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (counter[num] &gt; <span class="number">0</span> &amp;&amp; x &lt; k &amp;&amp; num % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                x++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (x == k) &#123;</span><br><span class="line">                <span class="keyword">return</span> num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">4</span>, <span class="number">23</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">12</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">3</span>;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> Solution().findKth(arr, k));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!--å‚è€ƒï¼šhttps://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/solution/3chong-jie-fa-miao-sha-topkkuai-pai-dui-er-cha-sou/-->]]></content:encoded>
      
      <comments>https://depp.wang/2020/05/06/find-the-k-th-smallest-odd-number-in-the-array-arr/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
